(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    226197,       5296]
NotebookOptionsPosition[    214685,       5142]
NotebookOutlinePosition[    215595,       5169]
CellTagsIndexPosition[    215552,       5166]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"CloseKernels", "[", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"LaunchKernels", "[", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"$HistoryLength", "=", "0"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ParallelEvaluate", "[", 
   RowBox[{"$HistoryLength", "=", "0"}], "]"}], ";"}]}], "Code",
 CellOpen->False,
 CellChangeTimes->{{3.8351207819927807`*^9, 3.835120828312399*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"e2f1c539-7661-4274-b896-30d4762f8fc3"],

Cell[TextData[StyleBox["HiDENSEC",
 FontVariations->{"Underline"->True}]], "Text",
 CellChangeTimes->{{3.860248769181752*^9, 3.860248770901754*^9}},
 FontSize->48,ExpressionUUID->"e1c0a1c7-e88f-4e1a-b171-0b94e5c70687"],

Cell[CellGroupData[{

Cell["Function Definitions & Global Variables", "Title",
 CellChangeTimes->{{3.86024878149333*^9, 
  3.86024882740399*^9}},ExpressionUUID->"155dab3a-c5ed-4e7b-be6d-\
f56bcefadad6"],

Cell[TextData[StyleBox["These global definitions require evaluation before \
running HiDENSEC on any concrete Hi-C map.",
 FontSlant->"Italic"]], "Text",
 CellFrame->{{0, 0}, {2, 0}},
 CellFrameColor->GrayLevel[0.75],
 CellChangeTimes->{{3.860248806085986*^9, 3.860248864968273*^9}, {
  3.860251977141947*^9, 3.860251977310009*^9}},
 FontSize->18,ExpressionUUID->"049da9a9-6905-4ebf-be70-c7a5775515f6"],

Cell[CellGroupData[{

Cell["Global Variables", "Chapter",
 CellChangeTimes->{{3.8351213004569607`*^9, 3.835121302769058*^9}, {
  3.8602492579270163`*^9, 
  3.860249259887025*^9}},ExpressionUUID->"e9e8fb92-0b74-414f-87ae-\
bbe95bfd0b27"],

Cell[TextData[StyleBox["Load file paths, covariates & centromere locations.",
 FontSlant->"Italic"]], "Text",
 CellFrame->{{0, 0}, {2, 0}},
 CellFrameColor->GrayLevel[0.75],
 CellChangeTimes->{{3.860248806085986*^9, 3.860248864968273*^9}, {
  3.8602492697744493`*^9, 3.860249293008246*^9}},
 FontSize->18,ExpressionUUID->"7038a397-80b1-46d7-9fd5-23b2b4d0872a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"hidensecPath", "=", "\"\</example/path/\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.835121066367029*^9, 3.835121096163374*^9}, {
  3.835121126778454*^9, 3.835121127450493*^9}, {3.835121164361456*^9, 
  3.835121176729094*^9}, {3.860249319834372*^9, 
  3.8602493216472187`*^9}},ExpressionUUID->"99ca1e7f-72e5-4f3b-908f-\
244aa9ebb7ce"],

Cell[TextData[{
 "Path to folder that contains the following .wl files: ",
 StyleBox["chromosomelocations, compartmentnames, compartments, covariates, \
centromers, newCentromers, rPos, fPos, acrox, corrchromlocations, \
centromersCorrected, excursionLengthsH0",
  FontSlant->"Italic"]
}], "Text",
 CellChangeTimes->{{3.860249326430902*^9, 3.860249327254703*^9}, {
  3.860249362423806*^9, 3.860249371727262*^9}, {3.860250881470387*^9, 
  3.860250921956257*^9}, {3.860251354984241*^9, 3.860251358846046*^9}, {
  3.862751085213746*^9, 
  3.8627510858461123`*^9}},ExpressionUUID->"aa4e8b08-4d2d-472c-8c90-\
85433ce859f8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Get", "[", 
     RowBox[{"hidensecPath", "<>", "\"\<inference/\>\"", "<>", "#"}], "]"}], 
    "&"}], "/@", 
   RowBox[{"{", 
    RowBox[{
    "\"\<chromosomelocations\>\"", ",", "\"\<compartmentnames\>\"", ",", 
     "\"\<compartments\>\"", ",", "\"\<compartmentnames\>\"", ",", 
     "\"\<covariates\>\"", ",", "\"\<centromers\>\"", ",", 
     "\"\<newCentromers\>\"", ",", "\"\<rPos\>\"", ",", "\"\<fPos\>\"", ",", 
     "\"\<acrox\>\"", ",", "\"\<corrchromlocations\>\"", ",", 
     "\"\<centromersCorrected\>\"", ",", "\"\<excursionLengthsH0\>\"", ",", 
     "\"\<fixCdata\>\"", ",", "\"\<hiCdata\>\""}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.860249331874415*^9, 3.860249346391551*^9}, {
  3.8602493766629133`*^9, 3.860249409813511*^9}, {3.8602501747776747`*^9, 
  3.860250186408905*^9}, {3.860250234795084*^9, 3.8602502856370153`*^9}, {
  3.8602503551290703`*^9, 3.86025036095828*^9}, {3.860250849046777*^9, 
  3.860250869213657*^9}, {3.860251360982832*^9, 3.8602513645906057`*^9}, {
  3.862753262897204*^9, 3.862753266651026*^9}, {3.862753335018948*^9, 
  3.862753337008222*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"c708f8b9-ce9f-4f1d-b44d-c934ec54eb37"]
}, Closed]],

Cell[CellGroupData[{

Cell["Covariate Correction", "Chapter",
 CellChangeTimes->{{3.835362372447114*^9, 
  3.835362375382695*^9}},ExpressionUUID->"760ec9ea-99f4-48df-85e1-\
1acf191d70b8"],

Cell[TextData[StyleBox["Function definitions pertaining to the covariate \
regression.",
 FontSlant->"Italic"]], "Text",
 CellFrame->{{0, 0}, {2, 0}},
 CellFrameColor->GrayLevel[0.75],
 CellChangeTimes->{{3.860248806085986*^9, 3.860248864968273*^9}, {
  3.860249201433004*^9, 3.860249217768318*^9}},
 FontSize->18,ExpressionUUID->"beeb26b3-3915-4688-a39a-58391de67caa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"equiRange", "[", 
   RowBox[{"a_", ",", "b_", ",", "total_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"a", "\[Equal]", "b"}], ",", 
    RowBox[{"{", "}"}], ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Dimensions", "[", "a", "]"}], "\[Equal]", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"Range", "[", 
       RowBox[{"a", ",", "b", ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"b", "-", "a"}], ")"}], "/", 
         RowBox[{"(", 
          RowBox[{"total", "-", "1"}], ")"}]}]}], "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "#"}], ")"}], "a"}], "+", 
         RowBox[{"#", "*", "b"}]}], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{"0", ",", "1", ",", 
         RowBox[{"1", "/", 
          RowBox[{"(", 
           RowBox[{"total", "-", "1"}], ")"}]}]}], "]"}]}]}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.819928993788066*^9, 3.819929064931769*^9}, {
  3.822349885186193*^9, 3.822349905256928*^9}, {3.8243128850111723`*^9, 
  3.824312993822603*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"f6b95f0b-fe63-4ce5-9b8f-50c8934d4c2f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"partitionByIndex", "[", 
   RowBox[{"list_", ",", "indices_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"fullIndices", "=", 
      RowBox[{"Union", "@", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", "0", "}"}], ",", "indices", ",", 
         RowBox[{"{", 
          RowBox[{"Length", "@", "list"}], "}"}]}], "]"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"list", "\[LeftDoubleBracket]", 
       RowBox[{
        RowBox[{"1", "+", 
         RowBox[{"First", "@", "#"}]}], ";;", 
        RowBox[{"Last", "@", "#"}]}], "\[RightDoubleBracket]"}], "&"}], "/@", 
     
     RowBox[{"Partition", "[", 
      RowBox[{"fullIndices", ",", "2", ",", "1"}], "]"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8228702889389544`*^9, 3.8228704114395227`*^9}, {
   3.822870453728692*^9, 3.8228704546139402`*^9}, 3.8243128716625757`*^9},
 CellLabel->"In[10]:=",ExpressionUUID->"a12ba6bc-288b-43e6-97ae-61627d900746"],

Cell[BoxData[
 RowBox[{
  RowBox[{"partitionByLength", "[", 
   RowBox[{"list_", ",", "length_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"indices", "=", 
      RowBox[{"Accumulate", "[", "length", "]"}]}], "}"}], ",", 
    RowBox[{"partitionByIndex", "[", 
     RowBox[{"list", ",", "indices"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.8230080118119373`*^9, 3.823008046633973*^9}, 
   3.824313016212502*^9},
 CellLabel->"In[11]:=",ExpressionUUID->"4c3286c8-7c08-4d30-a57a-a7658266af4d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"findDiploidPeak", "[", 
   RowBox[{"data_", ",", 
    RowBox[{"window_", ":", 
     RowBox[{"{", 
      RowBox[{"100", ",", "2000", ",", "100"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"cleandata", "=", 
      RowBox[{"Cases", "[", 
       RowBox[{"data", ",", 
        RowBox[{"_", "?", "Positive"}]}], "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Mean", "[", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Sort", "[", "cleandata", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{"Round", "[", 
            RowBox[{"Median", "@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"#", ",", 
                RowBox[{"Min", "[", "#", "]"}]}], "]"}], "]"}]}], "]"}], 
           "&"}], "@", 
          RowBox[{"Differences", "[", 
           RowBox[{
            RowBox[{"Sort", "[", "cleandata", "]"}], ",", "1", ",", "w"}], 
           "]"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"w", ",", 
         RowBox[{"window", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"window", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{"window", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "]"}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8174839306977787`*^9, 3.817483994681101*^9}, {
  3.817484029119475*^9, 3.8174840326081667`*^9}, {3.817484083335771*^9, 
  3.817484094143214*^9}, {3.81748412741363*^9, 3.8174841360936604`*^9}, {
  3.817484223515341*^9, 3.817484281998699*^9}},
 CellLabel->"In[12]:=",ExpressionUUID->"4303ab98-d261-4fbb-8b6b-7a570acc591e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"covariateFilter", "[", 
   RowBox[{"dataset_", ",", 
    RowBox[{"cutthreshold_", ":", "75"}], ",", 
    RowBox[{"GCthreshold_", ":", "0.32"}], ",", 
    RowBox[{"mapthreshold_", ":", "0.8"}]}], "]"}], ":=", 
  RowBox[{"Select", "[", 
   RowBox[{"dataset", ",", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ">", "cutthreshold"}], "&&", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ">", "GCthreshold"}], "&&", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "4", "]"}], "]"}], ">", "mapthreshold"}], "&&", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "5", "]"}], "]"}], "\[NotEqual]", "\"\<A0\>\""}]}], 
     "&"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.814740959809391*^9, 3.8147409897430277`*^9}, {
   3.814741023592053*^9, 3.814741124892542*^9}, {3.814741972029306*^9, 
   3.814741981444928*^9}, {3.814742207187809*^9, 3.814742218844248*^9}, 
   3.814742433011684*^9, {3.814887394744061*^9, 3.81488739754935*^9}, {
   3.814887544582727*^9, 3.8148875476766644`*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"955958a2-c2d4-4b79-99ce-4fb2c257b484"],

Cell[BoxData[
 RowBox[{
  RowBox[{"filterPosition", "[", 
   RowBox[{"dataset_", ",", 
    RowBox[{"cutthreshold_", ":", "75"}], ",", 
    RowBox[{"GCthreshold_", ":", "0.32"}], ",", 
    RowBox[{"mapthreshold_", ":", "0.8"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Flatten", "[", 
     RowBox[{"Position", "[", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ">", "cutthreshold"}], "&&", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ">", "GCthreshold"}], "&&", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "4", "]"}], "]"}], ">", "mapthreshold"}], "&&", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "5", "]"}], "]"}], "\[NotEqual]", "\"\<A0\>\""}]}], 
          "&"}], ",", "dataset"}], "]"}], ",", "#"}], "]"}], "]"}], "&"}], "/@", 
   RowBox[{"{", 
    RowBox[{"True", ",", "False"}], "}"}]}]}]], "Input",
 CellChangeTimes->{{3.814740959809391*^9, 3.8147409897430277`*^9}, {
   3.814741023592053*^9, 3.814741124892542*^9}, {3.814741972029306*^9, 
   3.814741981444928*^9}, {3.814742207187809*^9, 3.814742218844248*^9}, 
   3.814742433011684*^9, {3.814887394744061*^9, 3.81488739754935*^9}, {
   3.814887544582727*^9, 3.8148875476766644`*^9}, {3.816205113809434*^9, 
   3.816205130370586*^9}, {3.816205401705435*^9, 3.816205454071786*^9}},
 CellLabel->"In[14]:=",ExpressionUUID->"360a25d5-c4ed-4bc7-9a8a-6c70d82e6744"],

Cell[BoxData[
 RowBox[{
  RowBox[{"covariateCorrection1", "[", 
   RowBox[{"dataset_", ",", 
    RowBox[{"cutthreshold_", ":", "75"}], ",", 
    RowBox[{"GCthreshold_", ":", "0.32"}], ",", 
    RowBox[{"mapthreshold_", ":", "0.8"}], ",", 
    RowBox[{"midpointwindow_", ":", 
     RowBox[{"{", 
      RowBox[{"100", ",", "2000", ",", "100"}], "}"}]}], ",", 
    RowBox[{"neighbourhood_", ":", "0.3"}], ",", 
    RowBox[{"filterlength_", ":", "100"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"data", "=", 
       RowBox[{"covariateFilter", "[", 
        RowBox[{
        "dataset", ",", "cutthreshold", ",", "GCthreshold", ",", 
         "mapthreshold"}], "]"}]}], ",", "midpoints", ",", "fits", ",", 
      "compartmentcorrected", ",", "finaldata", ",", "newmidpoint"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"midpoints", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Mean", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Sort", "[", 
             RowBox[{"Pick", "[", 
              RowBox[{
               RowBox[{"data", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "1"}], "]"}], "]"}], ",", 
               RowBox[{"data", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", "5"}], "]"}], "]"}], ",", "#"}], "]"}], 
             "]"}], "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{"Position", "[", 
                  RowBox[{"#", ",", 
                   RowBox[{"Min", "[", "#", "]"}]}], "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "&"}], "@", 
              RowBox[{"Differences", "[", 
               RowBox[{
                RowBox[{"Sort", "[", 
                 RowBox[{"Pick", "[", 
                  RowBox[{
                   RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "1"}], "]"}], "]"}], ",", 
                   RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "5"}], "]"}], "]"}], ",", "#"}], "]"}],
                  "]"}], ",", "1", ",", "w"}], "]"}]}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"w", ",", 
             RowBox[{"First", "@", "midpointwindow"}], ",", 
             RowBox[{"midpointwindow", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"Last", "@", "midpointwindow"}]}], "}"}]}], "]"}], "]"}],
         "&"}], "/@", 
       RowBox[{"Rest", "[", "compartmentnames", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"compartmentcorrected", "=", 
      RowBox[{"2", 
       RowBox[{
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{";;", ",", "1"}], "]"}], "]"}], "/", 
        RowBox[{"First", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"midpoints", "[", 
            RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"data", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "5"}], "]"}], "]"}], "/.", 
            RowBox[{"{", 
             RowBox[{"Thread", "[", 
              RowBox[{
               RowBox[{"Rest", "[", "compartmentnames", "]"}], "\[Rule]", 
               RowBox[{"Range", "[", "5", "]"}]}], "]"}], "}"}]}], ")"}]}], 
         "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fits", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"LinearModelFit", "[", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Pick", "[", 
                  RowBox[{
                   RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "3"}], "}"}]}], "]"}], "]"}], ",", 
                   RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "5"}], "]"}], "]"}], ",", "#"}], "]"}],
                  ",", 
                 RowBox[{"Pick", "[", 
                  RowBox[{"compartmentcorrected", ",", 
                   RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "5"}], "]"}], "]"}], ",", "#"}], 
                  "]"}]}], "}"}]}], ")"}], "/.", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"x_", ",", "y_"}], "}"}], ",", "z_"}], "}"}], 
               "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"x", ",", "y", ",", "z"}], "}"}]}], "}"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{
                RowBox[{"Last", "[", "#", "]"}], "-", "2"}], "]"}], "<", 
              "neighbourhood"}], "&"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"c", ",", "gc"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"c", ",", "gc"}], "}"}]}], "]"}], "&"}], "/@", 
       RowBox[{"Rest", "[", "compartmentnames", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"finaldata", "=", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"2", 
          RowBox[{"#1", "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"fits", "[", 
              RowBox[{"[", "#2", "]"}], "]"}], "@@", "#3"}], ")"}]}]}], "&"}],
         ",", 
        RowBox[{"{", 
         RowBox[{"compartmentcorrected", ",", 
          RowBox[{
           RowBox[{"data", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "5"}], "]"}], "]"}], "/.", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Rest", "[", "compartmentnames", "]"}], "\[Rule]", 
             RowBox[{"Range", "[", "5", "]"}]}], "]"}]}], ",", 
          RowBox[{"data", "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "3"}], "}"}]}], "]"}], "]"}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"newmidpoint", "=", 
      RowBox[{
       RowBox[{"Sort", "[", "finaldata", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{
          RowBox[{"Round", "[", 
           RowBox[{"Mean", "[", 
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{"#", ",", 
               RowBox[{"Min", "[", "#", "]"}]}], "]"}]}], "]"}], "]"}], "&"}],
          "@", 
         RowBox[{"Differences", "[", 
          RowBox[{
           RowBox[{"Sort", "[", "finaldata", "]"}], ",", "1", ",", "1000"}], 
          "]"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"finaldata", "*", 
      RowBox[{"2", "/", "newmidpoint"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.814742230709922*^9, 3.8147422375399218`*^9}, {
   3.814742319689411*^9, 3.8147423844396048`*^9}, {3.814742424479229*^9, 
   3.81474252265301*^9}, {3.81474255801328*^9, 3.81474259461852*^9}, {
   3.814742647059547*^9, 3.814742647328966*^9}, {3.814827752573997*^9, 
   3.8148277548449793`*^9}, {3.814832720199924*^9, 3.8148327229411488`*^9}, {
   3.8148353664707108`*^9, 3.814835381635701*^9}, {3.814835893781394*^9, 
   3.814835900050901*^9}, {3.814850067367455*^9, 3.814850076269199*^9}, {
   3.814887503039296*^9, 3.8148875047733173`*^9}, {3.814887549814905*^9, 
   3.814887551324573*^9}, {3.814995791369644*^9, 3.814995796424686*^9}, {
   3.814996042738666*^9, 3.81499615632521*^9}, {3.814996190812009*^9, 
   3.814996193036763*^9}, {3.814999282212514*^9, 3.814999297950959*^9}, {
   3.8149993292821712`*^9, 3.814999472075286*^9}, {3.814999523889591*^9, 
   3.8149995764062862`*^9}, {3.814999774510791*^9, 3.814999782560278*^9}, 
   3.815008240509305*^9, {3.81500835521909*^9, 3.8150083564096603`*^9}, {
   3.815008391680876*^9, 3.815008391726573*^9}, {3.815078696978979*^9, 
   3.815078697055984*^9}, {3.815079504619865*^9, 3.8150796580913877`*^9}, {
   3.8150810587093887`*^9, 3.815081058955029*^9}, {3.815081118359302*^9, 
   3.8150811441345177`*^9}, {3.815081176989696*^9, 3.8150812180791893`*^9}, {
   3.815081260983275*^9, 3.8150812999148273`*^9}, {3.8150813674262877`*^9, 
   3.81508140696583*^9}, {3.815096594797945*^9, 3.815096594828475*^9}, {
   3.815096744407833*^9, 3.815096766470889*^9}, {3.81509707220035*^9, 
   3.815097094699656*^9}, {3.815105228806584*^9, 3.81510523158101*^9}, {
   3.8151485664197607`*^9, 3.815148599437778*^9}, {3.815148721973425*^9, 
   3.815148746011587*^9}, {3.8151487780344763`*^9, 3.815148798939885*^9}, {
   3.817069317188712*^9, 3.8170693251856337`*^9}},
 CellLabel->"In[15]:=",ExpressionUUID->"cc588f7b-0d02-470a-a33d-6c261c1f38d6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"attachCovariates", "[", "data_", "]"}], ":=", 
  RowBox[{"Transpose", "@", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", "data", "}"}], ",", "covariates", ",", 
     RowBox[{"{", "compartments", "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.835122578003014*^9, 3.835122613832431*^9}},
 CellLabel->"In[16]:=",ExpressionUUID->"b209ffb0-acd9-4fa9-9a2d-46b57b995e86"],

Cell[BoxData[
 RowBox[{
  RowBox[{"computeC", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Pi]0_", ",", "\[Pi]1_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[CapitalPi]0_", ",", "\[CapitalPi]1_"}], "}"}]}], "]"}], ":=", 
  
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"\[Pi]0", ".", "\[CapitalPi]0"}], "+", 
     RowBox[{"\[Pi]1", ".", "\[CapitalPi]1"}]}], ")"}], "/", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"Norm", "[", 
       RowBox[{"\[Pi]0", ",", "2"}], "]"}], "^", "2"}], "+", 
     RowBox[{
      RowBox[{"Norm", "[", 
       RowBox[{"\[Pi]1", ",", "2"}], "]"}], "^", "2"}]}], ")"}]}]}]], "Input",\

 CellLabel->"In[17]:=",ExpressionUUID->"5ac3064b-992a-4979-92b7-757c550fe1d2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vecReshape", "[", 
   RowBox[{"target_", ",", "source_"}], "]"}], ":=", 
  RowBox[{"partitionByLength", "[", 
   RowBox[{"target", ",", 
    RowBox[{"Length", "/@", "source"}]}], "]"}]}]], "Input",
 CellLabel->"In[18]:=",ExpressionUUID->"13aaad66-4b27-4eb6-9ae0-d8df6835d4fe"],

Cell[BoxData[
 RowBox[{
  RowBox[{"covariateScaling", "[", 
   RowBox[{
   "\[CapitalPi]0_", ",", "\[CapitalPi]1_", ",", "\[Pi]0_", ",", "f1_"}], 
   "]"}], ":=", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ploidyVecs", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"vecReshape", "[", 
           RowBox[{"#", ",", "f1"}], "]"}], "&"}], "/@", 
         RowBox[{"Tuples", "[", 
          RowBox[{
           RowBox[{"Range", "[", "3", "]"}], ",", 
           RowBox[{"Length", "@", 
            RowBox[{"Flatten", "[", "f1", "]"}]}]}], "]"}]}], ",", 
        RowBox[{"x_", "/;", 
         RowBox[{
          RowBox[{"Total", "[", "x", "]"}], ">=", "6"}]}]}], "]"}]}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"SortBy", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"c", "=", 
             RowBox[{"computeC", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"\[Pi]0", ",", 
                 RowBox[{"2", "+", 
                  RowBox[{"MapThread", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#1", ".", 
                    RowBox[{"(", 
                    RowBox[{"#2", "-", "2"}], ")"}]}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"f1", ",", "p"}], "}"}]}], "]"}]}]}], "}"}], ",", 
               
               RowBox[{"{", 
                RowBox[{"\[CapitalPi]0", ",", "\[CapitalPi]1"}], "}"}]}], 
              "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Norm", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"c", "*", "\[Pi]0"}], "-", "\[CapitalPi]0"}], ",", 
                 "2"}], "]"}], "^", "2"}], "+", 
              RowBox[{
               RowBox[{"Norm", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"c", "*", 
                   RowBox[{"(", 
                    RowBox[{"2", "+", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#1", ".", 
                    RowBox[{"(", 
                    RowBox[{"#2", "-", "2"}], ")"}]}], "&"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"f1", ",", "p"}], "}"}]}], "]"}]}], ")"}]}], "-", 
                  "\[CapitalPi]1"}], ",", "2"}], "]"}], "^", "2"}]}], ",", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"Transpose", "[", 
                RowBox[{"{", "\[Pi]0", "}"}], "]"}], ",", "p"}], "]"}], ",", 
             "c"}], "}"}]}], "\[IndentingNewLine]", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"p", ",", "ploidyVecs"}], "}"}]}], "\[IndentingNewLine]", 
        "]"}], ",", "\[IndentingNewLine]", "First"}], "\[IndentingNewLine]", 
      "]"}], "\[LeftDoubleBracket]", 
     RowBox[{"1", ",", 
      RowBox[{"2", ";;"}]}], "\[RightDoubleBracket]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.826721307477469*^9, 3.826721392288973*^9}, {
  3.826821092136158*^9, 3.826821114559198*^9}, {3.835189266840967*^9, 
  3.835189295081232*^9}, {3.8352977177825823`*^9, 3.8352977377145147`*^9}},
 CellLabel->"In[19]:=",ExpressionUUID->"e6018014-1bb3-4866-bce6-2f57b50e0fd2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"rawToCorrected", "[", 
   RowBox[{"x_", ",", "filter_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"SameQ", "[", 
     RowBox[{
      RowBox[{"Head", "[", "x", "]"}], ",", "List"}], "]"}], ",", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Median", "[", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{"#", ",", 
             RowBox[{"Min", "@", "#"}]}], "]"}]}], "]"}], "&"}], "@", 
        RowBox[{"Abs", "[", 
         RowBox[{"k", "-", "filter"}], "]"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"k", ",", "x"}], "}"}]}], "]"}], ",", 
    RowBox[{"Round", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Median", "[", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Position", "[", 
          RowBox[{"#", ",", 
           RowBox[{"Min", "@", "#"}]}], "]"}]}], "]"}], "&"}], "@", 
      RowBox[{"Abs", "[", 
       RowBox[{"x", "-", "filter"}], "]"}]}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.8174086688304768`*^9, 3.817408740209206*^9}, {
  3.817408992265951*^9, 3.817409014990398*^9}, {3.817409057760107*^9, 
  3.817409105710043*^9}, {3.817409136225219*^9, 3.8174091420154743`*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"ab3e608e-9859-47a5-bdba-4711922ce2dd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"xTo\[Chi]", "[", "x_", "]"}], ":=", 
  RowBox[{"First", "@", 
   RowBox[{"Flatten", "@", 
    RowBox[{"Position", "[", 
     RowBox[{
      RowBox[{"Partition", "[", 
       RowBox[{"corrchromlocations", ",", "2", ",", "1"}], "]"}], ",", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           "<=", "x", "<", 
          RowBox[{
          "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
         "&"}], ")"}]}], ",", 
      RowBox[{"{", "1", "}"}], ",", 
      RowBox[{"Heads", "\[Rule]", "False"}]}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.848930679115543*^9, 3.848930773374988*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"d7406bd3-afc9-46c6-b9e3-8a313a6feadc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"numericalFit", "=", 
       RowBox[{"Function", "[", 
        RowBox[{"xy", ",", 
         RowBox[{"LinearModelFit", "[", 
          RowBox[{"xy", ",", 
           RowBox[{"Array", "[", 
            RowBox[{"c", ",", "3"}], "]"}], ",", 
           RowBox[{"Array", "[", 
            RowBox[{"c", ",", "3"}], "]"}]}], "]"}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"data", "=", "fixCdata"}], ",", "\[IndentingNewLine]", 
      "cResults", ",", "\[IndentingNewLine]", "fullModel", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"compartmentPos", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"Join", "@@", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{
               RowBox[{
               "compartments", "\[LeftDoubleBracket]", "rPos", 
                "\[RightDoubleBracket]"}], ",", "2"}], "]"}]}], ",", "#"}], 
           "]"}], "]"}], "&"}], "/@", 
        RowBox[{"Rest", "[", "compartmentnames", "]"}]}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"compartmentRules", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"Rest", "[", "compartmentnames", "]"}], "->", 
         RowBox[{"Range", "[", "5", "]"}]}], "]"}]}]}], "\[IndentingNewLine]",
      "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"cResults", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"numericalFit", "[", 
         RowBox[{"data", "\[LeftDoubleBracket]", 
          RowBox[{"#", ",", 
           RowBox[{"2", ";;"}]}], "\[RightDoubleBracket]"}], "]"}], "&"}], "/@",
        "compartmentPos"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fullModel", "=", 
      RowBox[{"Function", "[", 
       RowBox[{"x", ",", 
        RowBox[{
         RowBox[{"cResults", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{
           "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "/.", 
           "compartmentRules"}], "\[RightDoubleBracket]"}], "@@", 
         RowBox[{"(", 
          RowBox[{"Rest", "@", "x"}], ")"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fixCcorrector", "=", "\[IndentingNewLine]", 
      RowBox[{"Function", "[", 
       RowBox[{"test", ",", "\[IndentingNewLine]", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"testData", "=", 
            RowBox[{
             RowBox[{"Transpose", "[", 
              RowBox[{"Prepend", "[", 
               RowBox[{
                RowBox[{"Append", "[", 
                 RowBox[{"covariates", ",", "test"}], "]"}], ",", 
                "compartments"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
             "rPos", "\[RightDoubleBracket]"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"2", 
             RowBox[{"Normalize", "[", 
              RowBox[{
               RowBox[{"MedianFilter", "[", 
                RowBox[{"#", ",", "1"}], "]"}], ",", "findDiploidPeak"}], 
              "]"}]}], "&"}], "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"testData", "\[LeftDoubleBracket]", 
              RowBox[{";;", ",", 
               RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"fullModel", "[", 
                 RowBox[{"Most", "@", "#"}], "]"}], "&"}], "/@", "testData"}],
               ")"}]}], ")"}]}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]", "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.847677939634677*^9, 3.847677942275828*^9}, {
   3.847678004964967*^9, 3.847678014625146*^9}, {3.84767806291667*^9, 
   3.847678261311301*^9}, 3.847678294519857*^9, {3.847678325452094*^9, 
   3.8476784101318007`*^9}, {3.847678471663632*^9, 3.847678547436536*^9}, {
   3.847678587053217*^9, 3.847678703901628*^9}, 3.8476788398890142`*^9, {
   3.847678894483871*^9, 3.84767893546694*^9}, {3.847678973848773*^9, 
   3.847679337187613*^9}, {3.847679374319749*^9, 3.847679498767658*^9}, {
   3.8476795483476553`*^9, 3.84767959331147*^9}, {3.847679846382914*^9, 
   3.847679893381679*^9}, {3.8476800357387342`*^9, 3.847680038461199*^9}, {
   3.847680242202009*^9, 3.8476804012173243`*^9}, 3.847680528154668*^9, {
   3.847680568690547*^9, 3.847680568721201*^9}, {3.847680764335506*^9, 
   3.847680773414716*^9}, {3.8477243986783667`*^9, 3.847724449633008*^9}, {
   3.8477244946890087`*^9, 3.847724579703965*^9}, {3.8477246135393867`*^9, 
   3.847724617805505*^9}, {3.847724794215609*^9, 3.847724804209828*^9}, {
   3.847724836141059*^9, 3.847724836884899*^9}, {3.847730527718492*^9, 
   3.847730528733129*^9}, {3.8484124345619593`*^9, 3.848412528757122*^9}, {
   3.848412565110765*^9, 3.8484126084261703`*^9}, {3.848412655238205*^9, 
   3.8484126974844303`*^9}, 3.848412756785192*^9, 3.848542665167342*^9, {
   3.851391396462916*^9, 3.851391397006632*^9}, {3.862753245711194*^9, 
   3.8627532470369377`*^9}},
 CellLabel->"In[22]:=",ExpressionUUID->"c924a235-70dd-475d-9709-8fcc5c79fa42"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"numericalFit", "=", 
       RowBox[{"Function", "[", 
        RowBox[{"xy", ",", 
         RowBox[{"LinearModelFit", "[", 
          RowBox[{"xy", ",", 
           RowBox[{"Array", "[", 
            RowBox[{"c", ",", "3"}], "]"}], ",", 
           RowBox[{"Array", "[", 
            RowBox[{"c", ",", "3"}], "]"}]}], "]"}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"data", "=", "hiCdata"}], ",", "\[IndentingNewLine]", 
      "cResults", ",", "\[IndentingNewLine]", "fullModel", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"compartmentPos", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{
            "compartments", "\[LeftDoubleBracket]", "rPos", 
             "\[RightDoubleBracket]"}], ",", "#"}], "]"}], "]"}], "&"}], "/@", 
        RowBox[{"Rest", "[", "compartmentnames", "]"}]}]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"cResults", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"numericalFit", "[", 
         RowBox[{"data", "\[LeftDoubleBracket]", 
          RowBox[{"#", ",", 
           RowBox[{"2", ";;"}]}], "\[RightDoubleBracket]"}], "]"}], "&"}], "/@",
        "compartmentPos"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"fullModel", "=", 
      RowBox[{"Function", "[", 
       RowBox[{"x", ",", 
        RowBox[{
         RowBox[{"cResults", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{
           "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "/.", 
           
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Rest", "[", "compartmentnames", "]"}], "->", 
             RowBox[{"Range", "[", "5", "]"}]}], "]"}]}], 
          "\[RightDoubleBracket]"}], "@@", 
         RowBox[{"(", 
          RowBox[{"Rest", "@", "x"}], ")"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"hiCcorrector", "=", "\[IndentingNewLine]", 
      RowBox[{"Function", "[", 
       RowBox[{"test", ",", "\[IndentingNewLine]", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"testData", "=", 
            RowBox[{
             RowBox[{"Transpose", "[", 
              RowBox[{"Prepend", "[", 
               RowBox[{
                RowBox[{"Append", "[", 
                 RowBox[{"covariates", ",", "test"}], "]"}], ",", 
                "compartments"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
             "rPos", "\[RightDoubleBracket]"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"2", 
             RowBox[{"Normalize", "[", 
              RowBox[{
               RowBox[{"MedianFilter", "[", 
                RowBox[{"#", ",", "100"}], "]"}], ",", "findDiploidPeak"}], 
              "]"}]}], "&"}], "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"testData", "\[LeftDoubleBracket]", 
              RowBox[{";;", ",", 
               RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"fullModel", "[", 
                 RowBox[{"Most", "@", "#"}], "]"}], "&"}], "/@", "testData"}],
               ")"}]}], ")"}]}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]", "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.847677939634677*^9, 3.847677942275828*^9}, {
   3.847678004964967*^9, 3.847678014625146*^9}, {3.84767806291667*^9, 
   3.847678261311301*^9}, 3.847678294519857*^9, {3.847678325452094*^9, 
   3.8476784101318007`*^9}, {3.847678471663632*^9, 3.847678547436536*^9}, {
   3.847678587053217*^9, 3.847678703901628*^9}, 3.8476788398890142`*^9, {
   3.847678894483871*^9, 3.84767893546694*^9}, {3.847678973848773*^9, 
   3.847679337187613*^9}, {3.847679374319749*^9, 3.847679498767658*^9}, {
   3.8476795483476553`*^9, 3.84767959331147*^9}, {3.847679846382914*^9, 
   3.847679893381679*^9}, {3.8476800357387342`*^9, 3.847680038461199*^9}, {
   3.847680242202009*^9, 3.8476804012173243`*^9}, 3.847680528154668*^9, {
   3.847680568690547*^9, 3.847680568721201*^9}, {3.847680764335506*^9, 
   3.847680773414716*^9}, {3.8477243986783667`*^9, 3.847724449633008*^9}, {
   3.8477244946890087`*^9, 3.847724579703965*^9}, {3.8477246135393867`*^9, 
   3.847724617805505*^9}, {3.847724794215609*^9, 3.847724804209828*^9}, {
   3.847724836141059*^9, 3.847724855955763*^9}, {3.847730555699164*^9, 
   3.8477305566667643`*^9}, {3.862753344748958*^9, 3.862753345591564*^9}},
 CellLabel->"In[23]:=",ExpressionUUID->"191dc58c-6c2c-451d-b138-431a17634244"]
}, Closed]],

Cell[CellGroupData[{

Cell["Copy Number & Mixture Proportion Estimation", "Chapter",
 CellChangeTimes->{{3.848932372335496*^9, 3.8489323878401823`*^9}, {
  3.86025138896563*^9, 
  3.860251412773046*^9}},ExpressionUUID->"2ee84f0a-fb76-4f27-ab69-\
6e643c7fd472"],

Cell[TextData[StyleBox["Function definitions calculating effective copy \
number profiles.",
 FontSlant->"Italic"]], "Text",
 CellFrame->{{0, 0}, {2, 0}},
 CellFrameColor->GrayLevel[0.75],
 CellChangeTimes->{{3.860248806085986*^9, 3.860248864968273*^9}, {
  3.860249201433004*^9, 3.860249217768318*^9}, {3.860251508740262*^9, 
  3.860251523723233*^9}},
 FontSize->18,ExpressionUUID->"0901cfe1-fe18-4c87-b743-c1577c877ec2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"splitList", "[", 
   RowBox[{"list_", ",", "index_"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"list", "\[LeftDoubleBracket]", 
       RowBox[{";;", "index"}], "\[RightDoubleBracket]"}], ",", 
      RowBox[{"list", "\[LeftDoubleBracket]", 
       RowBox[{
        RowBox[{"index", "+", "1"}], ";;"}], "\[RightDoubleBracket]"}]}], 
     "}"}], ",", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1.", "index"}], ",", 
       RowBox[{
        RowBox[{"1.", 
         RowBox[{"Length", "[", "list", "]"}]}], "-", "index"}]}], "}"}], "/", 
     RowBox[{"Length", "[", "list", "]"}]}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.84845763329681*^9, 3.848457653679579*^9}, {
  3.848457764691599*^9, 3.848457815122281*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"aa1becbf-a1f4-416d-b986-99222f96a6bf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"findRestrictedMedian", "[", 
   RowBox[{"list_", ",", "candidates_"}], "]"}], ":=", "\[IndentingNewLine]", 
  
  RowBox[{
   RowBox[{
    RowBox[{"With", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"minPos", "=", 
        RowBox[{"First", "@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"Position", "[", 
           RowBox[{"#", ",", 
            RowBox[{"Min", "@", "#"}]}], "]"}]}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
        "candidates", "\[LeftDoubleBracket]", "minPos", 
         "\[RightDoubleBracket]"}], ",", 
        RowBox[{
        "#", "\[LeftDoubleBracket]", "minPos", "\[RightDoubleBracket]"}], ",", 
        RowBox[{"MedianDeviation", "[", "list", "]"}]}], "}"}]}], 
     "\[IndentingNewLine]", "]"}], "&"}], "@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Function", "[", 
      RowBox[{"candidate", ",", 
       RowBox[{"Mean", "@", 
        RowBox[{"Abs", "[", 
         RowBox[{"list", "-", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"candidate", ",", 
            RowBox[{"Length", "@", "list"}]}], "]"}]}], "]"}]}]}], "]"}], "/@",
      "candidates"}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.8497976020449877`*^9, 3.849797627585451*^9}, {
   3.849797664465077*^9, 3.849797747572764*^9}, {3.8497977846270123`*^9, 
   3.8497977850281076`*^9}, 3.849797946112939*^9, {3.8497985269674883`*^9, 
   3.849798527975361*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"4ae00ebb-797f-4962-9a64-61a4b3198b2e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"findSplit", "[", 
   RowBox[{"data_", ",", "candidates_"}], "]"}], ":=", "\[IndentingNewLine]", 
  
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"First", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Position", "[", 
         RowBox[{"#", ",", 
          RowBox[{"Min", "@", "#"}]}], "]"}]}]}], ",", 
      RowBox[{"Min", "@", "#"}]}], "}"}], "&"}], "@", "\[IndentingNewLine]", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"splits", "=", 
          RowBox[{"splitList", "[", 
           RowBox[{"data", ",", "#"}], "]"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Total", "[", 
             RowBox[{
              RowBox[{"findRestrictedMedian", "[", 
               RowBox[{"#", ",", "candidates"}], "]"}], 
              "\[LeftDoubleBracket]", 
              RowBox[{"{", 
               RowBox[{"2", ",", "3"}], "}"}], "\[RightDoubleBracket]"}], 
             "]"}], "&"}], "/@", 
           RowBox[{
           "splits", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
           ")"}], ".", 
         RowBox[{
         "splits", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}],
        "\[IndentingNewLine]", "]"}], "&"}], "/@", 
     RowBox[{"Range", "[", 
      RowBox[{"2", ",", 
       RowBox[{
        RowBox[{"Length", "[", "data", "]"}], "-", "2"}]}], "]"}]}], 
    ")"}]}]}]], "Input",
 CellChangeTimes->{{3.848457577538376*^9, 3.848457617061921*^9}, {
   3.848457666770795*^9, 3.8484577538325653`*^9}, {3.848457789935951*^9, 
   3.848457790463477*^9}, {3.848457823664171*^9, 3.848457867400619*^9}, 
   3.848458005988246*^9, {3.848458042590592*^9, 3.848458045126951*^9}, {
   3.848586833353471*^9, 3.848586837704228*^9}, {3.84858688456287*^9, 
   3.848586905962875*^9}, {3.84858695922766*^9, 3.848586966563512*^9}, {
   3.8485888314629517`*^9, 3.8485888835400763`*^9}, {3.84858891882626*^9, 
   3.848588920554611*^9}, {3.849797997980447*^9, 3.849797998902549*^9}},
 CellLabel->"In[26]:=",ExpressionUUID->"db299511-9ff7-4690-bdf5-605e1727550a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"paddedPartition", "[", 
   RowBox[{"list_", ",", "window_"}], "]"}], ":=", 
  RowBox[{"Join", "[", 
   RowBox[{
    RowBox[{"ConstantArray", "[", 
     RowBox[{
      RowBox[{"list", "\[LeftDoubleBracket]", 
       RowBox[{";;", "window"}], "\[RightDoubleBracket]"}], ",", 
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"window", "-", "1"}], ")"}], "/", "2"}], "]"}]}], "]"}], ",", 
    RowBox[{"Partition", "[", 
     RowBox[{"list", ",", "window", ",", "1"}], "]"}], ",", 
    RowBox[{"ConstantArray", "[", 
     RowBox[{
      RowBox[{"list", "\[LeftDoubleBracket]", 
       RowBox[{";;", "window"}], "\[RightDoubleBracket]"}], ",", 
      RowBox[{"Floor", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"window", "-", "1"}], ")"}], "/", "2"}], "]"}]}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.848584413158887*^9, 3.8485844552627153`*^9}, {
  3.848584520237442*^9, 3.848584562113776*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"9b3b4d12-39ba-48ba-b188-ce77dc8d72ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"copyNumberFilter", "[", 
   RowBox[{"data_", ",", "candidates_", ",", 
    RowBox[{"window_", ":", "101"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"findRestrictedMedian", "[", 
     RowBox[{"#", ",", "candidates"}], "]"}], "&"}], "/@", 
   RowBox[{"paddedPartition", "[", 
    RowBox[{"data", ",", "window"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.848584595106155*^9, 3.848584605994673*^9}, {
  3.8497978607988167`*^9, 3.8497978610308237`*^9}},
 CellLabel->"In[28]:=",ExpressionUUID->"6fa73d8a-a093-43bf-b146-958b71487237"],

Cell[BoxData[
 RowBox[{
  RowBox[{"copyNumberVariance", "[", 
   RowBox[{"data_", ",", "candidates_", ",", 
    RowBox[{"window_", ":", "101"}]}], "]"}], ":=", 
  RowBox[{"Mean", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "*", 
         RowBox[{
          RowBox[{"#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
           "/", 
          RowBox[{
          "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}]}], 
        "&"}], "@", 
       RowBox[{"findRestrictedMedian", "[", 
        RowBox[{"#", ",", "candidates"}], "]"}]}], ")"}], "&"}], "/@", 
    RowBox[{"paddedPartition", "[", 
     RowBox[{"data", ",", "window"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.848583860375669*^9, 3.848583887881639*^9}, {
  3.8485840731754704`*^9, 3.848584073216057*^9}, {3.848584610147379*^9, 
  3.848584620266561*^9}, {3.848587454505837*^9, 3.848587460328545*^9}, {
  3.8485874953981943`*^9, 3.84858750122668*^9}, {3.8489325226471653`*^9, 
  3.8489325239716454`*^9}, {3.848932592851403*^9, 3.848932593022284*^9}, {
  3.8489326326065063`*^9, 3.848932643983508*^9}, {3.849797877434276*^9, 
  3.849797877766576*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"291ab902-4e6c-40b3-b96d-73d89ff94127"],

Cell[BoxData[
 RowBox[{
  RowBox[{"listCandidates", "[", 
   RowBox[{"f_", ",", "maxPloidy_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"1", "-", "f"}], ")"}], "*", "2"}], "+", 
   RowBox[{"f", "*", 
    RowBox[{"Range", "[", "maxPloidy", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.848932826270204*^9, 3.8489328743723907`*^9}},
 CellLabel->"In[30]:=",ExpressionUUID->"0d71a6e0-5903-4cea-99eb-f377c2f217ae"],

Cell[BoxData[
 RowBox[{
  RowBox[{"computeChangePoints", "[", "profile_", "]"}], ":=", 
  RowBox[{"Flatten", "@", 
   RowBox[{
    RowBox[{"SparseArray", "[", 
     RowBox[{"Differences", "@", "profile"}], "]"}], "[", 
    "\"\<NonzeroPositions\>\"", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.84858620917206*^9, 3.8485862411758347`*^9}, {
  3.8485863158322906`*^9, 3.848586329232765*^9}, {3.848586507142788*^9, 
  3.848586530510799*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"fed23639-80ec-4f12-a5c2-f77866d65f57"],

Cell[BoxData[
 RowBox[{
  RowBox[{"refineChangePoint", "[", 
   RowBox[{"data_", ",", "pt_", ",", "candidates_", ",", 
    RowBox[{"window_", ":", "250"}], ",", 
    RowBox[{"replicates_", ":", "100"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"w", "=", 
       RowBox[{"Round", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"window", "-", "1"}], ")"}], "/", "2"}], "]"}]}], ",", 
      "\[IndentingNewLine]", "split"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"split", "=", 
      RowBox[{"findSplit", "[", 
       RowBox[{
        RowBox[{"data", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"pt", "-", "w"}], ";;", 
          RowBox[{"pt", "+", "w"}]}], "\[RightDoubleBracket]"}], ",", 
        "candidates"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"pt", "-", "w", "-", "1", "+", 
        RowBox[{
        "split", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
       ",", 
       RowBox[{"1", "-", 
        RowBox[{"CDF", "[", 
         RowBox[{
          RowBox[{"EmpiricalDistribution", "@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"findSplit", "[", 
               RowBox[{
                RowBox[{"RandomChoice", "[", 
                 RowBox[{
                  RowBox[{"data", "\[LeftDoubleBracket]", 
                   RowBox[{
                    RowBox[{"pt", "-", "w"}], ";;", 
                    RowBox[{"pt", "+", "w"}]}], "\[RightDoubleBracket]"}], 
                  ",", 
                  RowBox[{
                   RowBox[{"2", "w"}], "+", "1"}]}], "]"}], ",", 
                "candidates"}], "]"}], "\[LeftDoubleBracket]", 
              RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], ",", 
             "replicates"}], "]"}]}], ",", 
          RowBox[{"split", "\[LeftDoubleBracket]", 
           RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}]}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.848586545891429*^9, 3.8485866147022533`*^9}, {
  3.848590721554636*^9, 3.848590721969763*^9}, {3.848591079087871*^9, 
  3.848591094071383*^9}, {3.848591215385952*^9, 3.848591322113524*^9}, {
  3.848591373401731*^9, 3.848591448148045*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"0661b12a-8332-4fed-b7e1-981c0112c6e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"refineChangePoints", "[", 
   RowBox[{"data_", ",", "pts_", ",", "candidates_", ",", 
    RowBox[{"window_", ":", "250"}], ",", 
    RowBox[{"replicates_", ":", "100"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"ws", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Min", "[", 
         RowBox[{"Append", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Differences", "@", "#"}], "/", "2"}], ",", "window"}], 
          "]"}], "]"}], "&"}], "/@", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", "1", "}"}], ",", "pts", ",", 
           RowBox[{"{", 
            RowBox[{"Length", "@", "rPos"}], "}"}]}], "]"}], ",", "3", ",", 
         "1"}], "]"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"MapThread", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"#2", "<=", "3.5"}], ",", 
         RowBox[{"{", 
          RowBox[{"#1", ",", "0"}], "}"}], ",", 
         RowBox[{"refineChangePoint", "[", 
          RowBox[{
          "data", ",", "#1", ",", "candidates", ",", "#2", ",", 
           "replicates"}], "]"}]}], "]"}], "&"}], ",", 
      RowBox[{"{", 
       RowBox[{"pts", ",", "ws"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8485917673650723`*^9, 3.848591864028267*^9}, {
  3.848591905188418*^9, 3.848592080762035*^9}, {3.848592444855857*^9, 
  3.848592445109432*^9}, {3.8485925323500347`*^9, 3.848592572362092*^9}, {
  3.848933510564518*^9, 3.848933511053522*^9}, {3.848933546960599*^9, 
  3.8489335470121517`*^9}, {3.849799074368279*^9, 3.849799074446425*^9}, {
  3.849799788775137*^9, 3.849799788911818*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"7afb3cfd-601f-4735-a0d6-87c6014eceb8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"refineProfile", "[", 
   RowBox[{"profile_", ",", "pts_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"intervals", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", "0", "}"}], ",", "pts", ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", "rPos", "]"}], "}"}]}], "]"}], ",", "2", 
        ",", "1"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Join", "@@", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"ConstantArray", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"First", "@", 
           RowBox[{"Commonest", "[", 
            RowBox[{
             RowBox[{"profile", "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{
                RowBox[{"First", "[", "#", "]"}], "+", "1"}], ";;", 
               RowBox[{"Last", "[", "#", "]"}]}], "\[RightDoubleBracket]"}], 
             ",", "1"}], "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"-", 
           RowBox[{"Subtract", "@@", "#"}]}]}], "\[IndentingNewLine]", "]"}], 
        "&"}], "/@", "intervals"}], "\[IndentingNewLine]", ")"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8485926457477207`*^9, 3.848592653623744*^9}, {
  3.8485926862775297`*^9, 3.848592767035623*^9}, {3.848592817620635*^9, 
  3.848592851268869*^9}, {3.848592907376889*^9, 3.8485929724354753`*^9}, {
  3.848593013171598*^9, 3.848593100937935*^9}, {3.8485931492612543`*^9, 
  3.848593171930582*^9}, {3.850793521372559*^9, 3.850793534715744*^9}},
 CellLabel->"In[34]:=",ExpressionUUID->"31a709df-5dc8-4383-a250-816f8d7da015"],

Cell[BoxData[
 RowBox[{
  RowBox[{"flattenExcursions", "[", 
   RowBox[{"profile_", ",", 
    RowBox[{"threshold_", ":", "200"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pts", "=", 
       RowBox[{"Flatten", "@", 
        RowBox[{
         RowBox[{"SparseArray", "[", 
          RowBox[{"Differences", "@", "profile"}], "]"}], "[", 
         "\"\<NonzeroPositions\>\"", "]"}]}]}], ",", "\[IndentingNewLine]", 
      "partitionedProfile", ",", "pos"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"partitionedProfile", "=", 
      RowBox[{"partitionByIndex", "[", 
       RowBox[{"profile", ",", "pts"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pos", "=", 
      RowBox[{"Flatten", "@", 
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Length", "/@", "partitionedProfile"}], ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "<=", "threshold"}], "&"}], ")"}]}]}], "]"}]}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Join", "@@", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"n", "=", 
             RowBox[{"Length", "[", 
              RowBox[{
              "partitionedProfile", "\[LeftDoubleBracket]", "#", 
               "\[RightDoubleBracket]"}], "]"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"n", "<=", "threshold"}], ")"}], "&&", 
              RowBox[{"(", 
               RowBox[{"1", "<", "#", "<", 
                RowBox[{"Length", "[", "partitionedProfile", "]"}]}], ")"}]}],
              ",", "\[IndentingNewLine]", 
             RowBox[{"Join", "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"ConstantArray", "[", 
                 RowBox[{
                  RowBox[{"partitionedProfile", "\[LeftDoubleBracket]", 
                   RowBox[{
                    RowBox[{"#", "-", "1"}], ",", "1"}], 
                   "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"Floor", "[", 
                   RowBox[{"n", "/", "2"}], "]"}]}], "]"}], ",", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{
                  RowBox[{"partitionedProfile", "\[LeftDoubleBracket]", 
                   RowBox[{
                    RowBox[{"#", "+", "1"}], ",", "1"}], 
                   "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"Ceiling", "[", 
                   RowBox[{"n", "/", "2"}], "]"}]}], "]"}]}], "}"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
             "partitionedProfile", "\[LeftDoubleBracket]", "#", 
              "\[RightDoubleBracket]"}]}], "\[IndentingNewLine]", "]"}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "@", "partitionedProfile"}], "]"}]}], 
       "\[IndentingNewLine]", ")"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.85079358958677*^9, 3.850794018330064*^9}, {
  3.850794064194355*^9, 3.850794126848068*^9}, {3.85079418364657*^9, 
  3.85079421606581*^9}, {3.850794250164933*^9, 3.850794284607287*^9}, {
  3.856977345544794*^9, 3.856977346135783*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"b5aeb345-1d68-46be-8340-d79719479fdf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"rankExcursions", "[", 
   RowBox[{"data_", ",", "refinedProfile_", ",", "changePoints_"}], "]"}], ":=",
   "\[IndentingNewLine]", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"partitionedProfile", "=", 
       RowBox[{"partitionByIndex", "[", 
        RowBox[{"refinedProfile", ",", 
         RowBox[{"changePoints", "\[LeftDoubleBracket]", 
          RowBox[{";;", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], ",",
       "\[IndentingNewLine]", 
      RowBox[{"partitionedData", "=", 
       RowBox[{"partitionByIndex", "[", 
        RowBox[{"data", ",", 
         RowBox[{"changePoints", "\[LeftDoubleBracket]", 
          RowBox[{";;", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], ",",
       "\[IndentingNewLine]", 
      RowBox[{"\[ScriptCapitalH]0", "=", 
       RowBox[{"Pick", "[", 
        RowBox[{"data", ",", "refinedProfile", ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"1.999", "<=", "#", "<=", "2.001"}], "&"}], ")"}]}]}], 
        "]"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"intervalP", "=", 
       RowBox[{"Total", "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", "0.5", "}"}], ",", 
            RowBox[{"changePoints", "\[LeftDoubleBracket]", 
             RowBox[{";;", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
            RowBox[{"{", "0.5", "}"}]}], "]"}], ",", "2", ",", "1"}], 
         "]"}]}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"extractBulk", "=", 
       RowBox[{"Function", "[", 
        RowBox[{"list", ",", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"n", "=", 
             RowBox[{"Max", "[", 
              RowBox[{
               RowBox[{"Round", "[", 
                RowBox[{"0.2", 
                 RowBox[{"Length", "@", "list"}]}], "]"}], ",", "1"}], 
              "]"}]}], "}"}], ",", 
           RowBox[{"list", "\[LeftDoubleBracket]", 
            RowBox[{"n", ";;", 
             RowBox[{"-", "n"}]}], "\[RightDoubleBracket]"}]}], "]"}]}], 
        "]"}]}], ",", "\[IndentingNewLine]", "diploidBlocks", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"findClosestDiploidBlock", "=", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"blocks", ",", "k"}], "}"}], ",", 
         RowBox[{"DeleteMissing", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"FirstCase", "[", 
             RowBox[{
              RowBox[{"Reverse", "@", "blocks"}], ",", 
              RowBox[{"_", "?", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#", "<", "k"}], "&"}], ")"}]}]}], "]"}], ",", 
            RowBox[{"FirstCase", "[", 
             RowBox[{"blocks", ",", 
              RowBox[{"_", "?", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#", ">", "k"}], "&"}], ")"}]}]}], "]"}]}], "}"}], 
          "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"diploidBlocks", "=", 
      RowBox[{"Flatten", "@", 
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"First", "/@", "partitionedProfile"}], ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"1.999", "<=", "#", "<=", "2.001"}], "&"}], ")"}]}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"CDF", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"UniformSumDistribution", "@", "2"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"MapThread", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Max", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"1.", "-", 
               RowBox[{"CDF", "[", 
                RowBox[{
                 RowBox[{"EmpiricalDistribution", "[", 
                  RowBox[{"MedianDeviation", "/@", 
                   RowBox[{"RandomChoice", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "@", 
                    RowBox[{"partitionedData", "\[LeftDoubleBracket]", 
                    RowBox[{"findClosestDiploidBlock", "[", 
                    RowBox[{"diploidBlocks", ",", "#3"}], "]"}], 
                    "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"100", ",", 
                    RowBox[{"Length", "@", 
                    RowBox[{"extractBulk", "@", "#1"}]}]}], "}"}]}], "]"}]}], 
                  "]"}], ",", 
                 RowBox[{
                  RowBox[{"2", "/", 
                   RowBox[{
                   "#1", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}], "*", 
                  RowBox[{"MedianDeviation", "[", 
                   RowBox[{"extractBulk", "@", "#2"}], "]"}]}]}], "]"}]}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{"1.", "*", 
               RowBox[{"CDF", "[", 
                RowBox[{"excursionLengths\[ScriptCapitalH]0", ",", 
                 RowBox[{"Length", "@", "#1"}]}], "]"}]}]}], 
             "\[IndentingNewLine]", "]"}], "^", "2"}], "&"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"partitionedProfile", ",", "partitionedData", ",", 
            RowBox[{"Range", "@", 
             RowBox[{"Length", "@", "partitionedProfile"}]}]}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], "+", "\[IndentingNewLine]", 
        RowBox[{"CDF", "[", 
         RowBox[{
          RowBox[{"UniformSumDistribution", "@", "2"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Total", "[", "#", "]"}], "&"}], "/@", "intervalP"}]}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwdz11I02EYBfC5XUggLIvlDDVXLZJRSM1qEtpqYSpOGjQNbOHCQpGUTcaq
IRMTqaWyD13WtgKdRpttwZxbyfpYBK4heaEuHStyFbaZjgwMDPuf9+Lhd3E4
Bx6OvEXSQKfRaIXUwc+amWsPnUlhUBprhE1hpQr2PBlWw+qTX7QwJt3fAd/4
atgWysZ2226oSWn3wYyx31xoqk3ySL6lPQRzX9r40BG2EydakifgEUNAANtn
oqWkF31UBldmI2IoGQych3lZ5gswxpBdh4yVyZuQby3ogFsbfj0MZ4eJClHN
fbgWuzRIdmTlVsiarSdeZqdeQFld6yuY79l8B9069TQsnioRLj9LCs19XqLB
qq6CMs4uMdyrOJbW56b+3vxFHDBF+mHcPDwAv+kqh+CI/fAI7Ln71wUb5OPP
Id1WydRTrjJN2+HRt9MeL+UpVqcXFg4xg9DW/GcRbjy98RXSi78T52zVTROU
WVZ7Gwzdy7kFM2qniCxLVxdMeuNEcdE5HfTKW4mmtp96mGdmGWH0/UEn7M3/
54cagSsO2Z2OH9DYq8j0UaoSc0Sl87UEKgqapdDNENXDUEB0BVYcHzfABd4D
I5x36xwhSjnnogsur1o/wXV75gL08CIpuEeV2PaBcjJYxYSPY0ri1XX/Tqg+
m86CdaEz2bBiqTQXJtPXuNDTvXQA5tzx8aFldLEI7hgTlMCEoKwcfuTO34an
+9O64X9f9riq
  "],
 CellLabel->"In[36]:=",ExpressionUUID->"46da96b6-4cc2-47a8-a4ea-02ae64eee66c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"extractExcursions", "[", 
   RowBox[{"profile_", ",", "points_"}], "]"}], ":=", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"excursionIndices", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", "0", "}"}], ",", "points", ",", 
           RowBox[{"{", 
            RowBox[{"Length", "@", "rPos"}], "}"}]}], "]"}], ",", "2", ",", 
         "1"}], "]"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"excursions", "=", 
       RowBox[{"partitionByIndex", "[", 
        RowBox[{"profile", ",", "points"}], "]"}]}]}], "\[IndentingNewLine]", 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Pick", "[", 
     RowBox[{
      RowBox[{"Range", "@", 
       RowBox[{"Length", "@", "excursionIndices"}]}], ",", 
      RowBox[{"Mean", "/@", "excursions"}], ",", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", "!=", "2."}], "&"}], ")"}]}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.850182111361178*^9, 3.850182120981037*^9}, {
  3.850182417713936*^9, 3.850182724407878*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"33843732-ab8b-4052-b834-382eb9141b76"],

Cell[BoxData[
 RowBox[{
  RowBox[{"discreteLocalMin", "[", 
   RowBox[{"list_", ",", "i_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"If", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"i", "==", "1"}], ")"}], "||", 
     RowBox[{"(", 
      RowBox[{"i", "==", 
       RowBox[{"Length", "[", "list", "]"}]}], ")"}]}], ",", 
    "\[IndentingNewLine]", "i", ",", "\[IndentingNewLine]", 
    RowBox[{"With", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{"i1", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"list", "\[LeftDoubleBracket]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", 
                RowBox[{"i", "+", "1"}]}], "}"}], "\[RightDoubleBracket]"}], 
             "-", 
             RowBox[{
             "list", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}],
             "]"}], ">=", "0"}], ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"First", "@", 
             RowBox[{"Flatten", "@", 
              RowBox[{"Position", "[", 
               RowBox[{"#", ",", 
                RowBox[{"Min", "@", "#"}]}], "]"}]}]}], "&"}], "@", 
           RowBox[{"list", "\[LeftDoubleBracket]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", 
              RowBox[{"i", "+", "1"}]}], "}"}], "\[RightDoubleBracket]"}]}]}],
          "]"}]}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"i1", "===", 
         RowBox[{"{", "}"}]}], ",", "i", ",", 
        RowBox[{"discreteLocalMin", "[", 
         RowBox[{"list", ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"i", "-", "1"}], ",", 
             RowBox[{"i", "+", "1"}]}], "}"}], "\[LeftDoubleBracket]", "i1", 
           "\[RightDoubleBracket]"}]}], "]"}]}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellChangeTimes->{{3.850184673809402*^9, 3.850184689846364*^9}, {
  3.850184723333558*^9, 3.850184919110022*^9}, {3.8501849743919783`*^9, 
  3.850185140714532*^9}, {3.850185173310239*^9, 3.850185209458394*^9}, {
  3.8501852683952837`*^9, 3.850185363030839*^9}, {3.850185405359336*^9, 
  3.850185406727697*^9}},
 CellLabel->"In[38]:=",ExpressionUUID->"da495d93-8b79-4f7c-b72c-511f9d949834"],

Cell[BoxData[
 RowBox[{
  RowBox[{"excursionLengths", "[", 
   RowBox[{"profile_", ",", "points_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pos", "=", 
      RowBox[{"extractExcursions", "[", 
       RowBox[{"profile", ",", "points"}], "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Length", "/@", 
     RowBox[{
      RowBox[{"partitionByIndex", "[", 
       RowBox[{"profile", ",", "points"}], "]"}], "\[LeftDoubleBracket]", 
      "pos", "\[RightDoubleBracket]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.850664194481421*^9, 3.8506642810058937`*^9}, {
  3.8506643220317497`*^9, 3.8506643236771793`*^9}, {3.853993113800989*^9, 
  3.8539931143581953`*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"cf94cd99-6ca9-4257-ade1-e0133e5ad722"],

Cell[BoxData[
 RowBox[{
  RowBox[{"benjaminiHochberg", "[", 
   RowBox[{"pvalues_", ",", "\[Alpha]_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ps", "=", 
      RowBox[{
       RowBox[{"Sort", "[", 
        RowBox[{"1", "-", "pvalues"}], "]"}], "-", 
       RowBox[{
        RowBox[{"\[Alpha]", "/", 
         RowBox[{"Length", "[", "pvalues", "]"}]}], "*", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "@", "pvalues"}], "]"}]}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"First", "[", 
     RowBox[{
      RowBox[{"FirstPosition", "[", 
       RowBox[{"ps", ",", 
        RowBox[{"_", "?", "Positive"}]}], "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Missing", "[", "\"\<NotFound\>\"", "]"}], "->", 
        RowBox[{"{", 
         RowBox[{"Length", "[", "ps", "]"}], "}"}]}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.850749199600423*^9, 3.850749310769767*^9}, {
  3.8507493624659452`*^9, 3.850749370611609*^9}, {3.8507494047716637`*^9, 
  3.8507494047942123`*^9}, {3.850788000344013*^9, 3.8507880204420757`*^9}, {
  3.850788099118651*^9, 3.8507881559689283`*^9}},
 CellLabel->"In[40]:=",ExpressionUUID->"6ef8c9b3-4ebe-4e38-b1a5-788c30e24564"],

Cell[BoxData[
 RowBox[{
  RowBox[{"computeFluctuations", "[", "copyNumbers_", "]"}], ":=", 
  RowBox[{"Median", "/@", 
   RowBox[{
    RowBox[{"SortBy", "[", 
     RowBox[{
      RowBox[{"GatherBy", "[", 
       RowBox[{"copyNumbers", ",", "First"}], "]"}], ",", "First"}], "]"}], 
    "\[LeftDoubleBracket]", 
    RowBox[{";;", ",", ";;", ",", "3"}], 
    "\[RightDoubleBracket]"}]}]}]], "Input",
 CellChangeTimes->{{3.851008985291098*^9, 3.85100901278323*^9}, {
  3.851009058191703*^9, 3.851009060655737*^9}},
 CellLabel->"In[41]:=",ExpressionUUID->"f6b38811-9d38-4c8b-813a-48fb86278c19"],

Cell[BoxData[
 RowBox[{
  RowBox[{"computeAtoms", "[", 
   RowBox[{"profile_", ",", "f_"}], "]"}], ":=", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"ploidies", "=", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Union", "[", "profile", "]"}], "->", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Union", "[", 
            RowBox[{"profile", "-", "2"}], "]"}], "/", "f"}], "+", "2"}], 
         ")"}]}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"#", ".", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"1", "/", 
            RowBox[{"Total", "@", 
             RowBox[{"#", "\[LeftDoubleBracket]", 
              RowBox[{";;", ",", 
               RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}]}]}]}], "}"}]}],
         "}"}]}], "&"}], "@", 
     RowBox[{"SortBy", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Tally", "[", "profile", "]"}], "/.", "ploidies"}], ",", 
       "First"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.851009099455118*^9, 3.8510092010856457`*^9}, {
  3.8510092713590918`*^9, 3.8510093857823772`*^9}, {3.851009565037196*^9, 
  3.851009579923497*^9}, {3.8510096728009033`*^9, 3.851009744666155*^9}},
 CellLabel->"In[42]:=",ExpressionUUID->"eddfe1c6-da45-43a0-8d0c-45b2d8c6455d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"confidenceInterval", "[", 
   RowBox[{"data_", ",", "profile_", ",", "f_", ",", 
    RowBox[{"resampleSize_", ":", "100"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pts", "=", 
       RowBox[{"computeChangePoints", "@", "profile"}]}], ",", 
      "\[IndentingNewLine]", "partitionedProfile", ",", "partitionedData", 
      ",", "\[IndentingNewLine]", "pos", ",", "excursionPloidy", ",", 
      "excursionData", ",", "resampleSizes"}], "\[IndentingNewLine]", "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"partitionedProfile", "=", 
      RowBox[{"partitionByIndex", "[", 
       RowBox[{"profile", ",", "pts"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"partitionedData", "=", 
      RowBox[{"partitionByIndex", "[", 
       RowBox[{"data", ",", "pts"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pos", "=", 
      RowBox[{"extractExcursions", "[", 
       RowBox[{"profile", ",", "pts"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"excursionPloidy", "=", 
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"2", "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"First", "[", 
              RowBox[{"Union", "@", "#"}], "]"}], "-", 
             RowBox[{"2", "*", 
              RowBox[{"(", 
               RowBox[{"1", "-", "f"}], ")"}]}]}], ")"}], "/", "f"}]}], "&"}],
         "/@", 
        RowBox[{
        "partitionedProfile", "\[LeftDoubleBracket]", "pos", 
         "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"excursionData", "=", 
      RowBox[{
      "partitionedData", "\[LeftDoubleBracket]", "pos", 
       "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"resampleSizes", "=", 
      RowBox[{"Ceiling", "[", 
       RowBox[{"resampleSize", "*", 
        RowBox[{"Normalize", "[", 
         RowBox[{
          RowBox[{"Length", "/@", 
           RowBox[{
           "partitionedProfile", "\[LeftDoubleBracket]", "pos", 
            "\[RightDoubleBracket]"}]}], ",", "Total"}], "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"2", 
      RowBox[{"MedianDeviation", "[", "\[IndentingNewLine]", 
       RowBox[{"Join", "@@", 
        RowBox[{"MapThread", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Median", "[", 
                  RowBox[{"RandomChoice", "[", 
                   RowBox[{"#1", ",", 
                    RowBox[{"Length", "@", "#1"}]}], "]"}], "]"}], "-", "2"}],
                 ")"}]}], "/", "#3"}], ",", "#2"}], "]"}], "&"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
           "excursionData", ",", "resampleSizes", ",", "excursionPloidy"}], 
           "}"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
       "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.850968034080389*^9, 3.8509682240188837`*^9}, {
   3.850968318634193*^9, 3.8509684099866657`*^9}, {3.850968441260951*^9, 
   3.8509686519237957`*^9}, {3.8509686840967627`*^9, 3.850968757363593*^9}, {
   3.85096882787141*^9, 3.8509688383034163`*^9}, {3.851006035595652*^9, 
   3.851006221752133*^9}, {3.8510065915142612`*^9, 3.8510065990243883`*^9}, 
   3.8510108520345697`*^9, 3.851746753232997*^9},
 CellLabel->"In[43]:=",ExpressionUUID->"5ba52bfe-041b-4d7a-b69a-8b33ff63dfab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"standardizeData", "[", "data_", "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"c", "=", 
      RowBox[{"Mean", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"findDiploidPeak", "@", 
          RowBox[{"data", "\[LeftDoubleBracket]", 
           RowBox[{";;", 
            RowBox[{
            "corrchromlocations", "\[LeftDoubleBracket]", "11", 
             "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}]}], ",", 
         RowBox[{"findDiploidPeak", "@", 
          RowBox[{"MedianFilter", "[", 
           RowBox[{
            RowBox[{"data", "\[LeftDoubleBracket]", 
             RowBox[{";;", 
              RowBox[{
              "corrchromlocations", "\[LeftDoubleBracket]", "11", 
               "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], ",", 
            "100"}], "]"}]}]}], "}"}], "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", "c"}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.851302194383211*^9, 3.851302204353305*^9}, {
  3.851302243298811*^9, 3.851302312126691*^9}},
 CellLabel->"In[44]:=",ExpressionUUID->"610b5df0-e7d6-4a5e-aadf-eb5716d5e8a4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"estimate\[Pi]f", "[", 
    RowBox[{"rowsums_", ",", "maxPloidy_"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"data", "=", "rowsums"}], ",", 
       RowBox[{"y", "=", 
        RowBox[{
        "corrchromlocations", "\[LeftDoubleBracket]", "11", 
         "\[RightDoubleBracket]"}]}], ",", "\[IndentingNewLine]", "\[Sigma]", 
       ",", "f", ",", "\[Pi]0", ",", "\[Pi]1", ",", "xs", ",", "ps"}], 
      "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Sigma]", "=", 
       RowBox[{"Parallelize", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"copyNumberVariance", "[", 
           RowBox[{
            RowBox[{"2", 
             RowBox[{
              RowBox[{"data", "\[LeftDoubleBracket]", 
               RowBox[{";;", "y"}], "\[RightDoubleBracket]"}], "/", 
              RowBox[{"findDiploidPeak", "[", 
               RowBox[{"MedianFilter", "[", 
                RowBox[{
                 RowBox[{"data", "\[LeftDoubleBracket]", 
                  RowBox[{";;", "y"}], "\[RightDoubleBracket]"}], ",", 
                 "100"}], "]"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "-", "#"}], ")"}], "*", "2"}], "+", 
             RowBox[{"#", "*", 
              RowBox[{"Range", "[", "maxPloidy", "]"}]}]}], ",", "251"}], 
           "]"}], "&"}], "/@", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", "1", ",", "0.01"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
      "PrintTemporary", "[", "\"\<Residual-computation completed\>\"", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"f", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Extract", "[", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"0", ",", "1", ",", "0.01"}], "]"}], ",", 
            RowBox[{"Position", "[", 
             RowBox[{"#", ",", 
              RowBox[{"Min", "@", "#"}]}], "]"}]}], "]"}], 
          "\[LeftDoubleBracket]", 
          RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "&"}], "@", 
        "\[Sigma]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PrintTemporary", "[", "\"\<f-estimation completed\>\"", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"\[Pi]0", "=", 
       RowBox[{"copyNumberFilter", "[", 
        RowBox[{"data", ",", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", "#"}], ")"}], "*", "2"}], "+", 
            RowBox[{"#", "*", 
             RowBox[{"Range", "[", "maxPloidy", "]"}]}]}], "&"}], "@", "f"}], 
         ",", "501"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
      "PrintTemporary", "[", "\"\<Copy number profile estimated\>\"", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"xs", "=", 
       RowBox[{"refineChangePoints", "[", 
        RowBox[{"data", ",", 
         RowBox[{"computeChangePoints", "[", 
          RowBox[{"\[Pi]0", "\[LeftDoubleBracket]", 
           RowBox[{";;", ",", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
         RowBox[{"listCandidates", "[", 
          RowBox[{"f", ",", "3"}], "]"}], ",", "250"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintTemporary", "[", "\"\<Change points estimated\>\"", "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"\[Pi]1", "=", 
       RowBox[{"refineProfile", "[", 
        RowBox[{
         RowBox[{"\[Pi]0", "\[LeftDoubleBracket]", 
          RowBox[{";;", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
         RowBox[{"xs", "\[LeftDoubleBracket]", 
          RowBox[{";;", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{
      "PrintTemporary", "[", "\"\<Copy number profile refined\>\"", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ps", "=", 
       RowBox[{"rankExcursions", "[", 
        RowBox[{"data", ",", "\[Pi]1", ",", "xs"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PrintTemporary", "[", "\"\<p-values computed\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"\[Pi]1", ",", "f", ",", "ps"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.848543316839093*^9, 3.848543322796988*^9}, {
   3.848543432519722*^9, 3.848543455559751*^9}, {3.8485438007887707`*^9, 
   3.848543806127521*^9}, {3.848544001823003*^9, 3.848544001987445*^9}, {
   3.848582466746517*^9, 3.848582470885455*^9}, {3.848584085009101*^9, 
   3.848584102272859*^9}, {3.848584627330722*^9, 3.848584627361699*^9}, {
   3.8485849980717773`*^9, 3.848585000069024*^9}, {3.848585122918915*^9, 
   3.8485851229860697`*^9}, {3.848587469235302*^9, 3.848587469985146*^9}, {
   3.848587739906187*^9, 3.8485877707325077`*^9}, 3.848587875630867*^9, {
   3.848932414924891*^9, 3.848932415940969*^9}, {3.84893245079204*^9, 
   3.8489324513141413`*^9}, {3.848932652559928*^9, 3.848932668855171*^9}, {
   3.848933016041492*^9, 3.8489330188490143`*^9}, {3.849803486704989*^9, 
   3.8498034939845953`*^9}, {3.849804701568659*^9, 3.8498047083688726`*^9}, {
   3.849805226194468*^9, 3.849805240335908*^9}, {3.849805581972393*^9, 
   3.849805592075392*^9}, {3.8507897157329493`*^9, 3.850789716113721*^9}, 
   3.8507900490781803`*^9, 3.860252152964532*^9, {3.860252195090333*^9, 
   3.860252232017177*^9}, {3.860252274069721*^9, 3.8602522769417133`*^9}, {
   3.860252567950057*^9, 3.860252574635397*^9}, {3.8602528479972477`*^9, 
   3.8602529155647182`*^9}, {3.860252957770296*^9, 3.860252988579275*^9}, {
   3.86025303689671*^9, 3.8602530908932247`*^9}, {3.860253129421644*^9, 
   3.860253272987089*^9}, {3.8602533843908787`*^9, 3.860253413459957*^9}, 
   3.860253686841692*^9, {3.862753948607284*^9, 3.8627539503855762`*^9}, 
   3.862754320564251*^9, {3.862754436070002*^9, 3.862754462051888*^9}, {
   3.86275454105897*^9, 3.862754575373139*^9}, {3.86275461856357*^9, 
   3.862754669734933*^9}},
 CellLabel->"In[91]:=",ExpressionUUID->"5a093e04-ecb8-4429-887f-1e8b7416a921"],

Cell[BoxData[
 RowBox[{
  RowBox[{"findThreshold", "[", 
   RowBox[{"pValues_", ",", "\[Alpha]_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[Delta]", "=", "1"}], ",", 
      RowBox[{"iter", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"While", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Delta]", ">", "0"}], ")"}], "&&", 
        RowBox[{"(", 
         RowBox[{"iter", "<", 
          RowBox[{"Min", "[", 
           RowBox[{"1000", ",", 
            RowBox[{
             RowBox[{"Length", "@", "pValues"}], "-", "1"}]}], "]"}]}], 
         ")"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Delta]", "=", 
         RowBox[{
          RowBox[{"benjaminiHochberg", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ReverseSort", "[", "pValues", "]"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{";;", 
              RowBox[{"iter", "+", "1"}]}], "\[RightDoubleBracket]"}], ",", 
            "\[Alpha]"}], "]"}], "-", 
          RowBox[{"benjaminiHochberg", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ReverseSort", "[", "pValues", "]"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{";;", "iter"}], "\[RightDoubleBracket]"}], ",", 
            "\[Alpha]"}], "]"}]}]}], ";", 
        RowBox[{"iter", "+=", "1"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", "iter"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.859136699395751*^9, 3.859136711206503*^9}, {
   3.8591369273377523`*^9, 3.859136927389103*^9}, {3.8591371675427*^9, 
   3.8591373348688383`*^9}, {3.8591373658101683`*^9, 3.859137384785084*^9}, {
   3.859137458120994*^9, 3.859137458521812*^9}, 3.859137590720297*^9},
 CellLabel->
  "In[111]:=",ExpressionUUID->"a3b4ba66-f363-40cf-b6a1-087b38c1365d"]
}, Closed]],

Cell[CellGroupData[{

Cell["Off-Diagonal Detection", "Chapter",
 CellChangeTimes->{{3.8489337835129023`*^9, 3.848933786614572*^9}, {
  3.860251570146429*^9, 
  3.860251571610304*^9}},ExpressionUUID->"106fb022-15f6-4e63-b3e7-\
91c45a235c53"],

Cell[TextData[StyleBox["Function definitions detecting fusion events of type \
(a) and (b)",
 FontSlant->"Italic"]], "Text",
 CellFrame->{{0, 0}, {2, 0}},
 CellFrameColor->GrayLevel[0.75],
 CellChangeTimes->{{3.860248806085986*^9, 3.860248864968273*^9}, {
  3.860249201433004*^9, 3.860249217768318*^9}, {3.860251508740262*^9, 
  3.860251523723233*^9}, {3.860251590642002*^9, 3.860251600913822*^9}},
 FontSize->18,ExpressionUUID->"e3913b42-7219-4f37-a0d1-58f843f746c1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"roundToChromosome", "[", 
   RowBox[{"x_", ",", "y_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Chi]Range", "=", 
       RowBox[{"xTo\[Chi]", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"x", ",", "y"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
      "\[Chi]s", ",", "\[Chi]"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\[Chi]s", "=", 
      RowBox[{"Union", "@", "\[Chi]Range"}]}], ";", 
     RowBox[{"\[Chi]", "=", 
      RowBox[{"Median", "[", "\[Chi]Range", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Max", "[", 
         RowBox[{"Normalize", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Tally", "[", "\[Chi]Range", "]"}], 
            "\[LeftDoubleBracket]", 
            RowBox[{";;", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
           "Total"}], "]"}], "]"}], "<", "0.6"}], ",", "\[IndentingNewLine]", 
       
       RowBox[{"Cases", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Max", "[", 
              RowBox[{"x", ",", 
               RowBox[{
               "corrchromlocations", "\[LeftDoubleBracket]", "#", 
                "\[RightDoubleBracket]"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"corrchromlocations", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"xTo\[Chi]", "[", "#", "]"}], "+", "1"}], 
                    "\[RightDoubleBracket]"}], "-", "1", "-", "#"}], "<", 
                  "50"}], ",", 
                 RowBox[{
                  RowBox[{"corrchromlocations", "\[LeftDoubleBracket]", 
                   RowBox[{
                    RowBox[{"xTo\[Chi]", "[", "#", "]"}], "+", "1"}], 
                   "\[RightDoubleBracket]"}], "-", "1"}], ",", "#"}], "]"}], 
               "&"}], "@", 
              RowBox[{"Min", "[", 
               RowBox[{"y", ",", 
                RowBox[{
                 RowBox[{"corrchromlocations", "\[LeftDoubleBracket]", 
                  RowBox[{"#", "+", "1"}], "\[RightDoubleBracket]"}], "-", 
                 "1"}]}], "]"}]}]}], "\[IndentingNewLine]", "}"}], "&"}], "/@",
           "\[Chi]s"}], ",", "\[IndentingNewLine]", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"-", 
              RowBox[{"Subtract", "@@", "#"}]}], ">", "200"}], "&"}], 
           ")"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"corrchromlocations", "\[LeftDoubleBracket]", 
                  RowBox[{
                   RowBox[{"xTo\[Chi]", "[", "#", "]"}], "+", "1"}], 
                  "\[RightDoubleBracket]"}], "-", "1", "-", "#"}], "<", 
                "50"}], ",", 
               RowBox[{
                RowBox[{"corrchromlocations", "\[LeftDoubleBracket]", 
                 RowBox[{
                  RowBox[{"xTo\[Chi]", "[", "#", "]"}], "+", "1"}], 
                 "\[RightDoubleBracket]"}], "-", "1"}], ",", "#"}], "]"}], 
             "&"}], "@", 
            RowBox[{"First", "[", 
             RowBox[{"Nearest", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                "corrchromlocations", "\[LeftDoubleBracket]", "\[Chi]", 
                 "\[RightDoubleBracket]"}], "~", "Range", "~", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"corrchromlocations", "\[LeftDoubleBracket]", 
                   RowBox[{"\[Chi]", "+", "1"}], "\[RightDoubleBracket]"}], 
                  "-", "1"}], ")"}]}], ",", "#"}], "]"}], "]"}]}], ")"}], 
          "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{"x", ",", "y"}], "}"}]}], "}"}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.854421841280938*^9, 3.854421912112352*^9}, {
  3.854421965948382*^9, 3.854422105312166*^9}, {3.854422139561322*^9, 
  3.8544221998104277`*^9}, {3.854422235132575*^9, 3.854422401470924*^9}, {
  3.8544224941916313`*^9, 3.8544226655735903`*^9}, {3.85442271071072*^9, 
  3.854422739260108*^9}, {3.854422771898779*^9, 3.854422802981484*^9}, {
  3.854422839000081*^9, 3.854422915205665*^9}, {3.854422955998783*^9, 
  3.854422966268676*^9}, {3.8544230042399187`*^9, 3.854423004506012*^9}, {
  3.8544231796567907`*^9, 3.8544231955270357`*^9}, {3.854423590271257*^9, 
  3.854423607215761*^9}, {3.854423695839264*^9, 3.854423735591593*^9}, {
  3.8544237658127317`*^9, 3.854423809420927*^9}, {3.854423877254356*^9, 
  3.854423892590139*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"1f17a789-0750-436d-846d-4d55869ffb65"],

Cell[BoxData[
 RowBox[{
  RowBox[{"scanBlock", "[", 
   RowBox[{"block_", ",", "ws_"}], "]"}], ":=", 
  RowBox[{"SparseArray", "[", 
   RowBox[{
    RowBox[{"ListConvolve", "[", 
     RowBox[{
      RowBox[{"ConstantArray", "[", 
       RowBox[{"1", ",", "ws"}], "]"}], ",", "block"}], "]"}], "/", 
    RowBox[{"(", 
     RowBox[{"Times", "@@", "ws"}], ")"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.8517028890176888`*^9, 3.851702921236947*^9}, {
  3.8517030514242353`*^9, 3.851703062029114*^9}},
 CellLabel->"In[47]:=",ExpressionUUID->"76688407-2112-48b0-8bb1-7c99fc56d4ba"],

Cell[BoxData[
 RowBox[{
  RowBox[{"scanBlock", "[", 
   RowBox[{"mat_", ",", "\[Chi]1_", ",", "\[Chi]2_", ",", "ws_"}], "]"}], ":=", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"a", "=", 
       RowBox[{
       "corrchromlocations", "\[LeftDoubleBracket]", "\[Chi]1", 
        "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"b", "=", 
       RowBox[{
        RowBox[{"corrchromlocations", "\[LeftDoubleBracket]", 
         RowBox[{"1", "+", "\[Chi]1"}], "\[RightDoubleBracket]"}], "-", 
        "1"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"c", "=", 
       RowBox[{
       "corrchromlocations", "\[LeftDoubleBracket]", "\[Chi]2", 
        "\[RightDoubleBracket]"}]}], ",", 
      RowBox[{"d", "=", 
       RowBox[{
        RowBox[{"corrchromlocations", "\[LeftDoubleBracket]", 
         RowBox[{"1", "+", "\[Chi]2"}], "\[RightDoubleBracket]"}], "-", 
        "1"}]}]}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"SparseArray", "[", 
     RowBox[{
      RowBox[{"ListConvolve", "[", 
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{"1", ",", "ws"}], "]"}], ",", 
        RowBox[{"mat", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"a", ";;", "b"}], ",", 
          RowBox[{"c", ";;", "d"}]}], "\[RightDoubleBracket]"}]}], "]"}], "/", 
      RowBox[{"(", 
       RowBox[{"Times", "@@", "ws"}], ")"}]}], "]"}]}], "\[IndentingNewLine]",
    "]"}]}]], "Input",
 CellChangeTimes->{{3.8485969527015963`*^9, 3.848596962291383*^9}, {
   3.848597247064926*^9, 3.848597304543233*^9}, {3.84859735841033*^9, 
   3.848597383195325*^9}, {3.84859741702808*^9, 3.8485974754528008`*^9}, {
   3.848597508813033*^9, 3.848597509849118*^9}, {3.848633030709103*^9, 
   3.8486330459232264`*^9}, 3.848633080687209*^9, {3.8486331107840548`*^9, 
   3.8486331164207783`*^9}, {3.848949992281393*^9, 3.848949996757831*^9}, {
   3.851130800030119*^9, 3.851130803541675*^9}, {3.8511308361855383`*^9, 
   3.851130857900984*^9}, {3.851131045780065*^9, 3.851131057168538*^9}, {
   3.851132337744623*^9, 3.8511324343175373`*^9}, {3.8511324697861767`*^9, 
   3.85113247830399*^9}, {3.851132526113302*^9, 3.851132526182719*^9}, {
   3.851132556222224*^9, 3.85113257617435*^9}, {3.8511328341586847`*^9, 
   3.851132835431809*^9}, {3.851133702836007*^9, 3.8511337170969133`*^9}, 
   3.851134203318912*^9, 3.851134237326201*^9, {3.85136449160019*^9, 
   3.8513645018820343`*^9}, {3.8513645412242002`*^9, 
   3.8513645490476723`*^9}, {3.851364605411558*^9, 3.851364680167268*^9}, {
   3.851395607090959*^9, 3.8513956096488523`*^9}, {3.853772904018694*^9, 
   3.85377290428268*^9}},
 CellLabel->"In[48]:=",ExpressionUUID->"767ab95a-7580-458e-8536-4f30e352eb3f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"computeIntensitySquare", "[", 
   RowBox[{"mat_", ",", "x_", ",", "y_", ",", "ws_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"a", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"x", "-", 
          RowBox[{
          "ws", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "+", 
          "1"}], ",", "1"}], "]"}]}], ",", 
      RowBox[{"b", "=", 
       RowBox[{"Min", "[", 
        RowBox[{
         RowBox[{"x", "+", 
          RowBox[{
          "ws", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
         RowBox[{"Length", "@", "rPos"}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"c", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"y", "-", 
          RowBox[{
          "ws", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "+", 
          "1"}], ",", "1"}], "]"}]}], ",", 
      RowBox[{"d", "=", 
       RowBox[{"Min", "[", 
        RowBox[{
         RowBox[{"y", "+", 
          RowBox[{
          "ws", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ",", 
         RowBox[{"Length", "@", "rPos"}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Map", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Mean", "@", 
        RowBox[{"Flatten", "@", "#"}]}], "&"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"mat", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"a", ";;", "x"}], ",", 
            RowBox[{"c", ";;", "y"}]}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{"mat", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"a", ";;", "x"}], ",", 
            RowBox[{
             RowBox[{"y", "+", "1"}], ";;", "d"}]}], 
           "\[RightDoubleBracket]"}]}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"mat", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{
             RowBox[{"x", "+", "1"}], ";;", "b"}], ",", 
            RowBox[{"c", ";;", "y"}]}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{"mat", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{
             RowBox[{"x", "+", "1"}], ";;", "b"}], ",", 
            RowBox[{
             RowBox[{"y", "+", "1"}], ";;", "d"}]}], 
           "\[RightDoubleBracket]"}]}], "}"}]}], "\[IndentingNewLine]", "}"}],
       ",", "\[IndentingNewLine]", 
      RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.851741188759679*^9, 3.851741326734572*^9}, {
  3.8517413651358023`*^9, 3.85174151183314*^9}, {3.851741565580707*^9, 
  3.8517415816570053`*^9}, {3.85377287267325*^9, 3.853772897531507*^9}, {
  3.856023074950655*^9, 3.856023082959497*^9}},
 CellLabel->"In[49]:=",ExpressionUUID->"889f27df-d9bd-4d82-85af-a25026d9ec51"],

Cell[BoxData[
 RowBox[{
  RowBox[{"readCount", "[", 
   RowBox[{"mat_", ",", "x_", ",", "y_", ",", "ws_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"a", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"x", "-", 
          RowBox[{
          "ws", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "+", 
          "1"}], ",", "1"}], "]"}]}], ",", 
      RowBox[{"b", "=", 
       RowBox[{"Min", "[", 
        RowBox[{
         RowBox[{"x", "+", 
          RowBox[{
          "ws", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
         RowBox[{"Length", "@", "rPos"}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"c", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"y", "-", 
          RowBox[{
          "ws", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "+", 
          "1"}], ",", "1"}], "]"}]}], ",", 
      RowBox[{"d", "=", 
       RowBox[{"Min", "[", 
        RowBox[{
         RowBox[{"y", "+", 
          RowBox[{
          "ws", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ",", 
         RowBox[{"Length", "@", "rPos"}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Total", "[", 
     RowBox[{
      RowBox[{"mat", "\[LeftDoubleBracket]", 
       RowBox[{
        RowBox[{"a", ";;", "b"}], ",", 
        RowBox[{"c", ";;", "d"}]}], "\[RightDoubleBracket]"}], ",", "2"}], 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8560264451795063`*^9, 3.856026475211075*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"4dee2798-e331-4872-b0a2-1cc19ff98c31"],

Cell[BoxData[
 RowBox[{
  RowBox[{"detectPattern", "[", "intensitySquare_", "]"}], ":=", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"normalizedIntensities", "=", 
       RowBox[{"Normalize", "[", 
        RowBox[{
         RowBox[{"Flatten", "@", "intensitySquare"}], ",", "Total"}], "]"}]}],
       ",", "\[IndentingNewLine]", 
      RowBox[{"entropy", "=", 
       RowBox[{"Function", "[", 
        RowBox[{"p", ",", 
         RowBox[{"p", ".", 
          RowBox[{"Log", "[", 
           RowBox[{"p", "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"0", "|", "0."}], "->", "1"}], "}"}]}], "]"}]}]}], 
        "]"}]}]}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"entropy", "@", "normalizedIntensities"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8511347561549177`*^9, 3.851134766427856*^9}, {
  3.851134996187107*^9, 3.8511350049097977`*^9}, {3.851135105480752*^9, 
  3.851135114361025*^9}, {3.851135203842173*^9, 3.851135213154608*^9}, {
  3.851135266382759*^9, 3.8511352821768827`*^9}, {3.8511353594329576`*^9, 
  3.851135384579122*^9}, {3.851565441913864*^9, 3.8515654556105957`*^9}, {
  3.852258415207507*^9, 3.852258428909441*^9}, {3.85403432280564*^9, 
  3.8540344618528023`*^9}, {3.854034535082847*^9, 3.854034541683072*^9}},
 CellLabel->"In[51]:=",ExpressionUUID->"b359fb17-08a4-4b91-993c-6a902309b13f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"detectPattern", "[", "intensitySquare_", "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"normalizedIntensities", "=", 
      RowBox[{"Normalize", "[", 
       RowBox[{
        RowBox[{"Flatten", "@", "intensitySquare"}], ",", "Total"}], "]"}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Max", "[", "normalizedIntensities", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8544266451611137`*^9, 3.854426689445759*^9}, {
  3.854426738373213*^9, 3.8544267390547543`*^9}},
 CellLabel->"In[52]:=",ExpressionUUID->"9a2be885-3fc7-49ba-9bf2-4b829d8861ef"],

Cell[BoxData[
 RowBox[{
  RowBox[{"offDiagonalIndices", "[", 
   RowBox[{"\[Chi]_", ",", "w_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n", "=", 
      RowBox[{"Length", "@", "rPos"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"DeleteCases", "[", 
     RowBox[{
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"Range", "@", "n"}], ",", 
        RowBox[{"Range", "[", 
         RowBox[{
          RowBox[{
          "corrchromlocations", "\[LeftDoubleBracket]", "\[Chi]", 
           "\[RightDoubleBracket]"}], ",", 
          RowBox[{
           RowBox[{"corrchromlocations", "\[LeftDoubleBracket]", 
            RowBox[{"\[Chi]", "+", "1"}], "\[RightDoubleBracket]"}], "-", 
           "1"}]}], "]"}]}], "]"}], ",", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{"n", "-", "#"}], ",", "#"}], "]"}], "<=", "w"}], "&"}], 
        ")"}]}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.852256638061985*^9, 3.8522566917574472`*^9}, {
  3.8522570843983517`*^9, 3.8522571571687517`*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"eba18f3e-cdb3-40a2-8654-bf0e075cadca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"rowPattern", "[", 
   RowBox[{"mat_", ",", "x_", ",", "ws_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"r", ",", "s", ",", 
      RowBox[{"\[Chi]", "=", 
       RowBox[{"xTo\[Chi]", "[", "x", "]"}]}], ",", 
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "rPos"}]}], ",", 
      RowBox[{"w", "=", 
       RowBox[{"Last", "@", "ws"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Parallelize", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"r", "=", 
       RowBox[{"Flatten", "@", 
        RowBox[{"scanBlock", "[", 
         RowBox[{
          RowBox[{"mat", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{
             RowBox[{"x", "-", 
              RowBox[{
              "ws", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "+", "1"}], ";;", "x"}], ",", 
            RowBox[{"Complement", "[", 
             RowBox[{
              RowBox[{"Range", "@", "n"}], ",", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{
                "corrchromlocations", "\[LeftDoubleBracket]", "\[Chi]", 
                 "\[RightDoubleBracket]"}], ",", 
                RowBox[{
                 RowBox[{"corrchromlocations", "\[LeftDoubleBracket]", 
                  RowBox[{"\[Chi]", "+", "1"}], "\[RightDoubleBracket]"}], 
                 "-", "1"}]}], "]"}]}], "]"}]}], "\[RightDoubleBracket]"}], 
          ",", "ws"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"s", "=", 
       RowBox[{"Flatten", "@", 
        RowBox[{"scanBlock", "[", 
         RowBox[{
          RowBox[{"mat", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{
             RowBox[{"x", "+", "1"}], ";;", 
             RowBox[{"x", "+", 
              RowBox[{
              "ws", "\[LeftDoubleBracket]", "1", 
               "\[RightDoubleBracket]"}]}]}], ",", 
            RowBox[{"Complement", "[", 
             RowBox[{
              RowBox[{"Range", "@", "n"}], ",", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{
                "corrchromlocations", "\[LeftDoubleBracket]", "\[Chi]", 
                 "\[RightDoubleBracket]"}], ",", 
                RowBox[{
                 RowBox[{"corrchromlocations", "\[LeftDoubleBracket]", 
                  RowBox[{"\[Chi]", "+", "1"}], "\[RightDoubleBracket]"}], 
                 "-", "1"}]}], "]"}]}], "]"}]}], "\[RightDoubleBracket]"}], 
          ",", "ws"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"detectPattern", "[", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "r", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], ",", 
             RowBox[{"r", "\[LeftDoubleBracket]", 
              RowBox[{"#", "+", "w"}], "\[RightDoubleBracket]"}]}], "}"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "s", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], ",", 
             RowBox[{"s", "\[LeftDoubleBracket]", 
              RowBox[{"#", "+", "w"}], "\[RightDoubleBracket]"}]}], "}"}]}], 
          "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", "]"}], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"Length", "@", "r"}], "-", "w"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellChangeTimes->{{3.8522606786239223`*^9, 3.8522608697954597`*^9}, {
  3.8522609283431387`*^9, 3.852260982370864*^9}, {3.852261035614403*^9, 
  3.8522611929883337`*^9}, {3.852261231276705*^9, 3.8522613226115503`*^9}, {
  3.8522613577435093`*^9, 3.852261357810976*^9}, {3.85226143212634*^9, 
  3.852261437661035*^9}, {3.853644521893149*^9, 3.853644522959435*^9}, {
  3.854034669631064*^9, 3.854034672014654*^9}},
 CellLabel->"In[54]:=",ExpressionUUID->"125661c6-1d93-4664-919f-235537133f39"],

Cell[BoxData[
 RowBox[{
  RowBox[{"refineCorner", "[", 
   RowBox[{"mat_", ",", "x_", ",", "y_", ",", "ws_", ",", 
    RowBox[{"it_", ":", "0"}], ",", 
    RowBox[{"\[Eta]_", ":", "1"}], ",", 
    RowBox[{"maxIterates_", ":", "100"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"stencilCoordinates", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Tuples", "[", 
          RowBox[{
           RowBox[{"\[Eta]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "0", ",", "1"}], "}"}]}], ",", 
           RowBox[{"{", "2", "}"}]}], "]"}], ",", "3"}], "]"}]}], ",", 
      "\[IndentingNewLine]", "stencilVals", ",", "\[IndentingNewLine]", 
      "currentVal", ",", "nextVal", ",", "nextPos"}], "\[IndentingNewLine]", 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"stencilVals", "=", "\[IndentingNewLine]", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"detectPattern", "[", 
          RowBox[{"computeIntensitySquare", "[", 
           RowBox[{"mat", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"x", ",", "y"}], "}"}], "+", "#"}], ")"}]}], ",", 
            "ws"}], "]"}], "]"}], "&"}], ",", "stencilCoordinates", ",", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"currentVal", "=", 
      RowBox[{"stencilVals", "\[LeftDoubleBracket]", 
       RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"nextVal", "=", 
      RowBox[{"Max", "@", 
       RowBox[{"Flatten", "@", "stencilVals"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"nextPos", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "y"}], "}"}], "+", 
        RowBox[{"First", "@", 
         RowBox[{"Extract", "[", 
          RowBox[{"stencilCoordinates", ",", 
           RowBox[{"Position", "[", 
            RowBox[{"stencilVals", ",", 
             RowBox[{"_", "?", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"#", ">=", "nextVal"}], "&"}], ")"}]}]}], "]"}]}], 
          "]"}]}]}], ")"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"currentVal", ">=", "nextVal"}], ")"}], "||", 
        RowBox[{"(", 
         RowBox[{"it", ">", "maxIterates"}], ")"}], "||", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{
            "nextPos", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
             ",", 
            RowBox[{
             RowBox[{"Length", "@", "rPos"}], "-", 
             RowBox[{
             "nextPos", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}]}]}], "]"}], "<", 
          RowBox[{
          "ws", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
         ")"}], "||", 
        RowBox[{"(", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{
             "nextPos", "\[LeftDoubleBracket]", "2", 
              "\[RightDoubleBracket]"}], ",", 
             RowBox[{
              RowBox[{"Length", "@", "rPos"}], "-", 
              RowBox[{
              "nextPos", "\[LeftDoubleBracket]", "2", 
               "\[RightDoubleBracket]"}]}]}], "]"}], "<", 
           RowBox[{
           "ws", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
          ")"}], ")"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "y"}], "}"}], ",", "currentVal"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"refineCorner", "[", 
        RowBox[{"mat", ",", 
         RowBox[{"Sequence", "@@", "nextPos"}], ",", "ws", ",", 
         RowBox[{"it", "+", "1"}], ",", "\[Eta]", ",", "maxIterates"}], 
        "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.851534040231819*^9, 3.85153409163512*^9}, {
   3.851534210624597*^9, 3.851534235908245*^9}, {3.85153426886841*^9, 
   3.851534381805757*^9}, {3.851534490306881*^9, 3.851534492298551*^9}, {
   3.851534669325159*^9, 3.851534670662768*^9}, {3.851564394508542*^9, 
   3.851564404408904*^9}, {3.85156445797569*^9, 3.851564519433051*^9}, {
   3.851564553029544*^9, 3.851564596583659*^9}, {3.8515655018074417`*^9, 
   3.851565502175871*^9}, {3.851565638389433*^9, 3.8515656675269136`*^9}, {
   3.8515657128302097`*^9, 3.851565745166161*^9}, {3.851565946336358*^9, 
   3.85156604163855*^9}, {3.851566082872951*^9, 3.8515662130675707`*^9}, {
   3.851566305355782*^9, 3.8515664508473883`*^9}, {3.851566483443227*^9, 
   3.851566571315843*^9}, {3.851566602507903*^9, 3.851566628141282*^9}, {
   3.8515669848402452`*^9, 3.851566995247651*^9}, {3.8515670444616623`*^9, 
   3.851567046235594*^9}, {3.851567084368842*^9, 3.851567094383556*^9}, {
   3.8515672235514317`*^9, 3.851567230806797*^9}, {3.851568474820753*^9, 
   3.851568505794112*^9}, {3.8515701840844584`*^9, 3.8515702318246098`*^9}, {
   3.8515703074379053`*^9, 3.8515703160698853`*^9}, {3.851570380196896*^9, 
   3.851570391061227*^9}, {3.851618037692505*^9, 3.8516181454571943`*^9}, 
   3.8516183566257877`*^9, {3.851618594318318*^9, 3.851618604187606*^9}, {
   3.85161867501442*^9, 3.851618678354991*^9}, {3.851618723007229*^9, 
   3.851618723124034*^9}, {3.851618880097764*^9, 3.851618889111018*^9}, {
   3.851618921604594*^9, 3.851618926049011*^9}, {3.8516192500814447`*^9, 
   3.8516192701414022`*^9}, {3.851619366805195*^9, 3.8516193677479267`*^9}, {
   3.851619646377425*^9, 3.851619658214238*^9}, {3.851619769173946*^9, 
   3.851619769400539*^9}, {3.851620264657565*^9, 3.851620266730794*^9}, 
   3.852258547826473*^9, {3.853735101298153*^9, 3.853735153662671*^9}, {
   3.853735223897133*^9, 3.8537352578049803`*^9}, {3.853771398326077*^9, 
   3.853771414534051*^9}, {3.8537714888779173`*^9, 3.853771501017321*^9}, {
   3.853771559780237*^9, 3.8537715604189577`*^9}, {3.85403517456988*^9, 
   3.85403518110614*^9}, {3.856023108747302*^9, 3.856023109490646*^9}},
 CellLabel->"In[55]:=",ExpressionUUID->"4533bb85-140e-48d6-8e8a-1f6b5b42634f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"excursionIndicators", "[", 
   RowBox[{"pValues_", ",", "profile_", ",", "points_"}], "]"}], ":=", 
  RowBox[{"Transpose", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Pick", "[", 
      RowBox[{"#", ",", 
       RowBox[{"Median", "/@", 
        RowBox[{"partitionByIndex", "[", 
         RowBox[{"profile", ",", "points"}], "]"}]}], ",", 
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"#", "-", "2"}], "]"}], ">", "0"}], "&"}], ")"}]}]}], 
      "]"}], "&"}], "/@", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", "1", "}"}], "~", "Join", "~", "points", "~", "Join", 
         "~", 
         RowBox[{"{", 
          RowBox[{"Length", "@", "rPos"}], "}"}]}], ",", "2", ",", "1"}], 
       "]"}], ",", "pValues"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.85403526370026*^9, 3.854035367849311*^9}, {
  3.854035413325634*^9, 3.854035464454205*^9}, {3.854123488946611*^9, 
  3.854123493350334*^9}},
 CellLabel->"In[56]:=",ExpressionUUID->"1782d0da-adfa-4ee7-870f-d9774cfd9e6f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testTreeStructure", "[", 
   RowBox[{"mat_", ",", "x_", ",", "y_", ",", "w_", ",", 
    RowBox[{"resamples_", ":", "100"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"submatrix", "=", 
       RowBox[{"mat", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{
            RowBox[{"x", "-", 
             RowBox[{
             "w", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            ",", "1"}], "]"}], ";;", 
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{"x", "+", 
             RowBox[{
             "w", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            ",", 
            RowBox[{"Length", "@", "rPos"}]}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{
            RowBox[{"y", "-", 
             RowBox[{
             "w", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            ",", "1"}], "]"}], ";;", 
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{"y", "+", 
             RowBox[{
             "w", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            ",", 
            RowBox[{"Length", "@", "rPos"}]}], "]"}]}]}], 
        "\[RightDoubleBracket]"}]}], ",", "\[IndentingNewLine]", 
      "rowMarginals", ",", "columnMarginals", ",", "rowStatistic", ",", 
      "columnStatistic", ",", "resampledStatistics"}], "\[IndentingNewLine]", 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rowMarginals", "=", 
      RowBox[{"Mean", "/@", "submatrix"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"columnMarginals", "=", 
      RowBox[{"Mean", "/@", 
       RowBox[{"Transpose", "[", "submatrix", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"rowStatistic", "=", 
      RowBox[{"Mean", "[", 
       RowBox[{"Variance", "/@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"rowMarginals", "\[LeftDoubleBracket]", 
           RowBox[{"1", ";;", 
            RowBox[{
            "w", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
           "\[RightDoubleBracket]"}], ",", 
          RowBox[{"rowMarginals", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{
             RowBox[{
             "w", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "+",
              "2"}], ";;"}], "\[RightDoubleBracket]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"columnStatistic", "=", 
      RowBox[{"Mean", "[", 
       RowBox[{"Variance", "/@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"columnMarginals", "\[LeftDoubleBracket]", 
           RowBox[{"1", ";;", 
            RowBox[{
            "w", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
           "\[RightDoubleBracket]"}], ",", 
          RowBox[{"columnMarginals", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{
             RowBox[{
             "w", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "+",
              "2"}], ";;"}], "\[RightDoubleBracket]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"resampledStatistics", "=", 
      RowBox[{"Transpose", "@", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"permutedRows", "=", 
              RowBox[{"RandomSample", "@", "rowMarginals"}]}], ",", 
             RowBox[{"permutedColumns", "=", 
              RowBox[{"RandomSample", "@", "columnMarginals"}]}]}], "}"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Mean", "[", 
              RowBox[{"Variance", "/@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"permutedRows", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ";;", 
                   RowBox[{
                   "w", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], 
                 ",", 
                 RowBox[{"permutedRows", "\[LeftDoubleBracket]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    "w", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "+", "2"}], ";;"}], 
                  "\[RightDoubleBracket]"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"Mean", "[", 
              RowBox[{"Variance", "/@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"permutedColumns", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ";;", 
                   RowBox[{
                   "w", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], 
                 ",", 
                 RowBox[{"permutedColumns", "\[LeftDoubleBracket]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    "w", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "+", "2"}], ";;"}], 
                  "\[RightDoubleBracket]"}]}], "}"}]}], "]"}]}], "}"}]}], 
          "]"}], ",", "\[IndentingNewLine]", "resamples"}], 
        "\[IndentingNewLine]", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Mean", "[", 
      RowBox[{"1", "-", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"CDF", "[", 
           RowBox[{
            RowBox[{"EmpiricalDistribution", "@", "#1"}], ",", "#2"}], "]"}], 
          "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"resampledStatistics", ",", 
           RowBox[{"{", 
            RowBox[{"rowStatistic", ",", "columnStatistic"}], "}"}]}], 
          "}"}]}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8540408932738943`*^9, 3.8540409559696817`*^9}, {
  3.854041110657336*^9, 3.854041185996606*^9}, {3.854041263968649*^9, 
  3.854041343769677*^9}, {3.854041384450449*^9, 3.854041416456558*^9}, {
  3.854041454867051*^9, 3.854041572747842*^9}, {3.85404165999895*^9, 
  3.854042003502512*^9}},
 CellLabel->"In[57]:=",ExpressionUUID->"78782e11-ffc4-422f-ba90-0ef1a7d478ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"extractButterflyCandidates", "[", 
   RowBox[{"mat_", ",", "\[Chi]1_", ",", "\[Chi]2_", ",", "ws_", ",", 
    RowBox[{"componentDepth_", ":", "10"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"blockScan", "=", 
       RowBox[{"scanBlock", "[", 
        RowBox[{"mat", ",", "\[Chi]1", ",", "\[Chi]2", ",", "ws"}], "]"}]}], 
      ",", "\[IndentingNewLine]", "components", ",", "orderingScan", ",", 
      "searchLength", ",", "likelyComponents", ",", "componentSequence", ",", 
      "positionScans", ",", "componentTallies", ",", "intensityScans"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"components", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"SparseArray", "@", 
         RowBox[{"MorphologicalComponents", "[", "\[IndentingNewLine]", 
          RowBox[{"#", ",", 
           RowBox[{"Median", "@", 
            RowBox[{"#", "[", "\"\<NonzeroValues\>\"", "]"}]}], ",", 
           RowBox[{"CornerNeighbors", "\[Rule]", "False"}]}], 
          "\[IndentingNewLine]", "]"}]}], "&"}], "@", "blockScan"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"orderingScan", "=", 
      RowBox[{"Ordering", "@", 
       RowBox[{"blockScan", "[", "\"\<NonzeroValues\>\"", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"componentTallies", "=", 
      RowBox[{
       RowBox[{"ReverseSort", "[", 
        RowBox[{
         RowBox[{"Tally", "[", 
          RowBox[{"components", "[", "\"\<NonzeroValues\>\"", "]"}], "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{";;", ",", "2"}], "\[RightDoubleBracket]"}], "]"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{";;", "componentDepth"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"searchLength", "=", 
      RowBox[{"Total", "@", "componentTallies"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"positionScans", "=", 
      RowBox[{"Reverse", "@", 
       RowBox[{
        RowBox[{"blockScan", "[", "\"\<NonzeroPositions\>\"", "]"}], 
        "\[LeftDoubleBracket]", 
        RowBox[{"orderingScan", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"-", "searchLength"}], ";;"}], "\[RightDoubleBracket]"}], 
        "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"componentSequence", "=", 
      RowBox[{"Extract", "[", 
       RowBox[{"components", ",", "positionScans"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"likelyComponents", "=", 
      RowBox[{
       RowBox[{"DeleteDuplicates", "[", "componentSequence", "]"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{";;", "componentDepth"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Transpose", "@", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Extract", "[", 
         RowBox[{"positionScans", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"FirstPosition", "[", 
             RowBox[{"componentSequence", ",", "#"}], "]"}], "&"}], "/@", 
           "likelyComponents"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Round", "@", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"componentTallies", "/", "2."}], "]"}]}]}], 
       "\[IndentingNewLine]", "}"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.853689856796034*^9, 3.853689876414669*^9}, {
   3.853689907512891*^9, 3.853690013970251*^9}, 3.853690070221839*^9, {
   3.8536901152196693`*^9, 3.853690170366884*^9}, {3.853690228914338*^9, 
   3.8536903276252317`*^9}, {3.85369036938095*^9, 3.853690385073069*^9}, {
   3.8536904360771017`*^9, 3.853690492055394*^9}, {3.853690534162719*^9, 
   3.8536905896965523`*^9}, {3.8536906288245993`*^9, 3.853690667844392*^9}, {
   3.85369119902674*^9, 3.853691258931121*^9}, {3.853691324905478*^9, 
   3.8536913332864037`*^9}, {3.853691566577321*^9, 3.853691590272606*^9}, {
   3.853691648956378*^9, 3.853691654092456*^9}, {3.853691702498596*^9, 
   3.853691704761106*^9}, {3.85369188581476*^9, 3.8536918864760723`*^9}, {
   3.853729783151184*^9, 3.853729812800179*^9}, 3.8541312574688663`*^9, 
   3.854131291718412*^9, {3.854131333179666*^9, 3.854131354768997*^9}, {
   3.8541313870252867`*^9, 3.8541314733643827`*^9}, {3.8542891880242453`*^9, 
   3.854289198494233*^9}, {3.8543841336971483`*^9, 3.85438414031713*^9}},
 CellLabel->"In[58]:=",ExpressionUUID->"f6f0ff0f-e559-4bb5-85ef-61c74097ef26"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pickLargeCandidate", "[", 
   RowBox[{"mat_", ",", "x_", ",", "y_", ",", "ws_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"localMat", "=", 
      RowBox[{"mat", "\[LeftDoubleBracket]", 
       RowBox[{
        RowBox[{
         RowBox[{"Max", "[", 
          RowBox[{
           RowBox[{"x", "-", 
            RowBox[{
            "ws", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
           ",", "1"}], "]"}], ";;", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"x", "+", 
            RowBox[{
            "ws", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
           ",", 
           RowBox[{"Length", "@", "rPos"}]}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"Max", "[", 
          RowBox[{
           RowBox[{"y", "-", 
            RowBox[{
            "ws", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
           ",", "1"}], "]"}], ";;", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"y", "+", 
            RowBox[{
            "ws", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
           ",", 
           RowBox[{"Length", "@", "rPos"}]}], "]"}]}]}], 
       "\[RightDoubleBracket]"}]}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x", ",", "y"}], "}"}], "+", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"First", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Pick", "[", 
           RowBox[{
            RowBox[{"localMat", "[", "\"\<NonzeroPositions\>\"", "]"}], ",", 
            "#", ",", 
            RowBox[{"Max", "[", "#", "]"}]}], "]"}], "&"}], "@", 
         RowBox[{"localMat", "[", "\"\<NonzeroValues\>\"", "]"}]}], "]"}], 
       "-", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"1", "+", 
          RowBox[{
          "ws", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
         RowBox[{"1", "+", 
          RowBox[{
          "ws", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}], 
        "}"}]}], ")"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.854296569113258*^9, 3.8542967088765907`*^9}, {
  3.8542968243443613`*^9, 3.8542969039242992`*^9}, {3.8543013214147367`*^9, 
  3.854301408961176*^9}, {3.854302427944627*^9, 3.854302430318696*^9}},
 CellLabel->"In[59]:=",ExpressionUUID->"1494d1d6-792c-471f-9ab8-d3d30a3df7ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"butterflySummary", "[", 
   RowBox[{"mat_", ",", "x_", ",", "y_", ",", "ws_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"intensitySquare", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"#", ",", "2"}], "]"}], "<=", "0"}], ",", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "2"}], "}"}]}], "]"}], ",", 
          RowBox[{"#", "/", 
           RowBox[{"Total", "[", 
            RowBox[{"#", ",", "2"}], "]"}]}]}], "]"}], "&"}], "@", 
       RowBox[{"computeIntensitySquare", "[", 
        RowBox[{"mat", ",", "x", ",", "y", ",", "ws"}], "]"}]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"-", 
     RowBox[{"Det", "[", "intensitySquare", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.85430552262922*^9, 3.85430560479839*^9}, {
  3.854305653310199*^9, 3.854305655907391*^9}, {3.8543351806233788`*^9, 
  3.854335200851981*^9}, {3.8560231140053587`*^9, 3.856023114446863*^9}},
 CellLabel->"In[60]:=",ExpressionUUID->"0c550ff7-618a-4283-aeb2-b3077089c499"],

Cell[BoxData[
 RowBox[{
  RowBox[{"findButterflySummary", "[", 
   RowBox[{"mat_", ",", "x_", ",", "y_", ",", "ws_", ",", 
    RowBox[{"symmetry_", ":", "0"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"localMat", "=", "\[IndentingNewLine]", 
      RowBox[{"SparseArray", "@", 
       RowBox[{"ParallelTable", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"butterflySummary", "[", 
          RowBox[{"mat", ",", "s", ",", "t", ",", 
           RowBox[{"{", 
            RowBox[{"50", ",", "50"}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"s", ",", 
           RowBox[{"Max", "[", 
            RowBox[{"1", ",", 
             RowBox[{"x", "-", 
              RowBox[{
              "ws", "\[LeftDoubleBracket]", "1", 
               "\[RightDoubleBracket]"}]}]}], "]"}], ",", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"Length", "@", "rPos"}], ",", 
             RowBox[{"x", "+", 
              RowBox[{
              "ws", "\[LeftDoubleBracket]", "1", 
               "\[RightDoubleBracket]"}]}]}], "]"}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"t", ",", 
           RowBox[{"Max", "[", 
            RowBox[{"1", ",", 
             RowBox[{"y", "-", 
              RowBox[{
              "ws", "\[LeftDoubleBracket]", "2", 
               "\[RightDoubleBracket]"}]}]}], "]"}], ",", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"Length", "@", "rPos"}], ",", 
             RowBox[{"y", "+", 
              RowBox[{
              "ws", "\[LeftDoubleBracket]", "2", 
               "\[RightDoubleBracket]"}]}]}], "]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"symmetry", "==", "0"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x", ",", "y"}], "}"}], "+", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"First", "[", 
              RowBox[{"Pick", "[", 
               RowBox[{
                RowBox[{"localMat", "[", "\"\<NonzeroPositions\>\"", "]"}], 
                ",", "#", ",", 
                RowBox[{"Max", "@", "#"}]}], "]"}], "]"}], "-", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                "ws", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "+", "1"}], ",", 
               RowBox[{
                RowBox[{
                "ws", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "+", "1"}]}], "}"}]}], ")"}]}], ",", 
          RowBox[{"Max", "@", "#"}]}], "}"}], "&"}], "@", 
       RowBox[{"localMat", "[", "\"\<NonzeroValues\>\"", "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x", ",", "y"}], "}"}], "+", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"First", "[", 
              RowBox[{"Pick", "[", 
               RowBox[{
                RowBox[{"localMat", "[", "\"\<NonzeroPositions\>\"", "]"}], 
                ",", "#", ",", 
                RowBox[{"Min", "@", "#"}]}], "]"}], "]"}], "-", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                "ws", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "+", "1"}], ",", 
               RowBox[{
                RowBox[{
                "ws", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "+", "1"}]}], "}"}]}], ")"}]}], ",", 
          RowBox[{"Min", "@", "#"}]}], "}"}], "&"}], "@", 
       RowBox[{"localMat", "[", "\"\<NonzeroValues\>\"", "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.854305670180923*^9, 3.854305854919395*^9}, {
  3.8543060325041943`*^9, 3.854306033186656*^9}, {3.8543066762921267`*^9, 
  3.854306742909832*^9}, {3.854335629369506*^9, 3.854335630598262*^9}, {
  3.854335737563739*^9, 3.854335739580163*^9}, {3.854335831510408*^9, 
  3.854335832557941*^9}, {3.8543842096151857`*^9, 3.8543842380000668`*^9}},
 CellLabel->"In[61]:=",ExpressionUUID->"e76afe69-e9c5-4814-8c0c-25e66cdb3898"],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Tau]Statistic", "[", 
   RowBox[{"mat_", ",", "x_", ",", "y_", ",", "w_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"quadrants", "=", 
       RowBox[{"(", GridBox[{
          {
           RowBox[{"Reverse", "@", 
            RowBox[{"mat", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{
                 RowBox[{"x", "-", "w", "-", "1"}], ",", "1"}], "]"}], ";;", 
               RowBox[{"x", "-", "1"}]}], ",", 
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{
                 RowBox[{"y", "-", "w"}], ",", "1"}], "]"}], ";;", "y"}]}], 
             "\[RightDoubleBracket]"}]}], 
           RowBox[{"Transpose", "@", 
            RowBox[{"mat", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{
                 RowBox[{"x", "-", "w", "-", "1"}], ",", "1"}], "]"}], ";;", 
               RowBox[{"x", "-", "1"}]}], ",", 
              RowBox[{
               RowBox[{"y", "+", "1"}], ";;", 
               RowBox[{"Min", "[", 
                RowBox[{
                 RowBox[{"y", "+", "1", "+", "w"}], ",", 
                 RowBox[{"Length", "@", "rPos"}]}], "]"}]}]}], 
             "\[RightDoubleBracket]"}]}]},
          {
           RowBox[{"mat", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"x", ";;", 
              RowBox[{"Min", "[", 
               RowBox[{
                RowBox[{"x", "+", "w"}], ",", 
                RowBox[{"Length", "@", "rPos"}]}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"Max", "[", 
               RowBox[{
                RowBox[{"y", "-", "w"}], ",", "1"}], "]"}], ";;", "y"}]}], 
            "\[RightDoubleBracket]"}], 
           RowBox[{"Transpose", "@", 
            RowBox[{"Reverse", "@", 
             RowBox[{"mat", "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{"x", ";;", 
                RowBox[{"Min", "[", 
                 RowBox[{
                  RowBox[{"x", "+", "w"}], ",", 
                  RowBox[{"Length", "@", "rPos"}]}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"y", "+", "1"}], ";;", 
                RowBox[{"Min", "[", 
                 RowBox[{
                  RowBox[{"y", "+", "1", "+", "w"}], ",", 
                  RowBox[{"Length", "@", "rPos"}]}], "]"}]}]}], 
              "\[RightDoubleBracket]"}]}]}]}
         }], ")"}]}], ",", "\[IndentingNewLine]", "\[Tau]s"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\[Tau]s", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"Map", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"quadrant", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Variance", "[", 
                   RowBox[{
                   "#", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "]"}], "<=", "0"}], ",", "0", 
                 ",", 
                 RowBox[{"KendallTau", "@@", "#"}]}], "]"}], "&"}], "@", 
              RowBox[{"Transpose", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"#", ",", 
                   RowBox[{"Mean", "[", 
                    RowBox[{"Diagonal", "[", 
                    RowBox[{"quadrant", ",", "#"}], "]"}], "]"}]}], "}"}], 
                 "&"}], "/@", 
                RowBox[{"Range", "[", 
                 RowBox[{
                  RowBox[{"-", "w"}], ",", "w"}], "]"}]}], "]"}]}]}], "]"}], 
           ",", "\[IndentingNewLine]", "quadrants", ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ")"}], 
       "/", "2"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"-", 
      RowBox[{"Det", "[", "\[Tau]s", "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.854291189317211*^9, 3.854291201742571*^9}, {
   3.854291264008689*^9, 3.854291267817123*^9}, {3.854291457585206*^9, 
   3.8542917220036783`*^9}, {3.854291880843871*^9, 3.8542918821399*^9}, {
   3.854291920415143*^9, 3.854291938003356*^9}, {3.85429198071824*^9, 
   3.854292003971575*^9}, {3.8542920417038918`*^9, 3.854292179600562*^9}, {
   3.8542922260498238`*^9, 3.854292262549828*^9}, 3.8542923243822517`*^9, {
   3.854294931314159*^9, 3.854294978360005*^9}, {3.854295043594508*^9, 
   3.8542950743997297`*^9}, {3.854295250953258*^9, 3.854295377322226*^9}, {
   3.8543843371455593`*^9, 3.8543843439618397`*^9}},
 CellLabel->"In[62]:=",ExpressionUUID->"a651c4ed-5074-4cff-afcd-a23bc8edbbd8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"detectButterfly", "[", 
   RowBox[{"intensitySquare_", ",", 
    RowBox[{"symmetry_", ":", "0"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pattern", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"symmetry", "==", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"normalizedIntensities", "=", 
       RowBox[{"intensitySquare", "/", 
        RowBox[{"Total", "[", 
         RowBox[{"intensitySquare", ",", "2"}], "]"}]}]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Extract", "[", 
     RowBox[{"normalizedIntensities", ",", "pattern"}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.854118603365573*^9, 3.854118903363625*^9}, {
  3.854133610164443*^9, 3.85413363806953*^9}, {3.854133713827734*^9, 
  3.8541337150284357`*^9}},
 CellLabel->"In[63]:=",ExpressionUUID->"ee668cb2-7f20-4143-9bef-b718883eec1f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testButterflyStructure", "[", 
   RowBox[{"mat_", ",", "x_", ",", "y_", ",", "w_", ",", 
    RowBox[{"resamples_", ":", "100"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"submatrix", "=", 
       RowBox[{"mat", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{
            RowBox[{"x", "-", 
             RowBox[{
             "w", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            ",", "1"}], "]"}], ";;", 
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{"x", "+", 
             RowBox[{
             "w", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            ",", 
            RowBox[{"Length", "[", "rPos", "]"}]}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{
            RowBox[{"y", "-", 
             RowBox[{
             "w", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            ",", "1"}], "]"}], ";;", 
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{"y", "+", 
             RowBox[{
             "w", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            ",", 
            RowBox[{"Length", "[", "rPos", "]"}]}], "]"}]}]}], 
        "\[RightDoubleBracket]"}]}], ",", "\[IndentingNewLine]", 
      "treeStatistic", ",", "formSubmatrices", ",", "permutedStatistics"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"formSubmatrices", "=", 
      RowBox[{"Function", "[", 
       RowBox[{"matrix", ",", 
        RowBox[{"(", GridBox[{
           {
            RowBox[{"matrix", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{";;", 
               RowBox[{
               "w", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              ",", 
              RowBox[{";;", 
               RowBox[{
               "w", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}]}], "\[RightDoubleBracket]"}], 
            RowBox[{"matrix", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{";;", 
               RowBox[{
               "w", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                "w", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "+", "2"}], ";;"}]}], "\[RightDoubleBracket]"}]},
           {
            RowBox[{"matrix", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                "w", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "+", "2"}], ";;"}], ",", 
              RowBox[{";;", 
               RowBox[{
               "w", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}]}], "\[RightDoubleBracket]"}], 
            RowBox[{"matrix", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                "w", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "+", "2"}], ";;"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                "w", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "+", "2"}], ";;"}]}], "\[RightDoubleBracket]"}]}
          }], ")"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"treeStatistic", "=", 
      RowBox[{"Mean", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Variance", "@", 
            RowBox[{"Flatten", "@", "#"}]}], "&"}], ",", 
          RowBox[{"formSubmatrices", "@", "submatrix"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"permutedStatistics", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"With", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{"permutedSubmatrix", "=", 
            RowBox[{"Part", "[", 
             RowBox[{"submatrix", ",", 
              RowBox[{"Sequence", "@@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"RandomSample", "[", 
                   RowBox[{"Range", "@", "#"}], "]"}], "&"}], "/@", 
                 RowBox[{"Dimensions", "[", "submatrix", "]"}]}], ")"}]}]}], 
             "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Mean", "@", 
           RowBox[{"Flatten", "@", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Variance", "@", 
                RowBox[{"Flatten", "@", "#"}]}], "&"}], ",", 
              RowBox[{"formSubmatrices", "@", "permutedSubmatrix"}], ",", 
              RowBox[{"{", "2", "}"}]}], "]"}]}]}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", "resamples"}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"1", "-", 
      RowBox[{"CDF", "[", 
       RowBox[{
        RowBox[{"EmpiricalDistribution", "@", "permutedStatistics"}], ",", 
        "treeStatistic"}], "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.85412090434899*^9, 3.854120942812682*^9}, {
  3.854121040042563*^9, 3.8541211008661833`*^9}, {3.854121154211021*^9, 
  3.854121154553746*^9}, {3.8541212159148808`*^9, 3.854121281485978*^9}, {
  3.854121430142913*^9, 3.854121450603591*^9}, {3.854121493012597*^9, 
  3.854121715320771*^9}, {3.8541219565429296`*^9, 3.8541219745967627`*^9}, {
  3.854122029331091*^9, 3.854122190473052*^9}},
 CellLabel->"In[64]:=",ExpressionUUID->"bad8051f-5799-4aa2-9c09-7cd60132f432"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testButterflyCandidate", "[", 
   RowBox[{"mat_", ",", "point_", ",", "ws_", ",", 
    RowBox[{"diagonalw_", ":", "10"}], ",", 
    RowBox[{"resamples_", ":", "100"}], ",", 
    RowBox[{"symmetry_", ":", "0"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"largeCandidate", "=", 
       RowBox[{"pickLargeCandidate", "[", 
        RowBox[{"mat", ",", 
         RowBox[{"Sequence", "@@", "point"}], ",", "ws"}], "]"}]}], ",", 
      "\[IndentingNewLine]", "candidate", ",", "structure", ",", 
      "intensityRatio", ",", "\[Tau]", ",", 
      RowBox[{"\[Chi]s", "=", 
       RowBox[{"Sort", "[", 
        RowBox[{"xTo\[Chi]", "/@", "point"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"shift", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"symmetry", "==", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"intensityIndices", "=", "\[IndentingNewLine]", 
       RowBox[{"If", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"symmetry", "==", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"-", "1"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"-", "1"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "2"}], ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "2"}], ",", "1"}], "}"}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"-", "1"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", 
             RowBox[{"-", "1"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}]}], "}"}]}], "\[IndentingNewLine]", 
        "]"}]}]}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"candidate", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "+", 
           "shift"}], ",", 
          RowBox[{
          "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
         "}"}], "&"}], "@", 
       RowBox[{"findButterflySummary", "[", 
        RowBox[{"mat", ",", 
         RowBox[{"Sequence", "@@", "largeCandidate"}], ",", 
         RowBox[{"Round", "[", 
          RowBox[{"ws", "/", "2"}], "]"}], ",", "symmetry"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"structure", "=", 
      RowBox[{"testButterflyStructure", "[", 
       RowBox[{"mat", ",", 
        RowBox[{"Sequence", "@@", 
         RowBox[{
         "candidate", "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}]}], ",", "ws", ",", "resamples"}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"\[Tau]", "=", 
      RowBox[{"\[Tau]Statistic", "[", 
       RowBox[{"mat", ",", 
        RowBox[{"Sequence", "@@", 
         RowBox[{
         "candidate", "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}]}], ",", "diagonalw"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"intensityRatio", "=", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Mean", "[", "\[IndentingNewLine]", 
            RowBox[{"Extract", "[", "\[IndentingNewLine]", 
             RowBox[{"mat", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                 "candidate", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}], "+", "#"}], "&"}], "/@", 
               "intensityIndices"}]}], "\[IndentingNewLine]", "]"}], 
            "\[IndentingNewLine]", "]"}], "-", 
           RowBox[{"Mean", "[", "#", "]"}]}], "\[IndentingNewLine]", ")"}], 
         "/", 
         RowBox[{"StandardDeviation", "[", "#", "]"}]}], "&"}], "@", 
       RowBox[{
        RowBox[{"scanBlock", "[", 
         RowBox[{"mat", ",", 
          RowBox[{"Sequence", "@@", "\[Chi]s"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "3"}], "}"}]}], "]"}], "[", 
        "\"\<NonzeroValues\>\"", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"candidate", "~", "Join", "~", 
      RowBox[{"{", 
       RowBox[{"\[Tau]", ",", "structure", ",", "intensityRatio", ",", 
        RowBox[{
         RowBox[{"computeIntensitySquare", "[", 
          RowBox[{"mat", ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{
            "candidate", "\[LeftDoubleBracket]", "1", 
             "\[RightDoubleBracket]"}]}], ",", "ws"}], "]"}], "~", 
         "detectButterfly", "~", "symmetry"}]}], "}"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8536913634463577`*^9, 3.853691367759654*^9}, {
   3.853691423548668*^9, 3.853691432027932*^9}, {3.85369149238452*^9, 
   3.8536915369269876`*^9}, {3.8536915956485853`*^9, 3.853691612654747*^9}, {
   3.8536917102465143`*^9, 3.853691773955401*^9}, {3.853691808610098*^9, 
   3.853691836800156*^9}, {3.853691961917026*^9, 3.853691963115676*^9}, {
   3.8536922479509478`*^9, 3.853692263082075*^9}, {3.853692961405509*^9, 
   3.8536929675820303`*^9}, {3.853693050720842*^9, 3.853693052574038*^9}, {
   3.853693101810381*^9, 3.8536931027008677`*^9}, {3.85372771494764*^9, 
   3.853727715462181*^9}, {3.853727878822653*^9, 3.853727955146543*^9}, {
   3.853728036919351*^9, 3.85372804748722*^9}, {3.853728100523571*^9, 
   3.8537281928603487`*^9}, {3.853728287876684*^9, 3.85372836851164*^9}, 
   3.853728594550583*^9, {3.8537286267529716`*^9, 3.8537286557167273`*^9}, {
   3.85372869155396*^9, 3.85372870134643*^9}, {3.853728770502122*^9, 
   3.8537288042935677`*^9}, {3.853728840293634*^9, 3.853728861960948*^9}, 
   3.853728915528656*^9, {3.853729366191127*^9, 3.853729370589472*^9}, {
   3.853729454032528*^9, 3.853729460652224*^9}, {3.85373281697471*^9, 
   3.8537328305426702`*^9}, {3.8537356194429626`*^9, 3.85373565054603*^9}, {
   3.853735684398039*^9, 3.8537356862476377`*^9}, {3.853735720687417*^9, 
   3.853735745165867*^9}, {3.8537841577802153`*^9, 3.8537841910742197`*^9}, {
   3.853784222100439*^9, 3.853784338240738*^9}, {3.853784371481061*^9, 
   3.853784393460396*^9}, {3.8537849900515337`*^9, 3.85378500298787*^9}, {
   3.8541222642883387`*^9, 3.85412228349434*^9}, {3.854122336725864*^9, 
   3.854122470942753*^9}, {3.8541225600763617`*^9, 3.854122560219989*^9}, {
   3.8541226144383383`*^9, 3.854122614517171*^9}, {3.854122683334517*^9, 
   3.854122683901807*^9}, {3.8541235949916573`*^9, 3.854123598395831*^9}, {
   3.854123656450878*^9, 3.854123663774934*^9}, {3.854123708796534*^9, 
   3.854123724830391*^9}, {3.8541238115316553`*^9, 3.854123823029714*^9}, {
   3.854124159381319*^9, 3.8541241928847017`*^9}, 3.854125725324139*^9, {
   3.854126001765792*^9, 3.854126002294127*^9}, {3.854289238985528*^9, 
   3.85428925554749*^9}, {3.8542893112913847`*^9, 3.854289325572096*^9}, 
   3.8542899673568172`*^9, {3.8542900194011297`*^9, 3.85429007487991*^9}, {
   3.854290140519742*^9, 3.854290144101623*^9}, {3.85429025248956*^9, 
   3.854290280699915*^9}, {3.8542923614486322`*^9, 3.854292404501781*^9}, {
   3.8542925384950933`*^9, 3.854292591669095*^9}, {3.854292745343462*^9, 
   3.854292777885787*^9}, {3.854292844542008*^9, 3.854293110363886*^9}, 
   3.854293894893333*^9, {3.8542939614512463`*^9, 3.854294017465868*^9}, {
   3.8542940561780767`*^9, 3.854294077641631*^9}, {3.854294108860037*^9, 
   3.854294125976309*^9}, {3.854296226512115*^9, 3.85429624426484*^9}, {
   3.854296422086255*^9, 3.854296450698593*^9}, 3.854296484337164*^9, {
   3.854296944345377*^9, 3.8542970020230618`*^9}, {3.85429704575086*^9, 
   3.854297046855691*^9}, {3.854297787558949*^9, 3.854297788577785*^9}, {
   3.854298448301467*^9, 3.854298495692452*^9}, {3.8542985645877743`*^9, 
   3.854298727892695*^9}, {3.85429900810588*^9, 3.854299186520208*^9}, {
   3.8542992209857473`*^9, 3.8542992687453747`*^9}, {3.85429929943233*^9, 
   3.8542993219091597`*^9}, {3.8542995737484617`*^9, 
   3.8542996126132097`*^9}, {3.85430249558267*^9, 3.854302496334654*^9}, {
   3.854336644584095*^9, 3.854336645853847*^9}, {3.854336695091589*^9, 
   3.854336740855823*^9}, {3.854336898604352*^9, 3.854336901912709*^9}, {
   3.854336960921514*^9, 3.854337009751951*^9}, {3.854337047245488*^9, 
   3.854337060197657*^9}, {3.854338970219212*^9, 3.854338970634598*^9}, {
   3.854339067059223*^9, 3.854339175266012*^9}, {3.854339212963665*^9, 
   3.854339392538044*^9}, {3.8543394415817013`*^9, 3.854339467611203*^9}, 
   3.854341167930541*^9, {3.8543784724624434`*^9, 3.85437847298759*^9}, {
   3.8543785200121517`*^9, 3.854378526467557*^9}, {3.854384259279008*^9, 
   3.854384266738003*^9}, {3.8543843522124434`*^9, 3.854384354080833*^9}, {
   3.854384507399276*^9, 3.854384619085805*^9}, {3.854384974619944*^9, 
   3.854385091300816*^9}, {3.854385430432147*^9, 3.854385431343575*^9}, {
   3.8560231196307573`*^9, 3.856023120152801*^9}},
 CellLabel->"In[65]:=",ExpressionUUID->"44329134-81ba-4861-a236-f25525f45d71"],

Cell[BoxData[
 RowBox[{
  RowBox[{"calibrateButterflyTests", "[", 
   RowBox[{"testMat_", ",", 
    RowBox[{"ratioThreshold_", ":", "5"}], ",", 
    RowBox[{"symmetry_", ":", "0"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"\[Theta]s", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Mean", "[", "#", "]"}], ",", 
          RowBox[{"StandardDeviation", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
       
       RowBox[{"Transpose", "[", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"testMat", "\[LeftDoubleBracket]", 
             RowBox[{";;", ",", ";;", ",", 
              RowBox[{"{", 
               RowBox[{"2", ",", "3"}], "}"}]}], "\[RightDoubleBracket]"}], 
            ",", "1"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}]}], "]"}], "]"}]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"symmetry", "==", "0"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Map", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"#", "==", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{"0", ",", "6"}], "]"}]}], ")"}], "||", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], 
              "<", "ratioThreshold"}], ")"}]}], ",", "\[IndentingNewLine]", 
           "0", ",", "\[IndentingNewLine]", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"MapThread", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"CDF", "[", 
                 RowBox[{
                  RowBox[{"NormalDistribution", "@@", "#1"}], ",", "#2"}], 
                 "]"}], "&"}], ",", 
               RowBox[{"{", 
                RowBox[{"\[Theta]s", ",", 
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"2", ";;", "3"}], "\[RightDoubleBracket]"}]}], 
                "}"}]}], "]"}], "~", "Append", "~", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
            "]"}]}], "\[IndentingNewLine]", "]"}], "&"}], ",", 
        "\[IndentingNewLine]", "testMat", ",", "\[IndentingNewLine]", 
        RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Map", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"#", "==", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{"0", ",", "6"}], "]"}]}], ")"}], "||", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], 
              "<", "ratioThreshold"}], ")"}]}], ",", "\[IndentingNewLine]", 
           "0", ",", "\[IndentingNewLine]", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"MapThread", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"1", "-", 
                 RowBox[{"CDF", "[", 
                  RowBox[{
                   RowBox[{"NormalDistribution", "@@", "#1"}], ",", "#2"}], 
                  "]"}]}], "&"}], ",", 
               RowBox[{"{", 
                RowBox[{"\[Theta]s", ",", 
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"2", ";;", "3"}], "\[RightDoubleBracket]"}]}], 
                "}"}]}], "]"}], "~", "Append", "~", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}]}], 
            "]"}]}], "\[IndentingNewLine]", "]"}], "&"}], ",", 
        "\[IndentingNewLine]", "testMat", ",", "\[IndentingNewLine]", 
        RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellChangeTimes->{{3.854379892020529*^9, 3.854379925347602*^9}, {
  3.854380932799877*^9, 3.854380940313272*^9}, {3.8543809870958443`*^9, 
  3.854380998177635*^9}, {3.854381097943396*^9, 3.854381239596423*^9}, {
  3.854381271907596*^9, 3.854381288851668*^9}, {3.8543815633904963`*^9, 
  3.854381567626851*^9}, {3.854382548982134*^9, 3.854382623959107*^9}, {
  3.854382792396968*^9, 3.8543828792479362`*^9}, {3.854382981215176*^9, 
  3.85438298845294*^9}, {3.854383031853594*^9, 3.854383033109734*^9}, {
  3.854385900136887*^9, 3.854385983097*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"b052c9fe-0eb2-448b-9a2d-2d300faf211a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"findPattern", "[", 
   RowBox[{"mat_", ",", "x_", ",", "y_", ",", "ws_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"patternMat", "=", "\[IndentingNewLine]", 
      RowBox[{"SparseArray", "@", 
       RowBox[{"ParallelTable", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"detectPattern", "@", 
          RowBox[{"computeIntensitySquare", "[", 
           RowBox[{"mat", ",", "s", ",", "t", ",", "ws"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"s", ",", 
           RowBox[{"Max", "[", 
            RowBox[{"1", ",", 
             RowBox[{"x", "-", 
              RowBox[{
              "ws", "\[LeftDoubleBracket]", "1", 
               "\[RightDoubleBracket]"}]}]}], "]"}], ",", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"Length", "@", "rPos"}], ",", 
             RowBox[{"x", "+", 
              RowBox[{
              "ws", "\[LeftDoubleBracket]", "1", 
               "\[RightDoubleBracket]"}]}]}], "]"}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"t", ",", 
           RowBox[{"Max", "[", 
            RowBox[{"1", ",", 
             RowBox[{"y", "-", 
              RowBox[{
              "ws", "\[LeftDoubleBracket]", "2", 
               "\[RightDoubleBracket]"}]}]}], "]"}], ",", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"Length", "@", "rPos"}], ",", 
             RowBox[{"y", "+", 
              RowBox[{
              "ws", "\[LeftDoubleBracket]", "2", 
               "\[RightDoubleBracket]"}]}]}], "]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "y"}], "}"}], "+", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"Pick", "[", 
             RowBox[{
              RowBox[{"patternMat", "[", "\"\<NonzeroPositions\>\"", "]"}], 
              ",", "#", ",", 
              RowBox[{"Max", "@", "#"}]}], "]"}], "]"}], "-", 
           RowBox[{"(", 
            RowBox[{"ws", "+", "1"}], ")"}]}], ")"}]}], ",", 
        RowBox[{"Max", "@", "#"}]}], "}"}], "&"}], "@", 
     RowBox[{"patternMat", "[", "\"\<NonzeroValues\>\"", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.854425678181308*^9, 3.854425774997126*^9}, {
  3.854425834078581*^9, 3.8544259790091133`*^9}, {3.854426021239335*^9, 
  3.854426116041519*^9}, {3.854426501878872*^9, 3.8544265334287157`*^9}, {
  3.854427386852725*^9, 3.8544273877290163`*^9}, {3.854427472445643*^9, 
  3.854427498087985*^9}, {3.856023123833448*^9, 3.85602312424819*^9}},
 CellLabel->"In[67]:=",ExpressionUUID->"0d9f6b8f-c5c8-4e70-852c-580bd872a4ad"],

Cell[BoxData[
 RowBox[{
  RowBox[{"refineTree", "[", "list_", "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n", "=", 
      RowBox[{"Length", "@", "list"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "+", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"#", ",", 
             RowBox[{"Min", "@", "#"}]}], "]"}], "]"}], 
          "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
        RowBox[{"1", "-", 
         RowBox[{
          RowBox[{"Min", "[", "#", "]"}], "/", 
          RowBox[{"Variance", "[", "list", "]"}]}]}]}], "}"}], "&"}], "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#", ",", 
           RowBox[{"n", "-", "#"}]}], "}"}], ".", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Variance", "@", 
            RowBox[{"list", "\[LeftDoubleBracket]", 
             RowBox[{";;", "#"}], "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"Variance", "@", 
            RowBox[{"list", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{"#", "+", "1"}], ";;"}], "\[RightDoubleBracket]"}]}]}], 
          "}"}]}], "/", "n"}], "&"}], "/@", 
      RowBox[{"Range", "[", 
       RowBox[{"2", ",", 
        RowBox[{"n", "-", "2"}]}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.854720005022643*^9, 3.854720090440041*^9}, {
  3.8547201496105623`*^9, 3.8547201498474207`*^9}, {3.854720203624736*^9, 
  3.8547203111401176`*^9}, {3.8547208477019167`*^9, 3.854720859545595*^9}, {
  3.854720928489705*^9, 3.854720966268743*^9}},
 CellLabel->"In[68]:=",ExpressionUUID->"c39b152b-ea8a-49b5-acac-08781943bcc5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"refineOffDiagonal", "[", 
   RowBox[{"mat_", ",", "x_", ",", "y_", ",", "ws_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"intensitySquare", "=", 
       RowBox[{"mat", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{
            RowBox[{"x", "-", 
             RowBox[{
             "ws", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            ",", "1"}], "]"}], ";;", 
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{"x", "+", 
             RowBox[{
             "ws", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            ",", 
            RowBox[{"Length", "@", "rPos"}]}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{
            RowBox[{"y", "-", 
             RowBox[{
             "ws", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            ",", "1"}], "]"}], ";;", 
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{"y", "+", 
             RowBox[{
             "ws", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            ",", 
            RowBox[{"Length", "@", "rPos"}]}], "]"}]}]}], 
        "\[RightDoubleBracket]"}]}], ",", "\[IndentingNewLine]", 
      "treePoint"}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"treePoint", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"refineTree", "[", 
         RowBox[{"Mean", "/@", "intensitySquare"}], "]"}], ",", 
        RowBox[{"refineTree", "[", 
         RowBox[{"Mean", "/@", 
          RowBox[{"Transpose", "[", "intensitySquare", "]"}]}], "]"}]}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "y"}], "}"}], "+", 
        RowBox[{"treePoint", "\[LeftDoubleBracket]", 
         RowBox[{";;", ",", "1"}], "\[RightDoubleBracket]"}], "-", 
        RowBox[{"(", 
         RowBox[{"ws", "+", "1"}], ")"}]}], ",", 
       RowBox[{"treePoint", "\[LeftDoubleBracket]", 
        RowBox[{";;", ",", "2"}], "\[RightDoubleBracket]"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8544790202580643`*^9, 3.8544792055433197`*^9}, {
  3.854479269664034*^9, 3.8544792715607157`*^9}, {3.854719924910894*^9, 
  3.854719989460939*^9}, {3.854720329815246*^9, 3.854720367852078*^9}, {
  3.854720406181697*^9, 3.8547204382992373`*^9}, {3.854720835025639*^9, 
  3.854720835946216*^9}, {3.854720871992642*^9, 3.854720903667055*^9}, {
  3.85602142838426*^9, 3.85602143035511*^9}, {3.856021747267974*^9, 
  3.856021778591714*^9}},
 CellLabel->"In[69]:=",ExpressionUUID->"fec42c28-c0d7-4514-8d5f-3a2604cc906e"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Analysis", "Title",
 CellChangeTimes->{{3.860250723988586*^9, 3.860250728349435*^9}, {
  3.860251087925699*^9, 
  3.860251089437543*^9}},ExpressionUUID->"ee7b5327-648e-4d19-bf18-\
09be2d2492de"],

Cell[TextData[StyleBox["Each of the following sections performs parts of the \
analysis described in the main paper.",
 FontSlant->"Italic"]], "Text",
 CellFrame->{{0, 0}, {2, 0}},
 CellFrameColor->GrayLevel[0.75],
 CellChangeTimes->{{3.860248806085986*^9, 3.860248864968273*^9}, {
   3.860251049012065*^9, 3.8602510622757*^9}, {3.860251105595344*^9, 
   3.860251149944503*^9}, 3.860251987175456*^9},
 FontSize->18,ExpressionUUID->"d3f71c96-9a82-4993-a15f-050fb2697d82"],

Cell[CellGroupData[{

Cell["Load Hi-C Matrix", "Chapter",
 CellChangeTimes->{{3.860251091445524*^9, 
  3.860251095428679*^9}},ExpressionUUID->"3f1c8341-c06f-40e7-a950-\
79bff6066dfd"],

Cell[TextData[StyleBox["Replace \[OpenCurlyDoubleQuote]hi-c_matrix\
\[CloseCurlyDoubleQuote] with filename of interest.",
 FontSlant->"Italic"]], "Text",
 CellFrame->{{0, 0}, {2, 0}},
 CellFrameColor->GrayLevel[0.75],
 CellChangeTimes->{{3.860248806085986*^9, 3.860248864968273*^9}, {
  3.860251049012065*^9, 3.8602510622757*^9}},
 FontSize->18,ExpressionUUID->"e8fe78a1-0707-4b97-8cf4-c4bcee8e16ce"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"hicdata", "=", 
   RowBox[{"Import", "[", 
    RowBox[{
     RowBox[{"hidensecPath", "<>", "\"\<hi-c_matrix\>\""}], ",", 
     "\"\<Data\>\""}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hic", "=", 
   RowBox[{"Part", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}], "\[Rule]", 
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "3"}], "]"}], "]"}]}], "]"}], "&"}], "@", 
      "hicdata"}], ",", 
     RowBox[{";;", "57509"}], ",", 
     RowBox[{";;", "57509"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ClearAll", "@", "hicdata"}]}], "Input",
 CellChangeTimes->{{3.829578675764627*^9, 3.829578676581935*^9}, {
   3.829655617340863*^9, 3.829655618545032*^9}, {3.8296620713868237`*^9, 
   3.8296620716919107`*^9}, {3.835363138307938*^9, 3.8353631386812973`*^9}, {
   3.835363190278421*^9, 3.8353631922380733`*^9}, {3.8511031494774218`*^9, 
   3.851103152244502*^9}, {3.856887173688027*^9, 3.85688718649539*^9}, {
   3.856887225412344*^9, 3.8568872254680347`*^9}, {3.8568873165582237`*^9, 
   3.856887322355235*^9}, {3.856888036695485*^9, 3.856888036732758*^9}, {
   3.856888566311384*^9, 3.8568885729034986`*^9}, {3.856888657397832*^9, 
   3.8568886674200773`*^9}, {3.85688883045395*^9, 3.856888833493664*^9}, {
   3.856888864884604*^9, 3.856888867099634*^9}, {3.856890667246735*^9, 
   3.8568906767903337`*^9}, {3.8602510094810266`*^9, 3.860251028416183*^9}, 
   3.86275357392939*^9, 
   3.862761331847723*^9},ExpressionUUID->"bed01ece-fe08-4e15-b9e8-\
85a40a322b6b"]
}, Closed]],

Cell[CellGroupData[{

Cell["Copy Number & Mixture Proportion Inference", "Chapter",
 CellChangeTimes->{{3.8489323817356*^9, 3.848932394364729*^9}, {
  3.860252068841317*^9, 
  3.860252072754209*^9}},ExpressionUUID->"a87e101c-6714-4c19-b134-\
4ca8593aa36e"],

Cell[TextData[StyleBox["Estimation of effective copy number profile.",
 FontSlant->"Italic"]], "Text",
 CellFrame->{{0, 0}, {2, 0}},
 CellFrameColor->GrayLevel[0.75],
 CellChangeTimes->{{3.860248806085986*^9, 3.860248864968273*^9}, {
   3.860251049012065*^9, 3.8602510622757*^9}, {3.860251105595344*^9, 
   3.860251149944503*^9}, 3.860251987175456*^9, {3.860252064298452*^9, 
   3.8602520902889643`*^9}, 3.8602523158661737`*^9},
 FontSize->18,ExpressionUUID->"4565e6e2-f681-4815-bd25-3b5325e84e78"],

Cell["\<\
Un-comment the respective lines, if the experimental protocol (Fix-C or Hi-C) \
of the contact map in question is known.\
\>", "Text",
 CellChangeTimes->{{3.860252783365714*^9, 
  3.860252835597176*^9}},ExpressionUUID->"0bc6bc3c-82ff-4023-96d3-\
fc17ba3e58bf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"rowsums", "=", 
     RowBox[{"covariateCorrection1", "@", 
      RowBox[{"attachCovariates", "[", 
       RowBox[{"Total", "/@", "hic"}], "]"}]}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"rowsums", "=", 
     RowBox[{"fixCcorrector", "[", 
      RowBox[{"Total", "/@", "hic"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"rowsums", "=", 
      RowBox[{"hiCcorrector", "[", 
       RowBox[{"Total", "/@", "hic"}], "]"}]}], ";"}], "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.860252116478608*^9, 3.860252139740138*^9}, {
  3.860252177714466*^9, 3.8602521855067596`*^9}, {3.860252721866127*^9, 
  3.86025276715317*^9}, {3.862753677533814*^9, 3.862753679386919*^9}},
 CellLabel->"In[73]:=",ExpressionUUID->"e448bfd1-3a0c-4aa3-a6a6-980d5ff8f927"],

Cell[TextData[{
 "Inputs:\n\t\tmaxPloidy (the second parameter in the following function \
call)\t\t\[LongDash]\t\tmaximum copy number to be inferred; necessary to \
resolve unidentifiability concerns inherent in the estimation task\nOutputs:\n\
\t",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Pi]", "1"], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "58ddbca4-e192-4dc1-8c4e-d279439b7a53"],
 "\t\t\[LongDash]\t\testimated effective copy number profile\n\t",
 Cell[BoxData[
  FormBox["f", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "29f13846-ab91-4a53-9329-94049b6500c8"],
 "\t\t\[LongDash]\t\testimated mixture proportion\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{"p", "\[VeryThinSpace]", "s"}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "a18715fa-2cfe-418e-a24c-aa3dd3e0d40d"],
 "\t\t\[LongDash]\t\t",
 Cell[BoxData[
  FormBox["p", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "dd7bc5e9-1567-4520-a922-650a8246fb71"],
 "-values associated with excursions of ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Pi]", "1"], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "3b446406-e9a3-49f0-b0c7-b8d28597a03f"]
}], "Text",
 CellChangeTimes->{{3.860252346698916*^9, 3.860252414008847*^9}, {
  3.860253432441914*^9, 3.8602534480179358`*^9}, {3.860253481926635*^9, 
  3.8602536584149933`*^9}},ExpressionUUID->"b43c19f5-4b93-41e2-8843-\
842dd1caebec"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"\[Pi]1", ",", "f", ",", "ps"}], "}"}], "=", 
   RowBox[{"estimate\[Pi]f", "[", 
    RowBox[{"rowsums", ",", "5"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.860253416285091*^9, 3.8602534263305397`*^9}, {
  3.8602534656854687`*^9, 3.860253471189261*^9}, {3.8627538668633966`*^9, 
  3.862753869570656*^9}, {3.8627546829322433`*^9, 3.862754685401874*^9}},
 CellLabel->"In[92]:=",ExpressionUUID->"54dce92d-e76e-40b8-9fe4-96d7926244d3"]
}, Closed]],

Cell[CellGroupData[{

Cell["Off-Diagonal Inference", "Chapter",
 CellChangeTimes->{{3.848934479238543*^9, 3.848934484958253*^9}, {
  3.860262576843937*^9, 
  3.860262579299774*^9}},ExpressionUUID->"cfce4f0f-b3f7-4245-845a-\
541acefaeb1d"],

Cell[CellGroupData[{

Cell["Detection of type (a) events", "Subsection",
 CellChangeTimes->{{3.860287241639605*^9, 3.8602872452634706`*^9}, {
  3.860288219945024*^9, 3.8602882232904587`*^9}, {3.860288615412406*^9, 
  3.860288619179781*^9}},ExpressionUUID->"8cc3c072-be1a-4643-b37a-\
153e42ea3516"],

Cell["Extract change-point candidates.", "Text",
 CellChangeTimes->{{3.860288443704412*^9, 3.860288478849729*^9}, {
  3.860288623411293*^9, 
  3.860288628220065*^9}},ExpressionUUID->"900b8545-85d0-48ab-9660-\
51b6ff1482ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"candidates", "=", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Differences", "@", 
              RowBox[{"MedianFilter", "[", 
               RowBox[{"\[Pi]1", ",", "50"}], "]"}]}]}], ",", 
            RowBox[{"_", "?", "Positive"}]}], "]"}]}], ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", ">=", 
             RowBox[{"corrchromlocations", "\[LeftDoubleBracket]", 
              RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], "&"}], 
           ")"}]}]}], "]"}]}], ",", "\[IndentingNewLine]", "pos"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pos", "=", 
      RowBox[{
       RowBox[{"{", "1", "}"}], "~", "Join", "~", 
       RowBox[{"Flatten", "[", 
        RowBox[{"1", "+", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{
                 RowBox[{
                 "#", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
                 "-", 
                 RowBox[{"#", "\[LeftDoubleBracket]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"j", "-", "1"}], ",", 
                    RowBox[{"j", "+", "1"}]}], "}"}], 
                  "\[RightDoubleBracket]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "2", ",", 
                 RowBox[{
                  RowBox[{"Length", "@", "#"}], "-", "1"}]}], "}"}]}], "]"}], 
             "&"}], "[", "candidates", "]"}], ",", 
           RowBox[{"_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"#", ">", "100"}], "&"}], ")"}]}]}], "]"}]}], "]"}], 
       "~", "Join", "~", 
       RowBox[{"{", 
        RowBox[{"Length", "@", "candidates"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"aCandidates", "=", 
      RowBox[{
      "candidates", "\[LeftDoubleBracket]", "pos", 
       "\[RightDoubleBracket]"}]}]}]}], "\[IndentingNewLine]", "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.858523231695456*^9, 3.8585232318026237`*^9}, 
   3.85852339923776*^9, 3.860287283526807*^9, {3.860288234155953*^9, 
   3.860288311400174*^9}, {3.8602888013473454`*^9, 3.8602888032472754`*^9}, {
   3.8602913113603992`*^9, 3.860291311447143*^9}, {3.862754874614822*^9, 
   3.862754878717432*^9}, {3.862754939275975*^9, 3.862755046297098*^9}, {
   3.862755110828349*^9, 3.8627551153387327`*^9}},
 CellLabel->"In[97]:=",ExpressionUUID->"734d0636-a390-49bb-a1ec-3caac060dbdb"],

Cell["\<\
Generate row-wise null distributions for extracted change-point candidates.\
\>", "Text",
 CellChangeTimes->{{3.8602884626502953`*^9, 
  3.86028847612995*^9}},ExpressionUUID->"3af97af0-37b5-44e3-826f-\
096f6b0810ce"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mat", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "+", 
         RowBox[{"#", "\[Transpose]"}], "-", 
         RowBox[{"DiagonalMatrix", "@", 
          RowBox[{"Diagonal", "@", "#"}]}]}], "&"}], "@", 
       RowBox[{"hic", "\[LeftDoubleBracket]", 
        RowBox[{"rPos", ",", "rPos"}], "\[RightDoubleBracket]"}]}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"ws", "=", 
      RowBox[{"300", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}]}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"testPoints", "=", 
      RowBox[{"aCandidates", "~", "Join", "~", "acro\[Chi]"}]}]}], 
    "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"aRow", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"rowPattern", "[", 
            RowBox[{"mat", ",", "#", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"#", "<", 
                RowBox[{"Min", "[", "ws", "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"#", ",", "#"}], "}"}], ",", "ws"}], "]"}]}], "]"}], 
           "&"}], "@", 
          RowBox[{
          "testPoints", "\[LeftDoubleBracket]", "k", 
           "\[RightDoubleBracket]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "@", "testPoints"}]}], "}"}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"ProgressIndicator", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"k", "-", "1"}], ")"}], "/", 
        RowBox[{"Length", "[", "testPoints", "]"}]}], "]"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.852260783511898*^9, 3.852260794668336*^9}, {
   3.852260845799309*^9, 3.852260846894752*^9}, {3.8522610100999537`*^9, 
   3.852261030374979*^9}, {3.852261074311803*^9, 3.852261076719406*^9}, {
   3.8522611805964737`*^9, 3.852261187788288*^9}, {3.852261408927525*^9, 
   3.852261415654252*^9}, {3.852261507696312*^9, 3.8522615107331944`*^9}, {
   3.853644806796637*^9, 3.853644846992408*^9}, {3.8536450327082157`*^9, 
   3.85364506760986*^9}, {3.853645216225747*^9, 3.853645261449255*^9}, {
   3.853645292575356*^9, 3.853645322805711*^9}, {3.853645381310175*^9, 
   3.853645420131089*^9}, {3.85364553744233*^9, 3.8536455477355957`*^9}, {
   3.853645679678232*^9, 3.853645709314289*^9}, 3.853773301924993*^9, {
   3.8537733407529583`*^9, 3.8537733501178303`*^9}, {3.853776407438398*^9, 
   3.853776478545059*^9}, {3.853951381715775*^9, 3.853951381796258*^9}, 
   3.854037067856164*^9, {3.8540429385822906`*^9, 3.854042938618421*^9}, {
   3.854043160610244*^9, 3.854043163639135*^9}, {3.8540432564827433`*^9, 
   3.854043259217184*^9}, {3.854043575984643*^9, 3.8540435765111923`*^9}, {
   3.856721638028224*^9, 3.856721668994834*^9}, {3.856726299968169*^9, 
   3.856726300039033*^9}, {3.857956593436573*^9, 3.857956607825264*^9}, {
   3.857957749743353*^9, 3.8579577530293417`*^9}, {3.857959421136305*^9, 
   3.857959421215522*^9}, {3.858013177728415*^9, 3.858013179134739*^9}, {
   3.858046496424458*^9, 3.858046508134509*^9}, {3.858523429021884*^9, 
   3.858523435925254*^9}, 3.858617505033802*^9, {3.86028832585625*^9, 
   3.86028834623109*^9}, {3.860288427555595*^9, 3.860288430371601*^9}, {
   3.8602886622583637`*^9, 3.860288664034308*^9}, {3.860288806978951*^9, 
   3.8602888082189817`*^9}, {3.860291118544272*^9, 3.8602911200708*^9}, 
   3.86029115978127*^9},
 CellLabel->"In[99]:=",ExpressionUUID->"f80ef90b-0371-4cd6-9a97-9ff2a92caf3e"],

Cell["\<\
Calculate summary statistics for each pair of change-point candidates.\
\>", "Text",
 CellChangeTimes->{{3.8602885258086042`*^9, 
  3.860288542600184*^9}},ExpressionUUID->"1aa05606-0d54-49cf-8b99-\
6fa17f014ee6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"aSummary", "=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mat", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "+", 
           RowBox[{"#", "\[Transpose]"}], "-", 
           RowBox[{"DiagonalMatrix", "@", 
            RowBox[{"Diagonal", "@", "#"}]}]}], "&"}], "@", 
         RowBox[{"hic", "\[LeftDoubleBracket]", 
          RowBox[{"rPos", ",", "rPos"}], "\[RightDoubleBracket]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ws", "=", 
        RowBox[{"300", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"testPoints", "=", 
        RowBox[{"aCandidates", "~", "Join", "~", "acro\[Chi]"}]}]}], 
      "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Parallelize", "@", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Module", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
           "target", ",", "blockSamples", ",", "rowSamples", ",", 
            "columnSamples", ",", 
            RowBox[{"x", "=", 
             RowBox[{
             "testPoints", "\[LeftDoubleBracket]", "k", 
              "\[RightDoubleBracket]"}]}], ",", 
            RowBox[{"y", "=", 
             RowBox[{
             "testPoints", "\[LeftDoubleBracket]", "j", 
              "\[RightDoubleBracket]"}]}]}], "\[IndentingNewLine]", "}"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"rowSamples", "=", 
            RowBox[{
            "aRow", "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"columnSamples", "=", 
            RowBox[{
            "aRow", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"target", "=", 
            RowBox[{"detectPattern", "[", 
             RowBox[{"computeIntensitySquare", "[", 
              RowBox[{"mat", ",", "x", ",", "y", ",", "ws"}], "]"}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x", ">=", "y"}], ")"}], "||", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"xTo\[Chi]", "[", "x", "]"}], ">=", 
                RowBox[{"xTo\[Chi]", "[", "y", "]"}]}], ")"}], "||", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Max", "[", 
                 RowBox[{
                  RowBox[{"Length", "[", "testPoints", "]"}], "-", 
                  RowBox[{"{", 
                   RowBox[{"k", ",", "j"}], "}"}]}], "]"}], "<=", "3"}], 
               ")"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
             RowBox[{"Append", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"CDF", "[", 
                  RowBox[{
                   RowBox[{"EmpiricalDistribution", "@", "#"}], ",", 
                   "target"}], "]"}], "&"}], "/@", 
                RowBox[{"{", 
                 RowBox[{"rowSamples", ",", "columnSamples"}], "}"}]}], ",", 
               RowBox[{"testTreeStructure", "[", 
                RowBox[{"mat", ",", "x", ",", "y", ",", "ws", ",", "100"}], 
                "]"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"k", ",", "1", ",", 
          RowBox[{"Length", "@", "testPoints"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"Length", "@", "testPoints"}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8517405057479343`*^9, 3.851740655460449*^9}, {
   3.851740778746763*^9, 3.851740813133803*^9}, 3.8517408984960546`*^9, {
   3.851740935712665*^9, 3.85174098558286*^9}, {3.851741017555873*^9, 
   3.851741025338583*^9}, {3.8517415346552563`*^9, 3.85174155629602*^9}, {
   3.851741591456114*^9, 3.851741625623015*^9}, {3.851741683976097*^9, 
   3.851741781926201*^9}, 3.851741828543672*^9, {3.851741879608995*^9, 
   3.851741982869245*^9}, 3.851742048770721*^9, {3.85174210602208*^9, 
   3.851742106324959*^9}, {3.851742179731094*^9, 3.851742215548917*^9}, {
   3.851742303993462*^9, 3.851742353498063*^9}, {3.851742389105411*^9, 
   3.851742467799045*^9}, {3.851742516494763*^9, 3.851742537084346*^9}, {
   3.85174261449181*^9, 3.8517426275309896`*^9}, {3.8517428009026814`*^9, 
   3.851742803828766*^9}, {3.851743076940003*^9, 3.851743077347247*^9}, {
   3.851743256820389*^9, 3.851743351638624*^9}, {3.8517434110151787`*^9, 
   3.851743451048963*^9}, {3.851743551628353*^9, 3.851743581312649*^9}, {
   3.851743616717218*^9, 3.851743642298285*^9}, {3.851743679692326*^9, 
   3.851743710112958*^9}, {3.851743750340665*^9, 3.851743794243335*^9}, {
   3.851743824616522*^9, 3.851743837959626*^9}, {3.8517439437076883`*^9, 
   3.851744041373094*^9}, {3.851744071875849*^9, 3.8517440905428143`*^9}, {
   3.8517441254365177`*^9, 3.851744125572866*^9}, {3.85174416659212*^9, 
   3.85174427582141*^9}, {3.851744328246429*^9, 3.851744333989012*^9}, {
   3.8517443932531767`*^9, 3.8517443934438868`*^9}, {3.8517444807748137`*^9, 
   3.8517444814154987`*^9}, {3.85174455604919*^9, 3.851744635929079*^9}, {
   3.851744675860648*^9, 3.851744701585466*^9}, {3.851744797518093*^9, 
   3.851744868302849*^9}, {3.8517450412014008`*^9, 3.851745054066265*^9}, {
   3.851745094367972*^9, 3.85174514609276*^9}, {3.85174520360434*^9, 
   3.8517452242953157`*^9}, {3.851745283079747*^9, 3.851745357229251*^9}, {
   3.851745388684223*^9, 3.851745408181348*^9}, {3.851745442613373*^9, 
   3.851745451787731*^9}, {3.851745485315502*^9, 3.8517454959071617`*^9}, {
   3.851745535931192*^9, 3.851745535990975*^9}, {3.851745615368479*^9, 
   3.851745615444952*^9}, {3.851745827236643*^9, 3.851745887398501*^9}, {
   3.8517459550246964`*^9, 3.8517459772529488`*^9}, {3.851746085204858*^9, 
   3.851746088886441*^9}, {3.8517468896393843`*^9, 3.8517469829618883`*^9}, 
   3.85174703620197*^9, {3.851747073197752*^9, 3.851747096697701*^9}, {
   3.8517471385554523`*^9, 3.851747138666008*^9}, {3.8517472905552883`*^9, 
   3.851747363896105*^9}, {3.851747451585017*^9, 3.8517474665204678`*^9}, {
   3.85225649936215*^9, 3.852256626684312*^9}, {3.8522568022230253`*^9, 
   3.852256850880797*^9}, {3.8522568878653708`*^9, 3.852256938959087*^9}, {
   3.852257208537925*^9, 3.8522572092306967`*^9}, {3.85225972699848*^9, 
   3.852259796131502*^9}, {3.852259855262946*^9, 3.852259881354556*^9}, {
   3.852259978441156*^9, 3.852260006375865*^9}, 3.852260095426303*^9, {
   3.852260175140965*^9, 3.8522602746465473`*^9}, 3.8522603154976473`*^9, {
   3.8522605785371*^9, 3.852260585730412*^9}, {3.85226149659931*^9, 
   3.852261633893091*^9}, {3.852262371312283*^9, 3.852262413584815*^9}, {
   3.8522625662103577`*^9, 3.852262584888514*^9}, {3.852262665456497*^9, 
   3.852262855352257*^9}, {3.853644532081744*^9, 3.853644533823862*^9}, {
   3.853645395659663*^9, 3.8536453964517317`*^9}, {3.853645632278267*^9, 
   3.853645660969331*^9}, {3.853645919875629*^9, 3.853645921769526*^9}, {
   3.853645965415781*^9, 3.8536459663488903`*^9}, {3.8536465577310257`*^9, 
   3.853646626778561*^9}, {3.853646758518812*^9, 3.853646762378962*^9}, {
   3.853732030388554*^9, 3.853732046918853*^9}, {3.853734152703494*^9, 
   3.853734199660345*^9}, {3.853772258484117*^9, 3.8537722587945623`*^9}, {
   3.853773496921919*^9, 3.853773523011235*^9}, {3.853773748704508*^9, 
   3.853773756272271*^9}, {3.853776573502243*^9, 3.853776650018465*^9}, {
   3.85395145371075*^9, 3.853951455461133*^9}, 3.854035076451227*^9, 
   3.854037076759551*^9, {3.854037725154236*^9, 3.854037725287018*^9}, {
   3.8540377870769253`*^9, 3.8540378360833693`*^9}, {3.854042971852982*^9, 
   3.854042988897853*^9}, {3.854043029376796*^9, 3.85404303276847*^9}, {
   3.8540430657727423`*^9, 3.85404310167959*^9}, {3.854043174925901*^9, 
   3.854043177365964*^9}, {3.85404326375224*^9, 3.854043266936656*^9}, {
   3.8540437088824167`*^9, 3.854043708969041*^9}, {3.8565868034462*^9, 
   3.8565868040309267`*^9}, {3.856586968786682*^9, 3.856587035260688*^9}, 
   3.856587114712532*^9, {3.8567225596194363`*^9, 3.856722577131802*^9}, {
   3.856726326214418*^9, 3.8567263431804857`*^9}, {3.857956699214612*^9, 
   3.85795671467371*^9}, {3.8579577775014067`*^9, 3.857957783009281*^9}, {
   3.857960085409162*^9, 3.8579600863513412`*^9}, {3.858013277488393*^9, 
   3.8580132782210007`*^9}, {3.858046657036418*^9, 3.858046677739964*^9}, {
   3.858523709335168*^9, 3.8585237213258743`*^9}, 3.858617494586771*^9, 
   3.860288515723054*^9, {3.860288548385481*^9, 3.8602885775289803`*^9}, {
   3.860288680698756*^9, 3.860288700993836*^9}, {3.860288815539392*^9, 
   3.860288816747704*^9}, {3.860291126486968*^9, 3.860291167589262*^9}},
 CellLabel->
  "In[100]:=",ExpressionUUID->"17ae4807-1e74-4009-a44d-d7c01d7e5ec5"],

Cell[TextData[{
 "Aggregate summary statistics into well-calibrated ",
 Cell[BoxData[
  FormBox["p", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "5d817886-99b1-4f84-9e0d-c440147ff91c"],
 "-values"
}], "Text",
 CellChangeTimes->{{3.860288591693058*^9, 
  3.860288612252678*^9}},ExpressionUUID->"328dd8fb-1d8f-49bb-8d25-\
7f7fafc49d56"],

Cell[BoxData[
 RowBox[{
  RowBox[{"aP", "=", 
   RowBox[{"With", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"testPoints", "=", 
       RowBox[{"aCandidates", "~", "Join", "~", "acro\[Chi]"}]}], 
      "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"k", ">=", "j"}], ")"}], "||", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"xTo\[Chi]", "[", 
             RowBox[{
             "testPoints", "\[LeftDoubleBracket]", "k", 
              "\[RightDoubleBracket]"}], "]"}], ">=", 
            RowBox[{"xTo\[Chi]", "[", 
             RowBox[{
             "testPoints", "\[LeftDoubleBracket]", "j", 
              "\[RightDoubleBracket]"}], "]"}]}], ")"}], "||", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{
              RowBox[{
              "testPoints", "\[LeftDoubleBracket]", "k", 
               "\[RightDoubleBracket]"}], "-", 
              RowBox[{
              "testPoints", "\[LeftDoubleBracket]", "j", 
               "\[RightDoubleBracket]"}]}], "]"}], "<", "2000"}], ")"}]}], 
         ",", "0", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Min", "[", "#", "]"}], "&"}], "@", 
          RowBox[{"aSummary", "\[LeftDoubleBracket]", 
           RowBox[{"k", ",", "j"}], "\[RightDoubleBracket]"}]}]}], 
        "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"k", ",", "1", ",", 
         RowBox[{"Length", "@", "testPoints"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"j", ",", "1", ",", 
         RowBox[{"Length", "@", "testPoints"}]}], "}"}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8540372278613663`*^9, 3.854037236089438*^9}, {
   3.8540433948633757`*^9, 3.854043411126092*^9}, {3.85658766114207*^9, 
   3.856587664158614*^9}, {3.856722123850218*^9, 3.856722135574416*^9}, {
   3.856725069327586*^9, 3.856725070523361*^9}, {3.8567260274336433`*^9, 
   3.856726059564694*^9}, {3.856726707178076*^9, 3.85672670737187*^9}, {
   3.856803526325677*^9, 3.856803526461158*^9}, {3.856803612146687*^9, 
   3.856803612712813*^9}, {3.856804491894994*^9, 3.856804492687768*^9}, {
   3.856805252415832*^9, 3.856805252495191*^9}, {3.8568053524857817`*^9, 
   3.856805352510724*^9}, {3.856808505560677*^9, 3.8568085058053703`*^9}, {
   3.8568086329811563`*^9, 3.8568086333291283`*^9}, {3.857956723990322*^9, 
   3.857956726984415*^9}, {3.857957065392086*^9, 3.857957065574766*^9}, {
   3.8579587402012253`*^9, 3.857958744511031*^9}, {3.8580466875865097`*^9, 
   3.858046696986264*^9}, {3.858523727566728*^9, 3.8585237308934*^9}, {
   3.858523799548946*^9, 3.858523799715724*^9}, 3.86028858815071*^9, {
   3.860288636988855*^9, 3.8602886441324883`*^9}, {3.860288704985066*^9, 
   3.860288711240699*^9}, {3.860288821946746*^9, 3.8602888247622957`*^9}, {
   3.8602911297903852`*^9, 3.8602911481657*^9}},
 CellLabel->
  "In[101]:=",ExpressionUUID->"7013751b-5858-45ce-8b23-bea281d7cb79"]
}, Closed]],

Cell[CellGroupData[{

Cell["Detection of type (b) events", "Subsection",
 CellChangeTimes->{{3.86028878196201*^9, 
  3.860288786154587*^9}},ExpressionUUID->"468a5805-4cfb-489a-bdde-\
eb77551eadc0"],

Cell["Extract candidate points.", "Text",
 CellChangeTimes->{{3.8602910662155724`*^9, 
  3.8602910898945303`*^9}},ExpressionUUID->"8ae2418d-932e-4402-bc8b-\
289b5548e57c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mat", "=", 
       RowBox[{"hic", "\[LeftDoubleBracket]", 
        RowBox[{"rPos", ",", "rPos"}], "\[RightDoubleBracket]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"ws", "=", 
       RowBox[{"50", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}]}]}], "\[IndentingNewLine]", "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"bCandidates", "=", "\[IndentingNewLine]", 
     RowBox[{"ParallelTable", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"\[Chi]1", ">=", "\[Chi]2"}], ",", 
         RowBox[{"{", "}"}], ",", 
         RowBox[{"First", "@", 
          RowBox[{"extractButterflyCandidates", "[", 
           RowBox[{
           "mat", ",", "\[Chi]1", ",", "\[Chi]2", ",", "ws", ",", "1"}], 
           "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"\[Chi]1", ",", "1", ",", "21"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"\[Chi]2", ",", "1", ",", "21"}], "}"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8516571084828377`*^9, 3.8516571744709873`*^9}, {
   3.8516572124139853`*^9, 3.851657332270608*^9}, {3.8516573666074553`*^9, 
   3.851657478795545*^9}, {3.85165751356592*^9, 3.851657557283403*^9}, {
   3.851657919489294*^9, 3.851657920573174*^9}, {3.8536878503754473`*^9, 
   3.853687852078065*^9}, 3.853687891583179*^9, 3.853688428155995*^9, 
   3.853688516985283*^9, {3.853690039073821*^9, 3.853690099401703*^9}, {
   3.853690817107839*^9, 3.8536908197143307`*^9}, {3.8536910583126993`*^9, 
   3.853691060870864*^9}, {3.853691339311104*^9, 3.853691341646133*^9}, {
   3.85372955346568*^9, 3.853729589155278*^9}, {3.8537296382360077`*^9, 
   3.8537296606078568`*^9}, {3.853729828958605*^9, 3.853729829395906*^9}, {
   3.8537298827562103`*^9, 3.853729901056376*^9}, {3.853730939134222*^9, 
   3.853730939203212*^9}, {3.853732190154652*^9, 3.853732201193865*^9}, {
   3.8538119165435247`*^9, 3.853811917399147*^9}, {3.8543004474192553`*^9, 
   3.85430046213008*^9}, {3.854334176421831*^9, 3.85433417702045*^9}, {
   3.8543342917636013`*^9, 3.854334293787695*^9}, {3.854334337176453*^9, 
   3.854334349862974*^9}, {3.856722651525343*^9, 3.856722655199654*^9}, {
   3.856725568363885*^9, 3.856725569845517*^9}, {3.856795177785803*^9, 
   3.856795178509362*^9}, {3.8580469906998453`*^9, 3.858046992995125*^9}, {
   3.858523903997311*^9, 3.858523905700879*^9}, {3.86028878871553*^9, 
   3.860288791034967*^9}, {3.860288830745994*^9, 3.8602888362499*^9}},
 CellLabel->
  "In[123]:=",ExpressionUUID->"62cc4b14-4313-488e-a92c-46fc939ebd2b"],

Cell["Compute summary statistics", "Text",
 CellChangeTimes->{{3.860288591693058*^9, 3.860288612252678*^9}, {
  3.8627559166152697`*^9, 
  3.862755948522544*^9}},ExpressionUUID->"3585b3ba-643b-4bd6-a540-\
5059f3dfa2fd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"mat", "=", 
       RowBox[{"hic", "\[LeftDoubleBracket]", 
        RowBox[{"rPos", ",", "rPos"}], "\[RightDoubleBracket]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"ws", "=", 
       RowBox[{"50", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1"}], "}"}]}]}]}], "\[IndentingNewLine]", "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"bP", "=", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"ParallelTable", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\[Chi]1", ">=", "\[Chi]2"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
            "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Quiet", "@", 
            RowBox[{"testButterflyCandidate", "[", 
             RowBox[{"mat", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "corrchromlocations", "\[LeftDoubleBracket]", "\[Chi]1", 
                   "\[RightDoubleBracket]"}], "+", "25"}], ",", 
                 RowBox[{
                  RowBox[{
                  "corrchromlocations", "\[LeftDoubleBracket]", "\[Chi]2", 
                   "\[RightDoubleBracket]"}], "+", "25"}]}], "}"}], "+", 
               RowBox[{"bCandidates", "\[LeftDoubleBracket]", 
                RowBox[{"\[Chi]1", ",", "\[Chi]2", ",", "1"}], 
                "\[RightDoubleBracket]"}]}], ",", "ws", ",", "10", ",", "100",
               ",", "#"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"\[Chi]1", ",", "1", ",", "21"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"\[Chi]2", ",", "1", ",", "21"}], "}"}]}], 
        "\[IndentingNewLine]", "]"}], "&"}], "/@", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}]}]}]}], "\[IndentingNewLine]", "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8516571084828377`*^9, 3.8516571744709873`*^9}, {
   3.8516572124139853`*^9, 3.851657332270608*^9}, {3.8516573666074553`*^9, 
   3.851657478795545*^9}, {3.85165751356592*^9, 3.851657557283403*^9}, {
   3.851657919489294*^9, 3.851657920573174*^9}, {3.8536878503754473`*^9, 
   3.853687852078065*^9}, 3.853687891583179*^9, 3.853688428155995*^9, 
   3.853688516985283*^9, {3.853690039073821*^9, 3.853690099401703*^9}, {
   3.853690817107839*^9, 3.8536908197143307`*^9}, {3.8536910583126993`*^9, 
   3.853691060870864*^9}, {3.853691339311104*^9, 3.853691341646133*^9}, {
   3.8536918490030947`*^9, 3.853691866648323*^9}, {3.853691918762672*^9, 
   3.85369193628137*^9}, {3.8536920702697372`*^9, 3.853692143192544*^9}, {
   3.853692367213571*^9, 3.853692367324458*^9}, {3.853692416749343*^9, 
   3.853692416844057*^9}, {3.853692453137971*^9, 3.853692453330041*^9}, {
   3.8536925249307337`*^9, 3.853692535569216*^9}, {3.853693662831869*^9, 
   3.853693662981501*^9}, {3.853693737426694*^9, 3.853693737627163*^9}, {
   3.853693814830688*^9, 3.8536938149655647`*^9}, {3.853728460088311*^9, 
   3.8537284620790367`*^9}, {3.8537285775843573`*^9, 
   3.8537286076284647`*^9}, {3.853728714572402*^9, 3.853728761239273*^9}, {
   3.853729393707206*^9, 3.853729398793983*^9}, {3.853730178886169*^9, 
   3.853730235980093*^9}, {3.853730303167636*^9, 3.853730377077457*^9}, {
   3.853732205897121*^9, 3.85373220598461*^9}, {3.853732402377096*^9, 
   3.853732406817593*^9}, {3.853735757876223*^9, 3.8537357580432043`*^9}, {
   3.853735788160706*^9, 3.8537357974247103`*^9}, {3.853773801871195*^9, 
   3.8537738044617443`*^9}, {3.8538124801760406`*^9, 3.853812480223543*^9}, {
   3.853812730905328*^9, 3.853812734740521*^9}, 3.854124671664177*^9, {
   3.8541247482950153`*^9, 3.854124775307719*^9}, {3.854124852642124*^9, 
   3.8541248531615868`*^9}, {3.8541249937242947`*^9, 3.854124997262557*^9}, {
   3.854125316298335*^9, 3.854125318321924*^9}, {3.854132045198432*^9, 
   3.854132079723136*^9}, {3.854132250345419*^9, 3.854132250958796*^9}, {
   3.8541325788369503`*^9, 3.854132592154261*^9}, {3.8542947834903927`*^9, 
   3.854294784166604*^9}, {3.854294815013295*^9, 3.854294821834996*^9}, {
   3.854294868686821*^9, 3.854294869750371*^9}, {3.854295392945147*^9, 
   3.8542953935837793`*^9}, {3.8542959266667557`*^9, 3.854295930530497*^9}, {
   3.8542987695133657`*^9, 3.854298790502776*^9}, {3.854299350935864*^9, 
   3.854299357046464*^9}, {3.8543007031351633`*^9, 3.85430071746979*^9}, {
   3.854302540970065*^9, 3.85430254528862*^9}, {3.854378551571199*^9, 
   3.854378581870356*^9}, {3.854379059737474*^9, 3.854379060454968*^9}, {
   3.8543791112607613`*^9, 3.854379117926764*^9}, {3.85437935502225*^9, 
   3.854379375943253*^9}, {3.8543847060058117`*^9, 3.854384727290464*^9}, {
   3.8567226621055727`*^9, 3.8567226757031116`*^9}, {3.856796087307949*^9, 
   3.856796138909438*^9}, {3.85679735071562*^9, 3.8567973720074577`*^9}, {
   3.8567980216871033`*^9, 3.8567980246069927`*^9}, {3.856798331436029*^9, 
   3.8567983353562326`*^9}, {3.8580470198496037`*^9, 3.85804702873477*^9}, {
   3.858047389057775*^9, 3.8580473918086243`*^9}, {3.858523940316617*^9, 
   3.858523949211206*^9}, {3.858525315429545*^9, 3.8585253819222116`*^9}, {
   3.858525516522591*^9, 3.858525633725713*^9}, {3.858525724857279*^9, 
   3.858525758302842*^9}, {3.858525887929661*^9, 3.858525891238681*^9}, {
   3.858525975022089*^9, 3.85852599142875*^9}, {3.8585261203947887`*^9, 
   3.8585261228091917`*^9}, {3.858528804752293*^9, 3.858528807455329*^9}, {
   3.8590371538492537`*^9, 3.859037156248026*^9}, {3.859037284567596*^9, 
   3.859037287180423*^9}, {3.860291095239174*^9, 3.860291103839672*^9}, {
   3.860291175220316*^9, 3.860291249913021*^9}},
 CellLabel->
  "In[124]:=",ExpressionUUID->"37a371eb-a36a-451b-b41e-4f3ff7bc672a"],

Cell[TextData[{
 "Convert summary statistics into well-calibrated ",
 Cell[BoxData[
  FormBox["p", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "4f14489c-5df6-4286-a4cd-b6070bfbeefc"],
 "-values."
}], "Text",
 CellChangeTimes->{{3.860288591693058*^9, 3.860288612252678*^9}, {
  3.862755954377301*^9, 
  3.862755964016584*^9}},ExpressionUUID->"a5e75ed3-e699-4655-a1b7-\
b1cb0620d371"],

Cell[BoxData[
 RowBox[{
  RowBox[{"calibratedbP", "=", 
   RowBox[{"MapThread", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"calibrateButterflyTests", "[", 
       RowBox[{"#1", ",", "5", ",", "#2"}], "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"bP", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.862756438274431*^9, 3.862756448975604*^9}},
 CellLabel->
  "In[208]:=",ExpressionUUID->"a2551a5a-8f02-4bbe-bc6c-5a98066749e9"],

Cell[TextData[{
 "Report events corresponding to significant ",
 Cell[BoxData[
  FormBox["p", TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "80598b77-cc43-465b-916d-a28965c38cd2"],
 "-values."
}], "Text",
 CellChangeTimes->{{3.860288591693058*^9, 3.860288612252678*^9}, {
  3.862755954377301*^9, 3.862755964016584*^9}, {3.862761077825338*^9, 
  3.862761086175219*^9}},ExpressionUUID->"91672ffe-3876-407a-9a59-\
68094a2965d3"],

Cell[BoxData[
 RowBox[{"TableForm", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"candidatesa", "=", 
        RowBox[{"aCandidates", "~", "Join", "~", "acro\[Chi]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"candidatesb", "=", 
        RowBox[{"Quiet", "@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"MapThread", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"#1", ",", 
                RowBox[{"xTo\[Chi]", "/@", "#1"}], ",", "#2"}], "}"}], "&"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                "bP", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
                "\[LeftDoubleBracket]", 
                RowBox[{";;", ",", ";;", ",", "1"}], 
                "\[RightDoubleBracket]"}], ",", 
               RowBox[{
               "calibratedbP", "\[LeftDoubleBracket]", "j", 
                "\[RightDoubleBracket]"}]}], "}"}], ",", "2"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "2"}], "}"}]}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", "list", ",", "threshold"}], 
      "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"list", "=", 
       RowBox[{"ReverseSortBy", "[", 
        RowBox[{
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"MapThread", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"#1", ",", 
                    RowBox[{"xTo\[Chi]", "/@", "#1"}], ",", "#2"}], "}"}], 
                  "&"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"j", ",", "k"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"j", ",", "candidatesa"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"k", ",", "candidatesa"}], "}"}]}], "]"}], ",", 
                   "aP"}], "}"}], ",", "2"}], "]"}], ",", 
               RowBox[{"Sequence", "@@", "candidatesb"}]}], "]"}], ",", "1"}],
             "]"}], ",", 
           RowBox[{"_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], "<=",
                "0"}], "&"}], ")"}]}]}], "]"}], ",", "Last"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"threshold", "=", 
       RowBox[{"findThreshold", "[", 
        RowBox[{
         RowBox[{"list", "\[LeftDoubleBracket]", 
          RowBox[{";;", ",", 
           RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], ",", "0.05"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"list", "\[LeftDoubleBracket]", 
       RowBox[{";;", "threshold"}], "\[RightDoubleBracket]"}]}]}], 
    "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"TableHeadings", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"None", ",", 
      RowBox[{"{", 
       RowBox[{
       "\"\<(filtered) coordinates\>\"", ",", "\"\<chromosome-pair\>\"", ",", 
        "\"\<p-value\>\""}], "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
   RowBox[{"TableDepth", "\[Rule]", "2"}]}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.862756554668466*^9, 3.8627565549746*^9}, {
   3.862756611952343*^9, 3.862756623522147*^9}, {3.862756653552709*^9, 
   3.862756774254941*^9}, {3.862760500960599*^9, 3.862760557814315*^9}, {
   3.862760603171137*^9, 3.862760613484241*^9}, 3.862760687955371*^9, {
   3.8627607338339252`*^9, 3.8627607985368443`*^9}, {3.862760846232299*^9, 
   3.8627610272826223`*^9}, {3.862761091424449*^9, 3.862761186515959*^9}, {
   3.8627613143006983`*^9, 3.8627613178696527`*^9}},
 CellLabel->
  "In[207]:=",ExpressionUUID->"684a2cea-dee1-411f-929d-7f99f60b786a"]
}, Closed]]
}, Closed]]
}, Closed]]
},
Evaluator->"Scratchpaper",
WindowSize->{1440, 872},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"12.3 for Mac OS X x86 (64-bit) (June 19, 2021)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"]], 
   Cell[
    StyleData["Text"], FontFamily -> "Times New Roman", FontSize -> 15, 
    FontWeight -> "Regular", FontSlant -> "Plain", 
    PrivateFontOptions -> {"FontPostScriptName" -> "Automatic"}]}, 
  WindowSize -> {808, 772}, 
  WindowMargins -> {{12, Automatic}, {Automatic, 24}}, Visible -> False, 
  FrontEndVersion -> "12.3 for Mac OS X x86 (64-bit) (June 19, 2021)", 
  StyleDefinitions -> "PrivateStylesheetFormatting.nb"],
ExpressionUUID->"c200c8b3-1513-46b3-9362-fcf769c18a7a"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 478, 12, 22, "Code",ExpressionUUID->"e2f1c539-7661-4274-b896-30d4762f8fc3",
 CellOpen->False],
Cell[1039, 34, 218, 3, 69, "Text",ExpressionUUID->"e1c0a1c7-e88f-4e1a-b171-0b94e5c70687"],
Cell[CellGroupData[{
Cell[1282, 41, 180, 3, 98, "Title",ExpressionUUID->"155dab3a-c5ed-4e7b-be6d-f56bcefadad6"],
Cell[1465, 46, 402, 7, 46, "Text",ExpressionUUID->"049da9a9-6905-4ebf-be70-c7a5775515f6"],
Cell[CellGroupData[{
Cell[1892, 57, 214, 4, 69, "Chapter",ExpressionUUID->"e9e8fb92-0b74-414f-87ae-bbe95bfd0b27"],
Cell[2109, 63, 360, 6, 46, "Text",ExpressionUUID->"7038a397-80b1-46d7-9fd5-23b2b4d0872a"],
Cell[2472, 71, 371, 7, 30, "Input",ExpressionUUID->"99ca1e7f-72e5-4f3b-908f-244aa9ebb7ce"],
Cell[2846, 80, 618, 12, 54, "Text",ExpressionUUID->"aa4e8b08-4d2d-472c-8c90-85433ce859f8"],
Cell[3467, 94, 1233, 23, 52, "Input",ExpressionUUID->"c708f8b9-ce9f-4f1d-b44d-c934ec54eb37"]
}, Closed]],
Cell[CellGroupData[{
Cell[4737, 122, 165, 3, 58, "Chapter",ExpressionUUID->"760ec9ea-99f4-48df-85e1-1acf191d70b8"],
Cell[4905, 127, 369, 7, 46, "Text",ExpressionUUID->"beeb26b3-3915-4688-a39a-58391de67caa"],
Cell[5277, 136, 1256, 36, 30, "Input",ExpressionUUID->"f6b95f0b-fe63-4ce5-9b8f-50c8934d4c2f"],
Cell[6536, 174, 1021, 27, 30, "Input",ExpressionUUID->"a12ba6bc-288b-43e6-97ae-61627d900746"],
Cell[7560, 203, 539, 13, 30, "Input",ExpressionUUID->"4c3286c8-7c08-4d30-a57a-a7658266af4d"],
Cell[8102, 218, 1773, 47, 52, "Input",ExpressionUUID->"4303ab98-d261-4fbb-8b6b-7a570acc591e"],
Cell[9878, 267, 1220, 29, 52, "Input",ExpressionUUID->"955958a2-c2d4-4b79-99ce-4fb2c257b484"],
Cell[11101, 298, 1597, 37, 52, "Input",ExpressionUUID->"360a25d5-c4ed-4bc7-9a8a-6c70d82e6744"],
Cell[12701, 337, 9092, 216, 283, "Input",ExpressionUUID->"cc588f7b-0d02-470a-a33d-6c261c1f38d6"],
Cell[21796, 555, 415, 9, 30, "Input",ExpressionUUID->"b209ffb0-acd9-4fa9-9a2d-46b57b995e86"],
Cell[22214, 566, 728, 23, 30, "Input",ExpressionUUID->"5ac3064b-992a-4979-92b7-757c550fe1d2"],
Cell[22945, 591, 311, 7, 30, "Input",ExpressionUUID->"13aaad66-4b27-4eb6-9ae0-d8df6835d4fe"],
Cell[23259, 600, 3653, 92, 262, "Input",ExpressionUUID->"e6018014-1bb3-4866-bce6-2f57b50e0fd2"],
Cell[26915, 694, 1369, 36, 52, "Input",ExpressionUUID->"ab3e608e-9859-47a5-bdba-4711922ce2dd"],
Cell[28287, 732, 837, 21, 30, "Input",ExpressionUUID->"d7406bd3-afc9-46c6-b9e3-8a313a6feadc"],
Cell[29127, 755, 5301, 118, 367, "Input",ExpressionUUID->"c924a235-70dd-475d-9709-8fcc5c79fa42"],
Cell[34431, 875, 4837, 109, 346, "Input",ExpressionUUID->"191dc58c-6c2c-451d-b138-431a17634244"]
}, Closed]],
Cell[CellGroupData[{
Cell[39305, 989, 238, 4, 58, "Chapter",ExpressionUUID->"2ee84f0a-fb76-4f27-ab69-6e643c7fd472"],
Cell[39546, 995, 422, 8, 46, "Text",ExpressionUUID->"0901cfe1-fe18-4c87-b743-c1577c877ec2"],
Cell[39971, 1005, 894, 24, 30, "Input",ExpressionUUID->"aa1becbf-a1f4-416d-b986-99222f96a6bf"],
Cell[40868, 1031, 1584, 41, 115, "Input",ExpressionUUID->"4ae00ebb-797f-4962-9a64-61a4b3198b2e"],
Cell[42455, 1074, 2234, 56, 115, "Input",ExpressionUUID->"db299511-9ff7-4690-bdf5-605e1727550a"],
Cell[44692, 1132, 1071, 27, 52, "Input",ExpressionUUID->"9b3b4d12-39ba-48ba-b188-ce77dc8d72ab"],
Cell[45766, 1161, 575, 13, 30, "Input",ExpressionUUID->"6fa73d8a-a093-43bf-b146-958b71487237"],
Cell[46344, 1176, 1360, 31, 30, "Input",ExpressionUUID->"291ab902-4e6c-40b3-b96d-73d89ff94127"],
Cell[47707, 1209, 436, 11, 30, "Input",ExpressionUUID->"0d71a6e0-5903-4cea-99eb-f377c2f217ae"],
Cell[48146, 1222, 517, 11, 30, "Input",ExpressionUUID->"fed23639-80ec-4f12-a5c2-f77866d65f57"],
Cell[48666, 1235, 2517, 60, 199, "Input",ExpressionUUID->"0661b12a-8332-4fed-b7e1-981c0112c6e9"],
Cell[51186, 1297, 1974, 48, 157, "Input",ExpressionUUID->"7afb3cfd-601f-4735-a0d6-87c6014eceb8"],
Cell[53163, 1347, 1755, 40, 178, "Input",ExpressionUUID->"31a709df-5dc8-4383-a250-816f8d7da015"],
Cell[54921, 1389, 3647, 86, 388, "Input",ExpressionUUID->"b5aeb345-1d68-46be-8340-d79719479fdf"],
Cell[58571, 1477, 6895, 162, 535, "Input",ExpressionUUID->"46da96b6-4cc2-47a8-a4ea-02ae64eee66c"],
Cell[65469, 1641, 1323, 33, 157, "Input",ExpressionUUID->"33843732-ab8b-4052-b834-382eb9141b76"],
Cell[66795, 1676, 2576, 64, 241, "Input",ExpressionUUID->"da495d93-8b79-4f7c-b72c-511f9d949834"],
Cell[69374, 1742, 827, 20, 73, "Input",ExpressionUUID->"cf94cd99-6ca9-4257-ade1-e0133e5ad722"],
Cell[70204, 1764, 1281, 32, 73, "Input",ExpressionUUID->"6ef8c9b3-4ebe-4e38-b1a5-788c30e24564"],
Cell[71488, 1798, 590, 14, 30, "Input",ExpressionUUID->"f6b38811-9d38-4c8b-813a-48fb86278c19"],
Cell[72081, 1814, 1571, 41, 136, "Input",ExpressionUUID->"eddfe1c6-da45-43a0-8d0c-45b2d8c6455d"],
Cell[73655, 1857, 3732, 86, 430, "Input",ExpressionUUID->"5ba52bfe-041b-4d7a-b69a-8b33ff63dfab"],
Cell[77390, 1945, 1187, 28, 73, "Input",ExpressionUUID->"610b5df0-e7d6-4a5e-aadf-eb5716d5e8a4"],
Cell[78580, 1975, 6260, 133, 430, "Input",ExpressionUUID->"5a093e04-ecb8-4429-887f-1e8b7416a921"],
Cell[84843, 2110, 2007, 49, 229, "Input",ExpressionUUID->"a3b4ba66-f363-40cf-b6a1-087b38c1365d"]
}, Closed]],
Cell[CellGroupData[{
Cell[86887, 2164, 218, 4, 58, "Chapter",ExpressionUUID->"106fb022-15f6-4e63-b3e7-91c45a235c53"],
Cell[87108, 2170, 468, 8, 46, "Text",ExpressionUUID->"e3913b42-7219-4f37-a0d1-58f843f746c1"],
Cell[87579, 2180, 5359, 124, 430, "Input",ExpressionUUID->"1f17a789-0750-436d-846d-4d55869ffb65"],
Cell[92941, 2306, 578, 14, 30, "Input",ExpressionUUID->"76688407-2112-48b0-8bb1-7c99fc56d4ba"],
Cell[93522, 2322, 2782, 56, 157, "Input",ExpressionUUID->"767ab95a-7580-458e-8536-4f30e352eb3f"],
Cell[96307, 2380, 3139, 79, 325, "Input",ExpressionUUID->"889f27df-d9bd-4d82-85af-a25026d9ec51"],
Cell[99449, 2461, 1764, 47, 178, "Input",ExpressionUUID->"4dee2798-e331-4872-b0a2-1cc19ff98c31"],
Cell[101216, 2510, 1486, 31, 157, "Input",ExpressionUUID->"b359fb17-08a4-4b91-993c-6a902309b13f"],
Cell[102705, 2543, 753, 16, 157, "Input",ExpressionUUID->"9a2be885-3fc7-49ba-9bf2-4b829d8861ef"],
Cell[103461, 2561, 1265, 33, 73, "Input",ExpressionUUID->"eba18f3e-cdb3-40a2-8654-bf0e075cadca"],
Cell[104729, 2596, 4167, 96, 325, "Input",ExpressionUUID->"125661c6-1d93-4664-919f-235537133f39"],
Cell[108899, 2694, 6461, 141, 367, "Input",ExpressionUUID->"4533bb85-140e-48d6-8e8a-1f6b5b42634f"],
Cell[115363, 2837, 1182, 32, 52, "Input",ExpressionUUID->"1782d0da-adfa-4ee7-870f-d9774cfd9e6f"],
Cell[116548, 2871, 6452, 157, 367, "Input",ExpressionUUID->"78782e11-ffc4-422f-ba90-0ef1a7d478ab"],
Cell[123003, 3030, 4544, 94, 409, "Input",ExpressionUUID->"f6f0ff0f-e559-4bb5-85ef-61c74097ef26"],
Cell[127550, 3126, 2559, 68, 157, "Input",ExpressionUUID->"1494d1d6-792c-471f-9ab8-d3d30a3df7ee"],
Cell[130112, 3196, 1362, 32, 157, "Input",ExpressionUUID->"0c550ff7-618a-4283-aeb2-b3077089c499"],
Cell[131477, 3230, 4595, 114, 325, "Input",ExpressionUUID->"e76afe69-e9c5-4814-8c0c-25e66cdb3898"],
Cell[136075, 3346, 4975, 118, 308, "Input",ExpressionUUID->"a651c4ed-5074-4cff-afcd-a23bc8edbbd8"],
Cell[141053, 3466, 1477, 37, 178, "Input",ExpressionUUID->"ee668cb2-7f20-4143-9bef-b718883eec1f"],
Cell[142533, 3505, 6025, 147, 419, "Input",ExpressionUUID->"bad8051f-5799-4aa2-9c09-7cd60132f432"],
Cell[148561, 3654, 10326, 214, 556, "Input",ExpressionUUID->"44329134-81ba-4861-a236-f25525f45d71"],
Cell[158890, 3870, 4950, 115, 556, "Input",ExpressionUUID->"b052c9fe-0eb2-448b-9a2d-2d300faf211a"],
Cell[163843, 3987, 3014, 74, 262, "Input",ExpressionUUID->"0d9f6b8f-c5c8-4e70-852c-580bd872a4ad"],
Cell[166860, 4063, 1843, 48, 73, "Input",ExpressionUUID->"c39b152b-ea8a-49b5-acac-08781943bcc5"],
Cell[168706, 4113, 2883, 70, 208, "Input",ExpressionUUID->"fec42c28-c0d7-4514-8d5f-3a2604cc906e"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[171638, 4189, 200, 4, 72, "Title",ExpressionUUID->"ee7b5327-648e-4d19-bf18-09be2d2492de"],
Cell[171841, 4195, 470, 8, 46, "Text",ExpressionUUID->"d3f71c96-9a82-4993-a15f-050fb2697d82"],
Cell[CellGroupData[{
Cell[172336, 4207, 161, 3, 69, "Chapter",ExpressionUUID->"3f1c8341-c06f-40e7-a950-79bff6066dfd"],
Cell[172500, 4212, 400, 7, 46, "Text",ExpressionUUID->"e8fe78a1-0707-4b97-8cf4-c4bcee8e16ce"],
Cell[172903, 4221, 1787, 40, 73, "Input",ExpressionUUID->"bed01ece-fe08-4e15-b9e8-85a40a322b6b"]
}, Closed]],
Cell[CellGroupData[{
Cell[174727, 4266, 234, 4, 58, "Chapter",ExpressionUUID->"a87e101c-6714-4c19-b134-4ca8593aa36e"],
Cell[174964, 4272, 498, 8, 46, "Text",ExpressionUUID->"4565e6e2-f681-4815-bd25-3b5325e84e78"],
Cell[175465, 4282, 270, 6, 33, "Text",ExpressionUUID->"0bc6bc3c-82ff-4023-96d3-fc17ba3e58bf"],
Cell[175738, 4290, 886, 22, 73, "Input",ExpressionUUID->"e448bfd1-3a0c-4aa3-a6a6-980d5ff8f927"],
Cell[176627, 4314, 1464, 36, 142, "Text",ExpressionUUID->"b43c19f5-4b93-41e2-8843-842dd1caebec"],
Cell[178094, 4352, 502, 10, 30, "Input",ExpressionUUID->"54dce92d-e76e-40b8-9fe4-96d7926244d3"]
}, Closed]],
Cell[CellGroupData[{
Cell[178633, 4367, 216, 4, 58, "Chapter",ExpressionUUID->"cfce4f0f-b3f7-4245-845a-541acefaeb1d"],
Cell[CellGroupData[{
Cell[178874, 4375, 275, 4, 54, "Subsection",ExpressionUUID->"8cc3c072-be1a-4643-b37a-153e42ea3516"],
Cell[179152, 4381, 223, 4, 33, "Text",ExpressionUUID->"900b8545-85d0-48ab-9660-51b6ff1482ff"],
Cell[179378, 4387, 2933, 72, 178, "Input",ExpressionUUID->"734d0636-a390-49bb-a1ec-3caac060dbdb"],
Cell[182314, 4461, 226, 5, 33, "Text",ExpressionUUID->"3af97af0-37b5-44e3-826f-096f6b0810ce"],
Cell[182543, 4468, 3767, 78, 220, "Input",ExpressionUUID->"f80ef90b-0371-4cd6-9a97-9ff2a92caf3e"],
Cell[186313, 4548, 222, 5, 33, "Text",ExpressionUUID->"1aa05606-0d54-49cf-8b99-6fa17f014ee6"],
Cell[186538, 4555, 9302, 169, 493, "Input",ExpressionUUID->"17ae4807-1e74-4009-a44d-d7c01d7e5ec5"],
Cell[195843, 4726, 358, 10, 35, "Text",ExpressionUUID->"328dd8fb-1d8f-49bb-8d25-7f7fafc49d56"],
Cell[196204, 4738, 3302, 70, 262, "Input",ExpressionUUID->"7013751b-5858-45ce-8b23-bea281d7cb79"]
}, Closed]],
Cell[CellGroupData[{
Cell[199543, 4813, 175, 3, 38, "Subsection",ExpressionUUID->"468a5805-4cfb-489a-bdde-eb77551eadc0"],
Cell[199721, 4818, 171, 3, 33, "Text",ExpressionUUID->"8ae2418d-932e-4402-bc8b-289b5548e57c"],
Cell[199895, 4823, 2836, 55, 262, "Input",ExpressionUUID->"62cc4b14-4313-488e-a92c-46fc939ebd2b"],
Cell[202734, 4880, 219, 4, 33, "Text",ExpressionUUID->"3585b3ba-643b-4bd6-a540-5059f3dfa2fd"],
Cell[202956, 4886, 6052, 106, 346, "Input",ExpressionUUID->"37a371eb-a36a-451b-b41e-4f3ff7bc672a"],
Cell[209011, 4994, 406, 11, 35, "Text",ExpressionUUID->"a5e75ed3-e699-4655-a1b7-b1cb0620d371"],
Cell[209420, 5007, 515, 14, 60, "Input",ExpressionUUID->"a2551a5a-8f02-4bbe-bc6c-5a98066749e9"],
Cell[209938, 5023, 447, 11, 35, "Text",ExpressionUUID->"91672ffe-3876-407a-9a59-68094a2965d3"],
Cell[210388, 5036, 4257, 101, 325, "Input",ExpressionUUID->"684a2cea-dee1-411f-929d-7f99f60b786a"]
}, Closed]]
}, Closed]]
}, Closed]]
}
]
*)

